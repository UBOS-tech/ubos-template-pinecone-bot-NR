[
    {
        "id": "c8208e6a65d3c2af",
        "type": "tab",
        "label": "Bot ",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "33ad232901cfdd1c",
        "type": "tab",
        "label": "Links",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "4004e7d2fbdbf6a9",
        "type": "tab",
        "label": "admin pages",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "f4036141cc030bcf",
        "type": "tab",
        "label": "Auth",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "4cba6f8219137af4",
        "type": "tab",
        "label": "Settings",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "8bea414da58d7b2a",
        "type": "tab",
        "label": "Base",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "752a8b5a286babe5",
        "type": "group",
        "z": "f4036141cc030bcf",
        "name": "Roles",
        "style": {
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "14b59f3691ef69ba",
            "84a0df2970ba557a",
            "399a4d9543fe95a1",
            "8b8038ef3ffa67dc",
            "a2903e704c5feffd",
            "cf996b8f5729052e",
            "bb8c3b11be10027d",
            "98ea56df1bdf7663",
            "5e4d4597f4c69b03",
            "669f5378dc89b756",
            "f8d3962a2d3d4295",
            "da93f58c9901602e",
            "c1327a786ae3deed",
            "9af1975a343bc582",
            "1a8d5dbb5642beda",
            "18133ecfe411d7f0",
            "d7b0e35cdd28547a",
            "7510771007812d39",
            "2cceb3d0a93343d8",
            "1383178398d4778b",
            "777f378a36dc63f0",
            "ee0773620e14dc5e",
            "c387f054fc1d8ef2",
            "9fe78a1700cc52d7",
            "83c8060a7ab3bf27",
            "a79b5a026be5770c",
            "22c15e1e7bf3a3ca",
            "d66bda1905ec670a",
            "f8956004b58baaad",
            "78b779b42c51cffb",
            "753babafc6ec97fd",
            "881a3a438a261f6f"
        ],
        "x": 14,
        "y": 1139,
        "w": 712,
        "h": 902
    },
    {
        "id": "7cf09a5628ba29e5",
        "type": "group",
        "z": "f4036141cc030bcf",
        "name": "Authorization",
        "style": {
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "4f0b3da36fb0040c",
            "5fd1692f7e8d87b5",
            "abfb844120e384b4",
            "62a0db821ee1373d",
            "0791faf1cee2fe7f",
            "c4b1bd96421d0281",
            "cd1dfd3d06c80ef4",
            "e78bfdb95d2722e4",
            "91e2852778907a59",
            "268b887a3da70c7d",
            "7e24ab9c80ca59ea",
            "f7a7e47f575cc20f",
            "2c60c99cba5d66e8",
            "7822047ac02138e4",
            "e80f4ed8349b066e",
            "c86dcb9df78cebf6",
            "bdd3c6716bf4d72a",
            "ad274da8cc3c3022",
            "2a1cf553e1e9ec78",
            "dfd63696a37ed3ef",
            "63e96537c28f9852",
            "caff712e2eb791e2",
            "8e793c55c7af2219",
            "43a4fd40f853d3a1",
            "61ea6b2dafed34ff",
            "8ebd248a8eed9491",
            "9bdeada5928fdb22",
            "8c5efef801cc1dc0",
            "1b70be2e868d8c04",
            "30eee249014d5f9c",
            "d3246b62cc5c7d48",
            "c3b9152502b0b7de",
            "b33db8bb0f9df1e6",
            "7bb68135adb77b5f",
            "d5ece23b520b810f",
            "3664e53bb83334c6",
            "f36403b4bdb0a3b9",
            "c8359b5d14016069",
            "5d9628083a55b25a",
            "1aa6084c940d35b0",
            "a9c57cc5fea578f4",
            "16b45fd91269424a",
            "8e724f7bfa9319f6",
            "6ab136250b17e86c",
            "1f52497bc2ed6264",
            "baba729d5c88e013",
            "f4e52f3a41956c87",
            "25b819b5a56c3054",
            "3443d8e7d57ade22",
            "7d7b3c509b17950d",
            "d1143196b526568d",
            "dca099b2fda6a31e",
            "612c15931c94db0f",
            "2a9c245b96099f4e",
            "faaade0d0c380b57",
            "84a3404c5002c4f7",
            "eeceed583550e3fa",
            "621d5d5a41669c64",
            "d5af917bfe74ba4c",
            "65b608719a7b1d8f",
            "12507e3542cead46",
            "52911e87debd8301",
            "7d24a5806739b5fb",
            "fca1a6e7c2a907ba",
            "38264f88df3f51f8",
            "4f4233c2503ef413",
            "3f2728a428f70979",
            "787c14ff2d5c5657",
            "72dddb2443952553",
            "8cbf4dcd5bda929e",
            "56afed1bb13cc979"
        ],
        "x": 14,
        "y": 39,
        "w": 1952,
        "h": 1022
    },
    {
        "id": "d47c4baf98dd7d3b",
        "type": "group",
        "z": "f4036141cc030bcf",
        "name": "Confirm Email Registration",
        "style": {
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "8bf11e1db155c406",
            "b19133390f7fff7a",
            "28e417acf6703c8e",
            "f05c31a436d493c1",
            "15bc335d0fad3f03",
            "38300e6abcb36ac3",
            "a7b60ea648465b13",
            "2ebbf3d403304123",
            "f8ac81b8f44aa1c1",
            "4ca2aafdce75631b"
        ],
        "x": 774,
        "y": 1139,
        "w": 1012,
        "h": 162
    },
    {
        "id": "b69c8ee37e3e0852",
        "type": "group",
        "z": "f4036141cc030bcf",
        "name": "Reset Paaword",
        "style": {
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "ab301c55037892a5",
            "33cd63d87b4e381c",
            "de3eb89f39a1530a",
            "c48a80eca03bbba4",
            "c3173697fb7f4bac",
            "348f8ae5da73c0d5",
            "15933ef85e8b2695",
            "b89f08cda462a95f",
            "9fec925d9c6148b0",
            "0614831a6dd18bbb",
            "0b8815511f027788",
            "acc53e48e5c37796",
            "a64da465eda134a3",
            "3839f7c847da4d06",
            "2757cb2a62d54166",
            "f949b57456c57058",
            "8427d42401796f0a",
            "ca3b0d180179516b",
            "f0fde05b39c69287",
            "cb0efb585b6584ea",
            "5b474b857331162b",
            "216c8a6f073f5011",
            "47112228019a0ace",
            "73896d5cbf2b11df",
            "8bd61a8f68025413",
            "faf358394ddc4fe6",
            "e5a3c3eb0171a5bd",
            "f393416741ceb5bb",
            "f94300e01993e46c",
            "1e3f1d731ea39467",
            "36f9a70a94832862",
            "030414dfd3ed59a5",
            "fcb9bc55f1082cf3",
            "c5b4ccce77d03e87",
            "0617a8c9543f9896",
            "6ed5acebd2a44763",
            "5322da50da8b810a"
        ],
        "x": 774,
        "y": 1339,
        "w": 1652,
        "h": 622
    },
    {
        "id": "1c10aa09f2bae3b6",
        "type": "group",
        "z": "f4036141cc030bcf",
        "name": "User Management",
        "style": {
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "f5be1263c0467e95",
            "e06c13c7edcdcd74",
            "e53113f64379a00a",
            "ac19deab86cb78e0",
            "4cbf03980d53b40c",
            "c905fee71d44c8d6",
            "cbe2971087f33fe5",
            "805f5b498ea3ba78",
            "751980e9e08597cb",
            "30c126c804b1a781",
            "ca45317f305a9e94",
            "11ae1973a48d1646",
            "9c4e434bd50c7629",
            "055f25983fece25e",
            "6f74a492cde629ef",
            "52c5f9f84fbd0e5a",
            "1cfa1bef551eea8c",
            "5a847e417c0b356f",
            "a09abdd606dfe92f",
            "e7b39c38c93e3854",
            "9159b9aa416b3084",
            "755a42caae4e1af0",
            "c6e9cd738f822557",
            "830a855b4d7f7858",
            "f1cc129781765941",
            "34bdf0171571de42",
            "8d02360a631dcfd2",
            "4db5cfe770e539c9",
            "b8b946c615b8106b",
            "db9c3ea65883774f"
        ],
        "x": 14,
        "y": 3039,
        "w": 1172,
        "h": 662
    },
    {
        "id": "a89d39ed625d493a",
        "type": "group",
        "z": "f4036141cc030bcf",
        "name": "Modules",
        "style": {
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "e7fd978ce87aca9f",
            "85568b61aa0c227a",
            "d70a394b4312d3ef",
            "5d71844b960e0965",
            "5c368970a09368c6",
            "aa8ef0110ab08941",
            "376174881ff1a55a",
            "061a5e02eefac437",
            "232d8d9e33cae211",
            "a52c0bddea4b8ea1",
            "1c83404957bea119",
            "6fbefd201f3acbfd",
            "4c265b78766e0676",
            "dc98a8249850bce2",
            "7800f240d6ce9d3c",
            "b29925263067250f",
            "9552e6aaf4e9e730",
            "f085a549ae9699b7",
            "2730235d0daf0113",
            "ace4106e83f92bd4",
            "3d521620d0c4a209",
            "c5a49592c2319b79",
            "69b2546c20e0f849",
            "c2b7abe6d2dfa874",
            "2c7eed711063667b",
            "e293cccc7303a4fe",
            "ae8e77cbc6311e1a",
            "ee6d35faa631e26d",
            "5f292bba63355586",
            "32729a9b111b8383",
            "4344a46a2b2adc00",
            "1cee9102777633e6",
            "133ba599444e0f8b",
            "d9f3e63efb88e1c2",
            "1d7ed8fcc9ca2114",
            "02e59b0e8b788849",
            "0fd0d2b6ef60273a",
            "aea44c2995d364d2",
            "0da57daeb8571c67",
            "bc255567ba2f7b55",
            "aed0f134a3d46198",
            "22995a8e4464c6e5",
            "daa9252c4d5e4a15"
        ],
        "x": 14,
        "y": 2079,
        "w": 1032,
        "h": 922
    },
    {
        "id": "1f1b365afc8becc5",
        "type": "group",
        "z": "8bea414da58d7b2a",
        "name": "Demo",
        "style": {
            "label": true
        },
        "nodes": [
            "6a8ed9cc40220ef6",
            "a686b4808141bbf4",
            "6140c878962dd22f",
            "512bf5fd33a8679d",
            "1c959c0c2ef18143",
            "a5501616c36880d2",
            "c942ede7e8406c1f",
            "a3717377eb0b554d",
            "6e171ee418466503",
            "359cab52989aa29b"
        ],
        "x": 44,
        "y": 2499,
        "w": 1342,
        "h": 142
    },
    {
        "id": "a16a3e4151c2e982",
        "type": "group",
        "z": "8bea414da58d7b2a",
        "name": "Actions with Knowlege Base",
        "style": {
            "label": true
        },
        "nodes": [
            "2c9aaf57c2401f44",
            "07624da9521cf777",
            "d4de0d3bb056d3a4",
            "ee68ef8d980292c4",
            "68ac101a9775ddce",
            "f54db9132beab646",
            "b4608e27acb2b4f5",
            "46b05adc2604765c",
            "62f4c7a8af42963f",
            "98bec222133fdb0a",
            "281096775943d58b",
            "44f53453723f5c75",
            "6e3cbfc2abcc457d",
            "00bd3d46bb08b1e6",
            "30591fa61f0ab740",
            "3f9c7ffdfcc3f7dc",
            "152eea09afdeea2d",
            "ef06a46f33219658",
            "dc553cd69f080f56",
            "790871619c7fdbc7",
            "c1109b6064ebbca9",
            "8ac6c24559de4776",
            "53c071bd3c47255c",
            "a265afe5f6517876",
            "70bf347cf45632b6",
            "cdc8d111bf092667",
            "9bd946aefeb9022c",
            "e98ea35b295b7995",
            "09801ef5a703ec17",
            "1d799e3d024c7f74",
            "f4162afcbdfcbd78",
            "aa524198ec55d939",
            "fd71d53d53cdf6d0",
            "4d00f14a894c3d1a",
            "481c73b6eb12dac5",
            "606aa4d8d05a9287",
            "6d02cc019a013d48",
            "e9975ec25168990f",
            "252629b2941bab49",
            "f3693d6803a80481",
            "2400c26a38c58e08",
            "1917c12fa2c8a4cf",
            "92f653a488050792",
            "a6b9a5d614c73e9e",
            "b5d5f3c0b2235a8b",
            "9202426fe5eabf3e",
            "12fd6ccf93e5a7f0",
            "667bc743d242e13d",
            "dff98dfc8f9ced2a",
            "4e937f790d5417e6",
            "f5fe1f2be3f0a8b2",
            "f7b854eb2dc1b411",
            "109911acfae79b7a",
            "7987659ba87c382e",
            "2bdc0d294e3e0bf4",
            "b294829d3045d4d9",
            "a285ccae6495c571",
            "a476f9b007fdc7df",
            "7676181e57cb8077",
            "24a52e523c94a6b1",
            "ba455781b510a1a3",
            "a31ae24a2d6a88e3",
            "42388fd17c427ec6",
            "8aa3ca8d85ab7976",
            "bb6e63ef3b3b0ba9",
            "3f2f57386cc5229d",
            "02f45d35273cae7c",
            "96b9fa92c8cf9113",
            "250cc8f7709d5bb6",
            "ae3df007d4bb6281"
        ],
        "x": 34,
        "y": 39,
        "w": 1652,
        "h": 942
    },
    {
        "id": "ebee837ffce65a75",
        "type": "group",
        "z": "c8208e6a65d3c2af",
        "name": "messanger bot",
        "style": {
            "stroke": "#0070c0",
            "fill": "#bfdbef",
            "label": true
        },
        "nodes": [
            "66763628722735fb",
            "4816299b040f2829",
            "83503c945cbb4c4d",
            "caa3ef679b43edbc",
            "1962e32d56dd9f06",
            "fb2196741549bce1",
            "650845245a602f3c",
            "cc2767e9ed1dcea1",
            "9432065d3374bca1",
            "baefdb1424cd8868",
            "62ee4ed8b0807623",
            "34e51cbe5a4a131a",
            "ed51dc47c043feec",
            "ab5370a9f61f6320",
            "16b172fced11b810",
            "d4884dc3f42c77e8",
            "ff6b626110f2f6ec",
            "edb73f62309898e3",
            "96831d7c1dcb47fa",
            "752a70a77c9750d8",
            "7f89c6e66b7532de",
            "a47dc852f2a3d493",
            "6ea0bca567f98258",
            "a65aaa50a45d0252",
            "28efd2464c3c839c"
        ],
        "x": 34,
        "y": 939,
        "w": 1592,
        "h": 262
    },
    {
        "id": "40d09c6e6df96683",
        "type": "group",
        "z": "c8208e6a65d3c2af",
        "name": "whatsappbot",
        "style": {
            "stroke": "#92d04f",
            "fill": "#e3f3d3",
            "label": true
        },
        "nodes": [
            "9f8e791c6b9a642c",
            "a5f2c2ab21518eb7",
            "3e397bf3b91a5907",
            "72c0f7facf326866",
            "0a2e4892c4e243c2",
            "0e20c35adb5cc171",
            "09ed5a18c5e2572d",
            "602464edb3541c8a",
            "56f20785fda555c8",
            "a8182a7e59ef243a",
            "f08426907c45fac4",
            "f5be53459c334004",
            "8855b83b6672aa0a",
            "201d52af1c42d0e7",
            "12444a1783ffbd19",
            "83e70ce5a4defd36",
            "cd6205f05718e984",
            "db7d2c1d52f05bf9",
            "7917d687a61f2409"
        ],
        "x": 34,
        "y": 1279,
        "w": 1812,
        "h": 342
    },
    {
        "id": "7f86806a4ca0c715",
        "type": "group",
        "z": "c8208e6a65d3c2af",
        "name": "instagram bot",
        "style": {
            "stroke": "#ffC000",
            "fill": "#ffefbf",
            "label": true
        },
        "nodes": [
            "dba0f7ab6e4b919d",
            "9901b6a7a9032582",
            "243611d5c2db94f9",
            "92213ea20ab9b1ef",
            "8ba088e5adc829b1",
            "627bfa9d93208c59",
            "a8cba982ca4f9115",
            "b052742bc3945ec3",
            "5eac3e8dfce81d88",
            "51b3787563ee1a38",
            "693d79d4423ce154",
            "bcf5974f2cef9cba",
            "99caac847f5df515",
            "fbd6146e89b1d42d",
            "cf9a6ba45df67d83",
            "12c72333898f97b7",
            "504f2332759ef484",
            "3e64811eeb98af3f",
            "a83a80258217806d",
            "beeff7858c8e1db1",
            "947b8cf521fa8b81",
            "641684d8ce0a590f",
            "e0933beca89886f4"
        ],
        "x": 34,
        "y": 1679,
        "w": 1812,
        "h": 302
    },
    {
        "id": "80544ac2e67c2381",
        "type": "group",
        "z": "4cba6f8219137af4",
        "name": "General",
        "style": {
            "stroke": "#92d04f",
            "fill": "#e3f3d3",
            "label": true
        },
        "nodes": [
            "b9dfba77cf0659da",
            "0225b679b27c7cb6",
            "cebe20a19da025cb",
            "18bd79bbe3db2336",
            "14d2abc0b3f41cf9",
            "31926911dc3e927a",
            "1a1acd007e534462",
            "cbd59739d47324a6",
            "bf38233f75e9e634",
            "4bf84b38cabfd2b8",
            "0b634a02e2f46fc7",
            "04ad2bf4e767fd19",
            "fd42a251b9afd49b",
            "d7144c5acabd38c0",
            "2cd32bbc5f43b1e9",
            "e3b8c26d52822ba0",
            "219438abb376baad",
            "5ed03305ad9ca676",
            "8fe2f86059898917",
            "22c15a24c4d0adfa",
            "e2ddfce36897aa9d"
        ],
        "x": 34,
        "y": 39
    },
    {
        "id": "7ab0a46dbaab3e33",
        "type": "group",
        "z": "4cba6f8219137af4",
        "name": "Telegram",
        "style": {
            "stroke": "#ffC000",
            "fill": "#ffefbf",
            "label": true
        },
        "nodes": [
            "b7d26d9f317a4ce9",
            "a44d45874ebeb754",
            "a33aa3cab944b729",
            "0f3a84ec943e5b13",
            "24c4d892d84069d7",
            "77e03324263dd58d",
            "ef69804671bc03dd",
            "6608ddc70a4b2b60",
            "8bea79732db57d81",
            "2fbc0da069ce400e",
            "6eeabcaa5729b632",
            "165d1d33afaf1c2e",
            "c277b27f50de7b47",
            "fd3c761bbe5711a4",
            "70087cd5c5a5c551",
            "5ad1a8b7bc330500",
            "3d0bcba9e1b0867e",
            "fda135fec557af97",
            "175fb1669ebe74b6",
            "0dc15aa186445a0f",
            "2baefbb8c45261ea"
        ],
        "x": 34,
        "y": 519
    },
    {
        "id": "7a0dc49638e7953f",
        "type": "group",
        "z": "4cba6f8219137af4",
        "name": "WhatsApp",
        "style": {
            "stroke": "#ffff00",
            "fill": "#ffffbf",
            "label": true
        },
        "nodes": [
            "bb96d23ed888929e",
            "fcbb92757366bf33",
            "54e078af5c0d3adc",
            "81f9b8c4177c260c",
            "4e7b3768b3931cfb",
            "604fb55d3034b5b3",
            "55b4fb10f4eea162",
            "446fd365d7fa0305",
            "6c030d2588a9b206",
            "01556533647dfef3",
            "07800ad0b4f9213f",
            "4216ad203406f19d",
            "a5527e8d9cc266fe",
            "fe2d7ebe90fcf111",
            "1f8a739ea5ee02cd",
            "f22993bbddeb18b5",
            "746c06b58c3b2d30",
            "02f3af026c6e9af0",
            "97ecf733940516b3",
            "e9e2f318883d6af3",
            "0f0d30344ca45f4a"
        ],
        "x": 34,
        "y": 939
    },
    {
        "id": "5cf2bc7a9091263d",
        "type": "group",
        "z": "4cba6f8219137af4",
        "name": "Meta",
        "style": {
            "stroke": "#0070c0",
            "fill": "#bfdbef",
            "label": true
        },
        "nodes": [
            "80b27f596185b0b5",
            "5c07c1802edd7436",
            "a1e983d79486f057",
            "5a28a0e9ba4c93ae",
            "d09342e7a96a3a1b",
            "eb6e8f5ff083dd6b",
            "80328f5fc0f8cc4f",
            "4e85fd2ea67195c3",
            "4eff46ab12c5c07e",
            "b303bbd2a2f63ba0",
            "411e5fefe630bd97",
            "47f53d27d5551493",
            "7e12ce9603e46ae8",
            "82e272bb8a733aad",
            "788b05fb52c4fe79",
            "097d5a354e0f8ea6",
            "5008af5f7461f232",
            "db66ea7be2d27d87",
            "eb9f04e925a2c58e",
            "8a7b40691c947077",
            "b1cb89a3b4ba7937"
        ],
        "x": 34,
        "y": 1419
    },
    {
        "id": "9ab1eb9b42ce281a",
        "type": "group",
        "z": "8bea414da58d7b2a",
        "name": "get files",
        "style": {
            "label": true
        },
        "nodes": [
            "796fcd0b58916758",
            "f7f33a86ce8d8fef",
            "11bec5f579b0b092",
            "4158be83830615bc",
            "c4f1d18b2c5d0eb7",
            "292d3caa5beb7778",
            "76f1fd55909c53ab",
            "5ec283479477abe6",
            "42505fe8cbd4e294",
            "b9c3655fb6f94525",
            "f6f04b7f237878d0",
            "862dc7094cc3702c",
            "cbd939371725f5c9",
            "db5662eacd7d9eb5",
            "1c2539fd446d3718",
            "2db2b245aa5eabb5",
            "29445d42adea56dc"
        ],
        "x": 3034,
        "y": 39,
        "w": 792,
        "h": 282
    },
    {
        "id": "aff5f6094780b487",
        "type": "group",
        "z": "8bea414da58d7b2a",
        "name": "actions with vectors",
        "style": {
            "label": true
        },
        "nodes": [
            "21cbda1bf24a2a69",
            "19823422f5fa86c1",
            "48094b3f0e2ee8d9",
            "f152600620f043bd",
            "962290bc68cb0b29",
            "3ce9a2870ef10866",
            "14f30a7985cc31c8",
            "4bfdfc1b314f7faa",
            "c19961b743cde705",
            "20ef169512cdd410",
            "f033b92e5ba13fcc",
            "8444301221890904",
            "d36889816ac0fe8e",
            "cf4156d5c447a16c",
            "9b5d8966c49993cd",
            "5a9cf18af75e3c0b",
            "5582346294319529",
            "cd48cc7a92b2a3d1",
            "bfd25775c6570faa",
            "d92184e6adc057c5",
            "d648ea43ba5a7657",
            "8c5c228aa9202f2b",
            "5bb720dc3ef56b7a",
            "99ad91f7fb16dfbc",
            "718ebd07aa298058",
            "5a3203eb955fd7d9",
            "c99c1f560bd3c907",
            "06b21e1c324bcb90",
            "60fcf811aaa47983",
            "29f355cc5c5a2756",
            "991728e9094bd66f",
            "73421b0edc8be468",
            "c2b008a8e03aea46",
            "d101f0224434fdea",
            "ca416f1b98beabd4",
            "a174c982a35eeae3",
            "9799e4664d3f7445",
            "f722a9741c9e9a40",
            "9da53257cf02584a",
            "461f1e55f3127c0b",
            "a2236acc5c0ac9fa",
            "0e89fb615ad470a3",
            "7a196d148fa3944d",
            "314c13476ffcf083",
            "93f9cbe5556410cd",
            "83022b358d68b77a",
            "d647afa660efae56",
            "d44b447e97418396",
            "9a642809df0b280d",
            "69693ac612bcb960",
            "0f924979525228d5",
            "3265f7c71d2632ab",
            "6190e70b904db5ed",
            "a1eb048e669efd8b"
        ],
        "x": 1714,
        "y": 39,
        "w": 1292,
        "h": 882
    },
    {
        "id": "cbd9c53fe26c3884",
        "type": "group",
        "z": "c8208e6a65d3c2af",
        "name": "telegram",
        "style": {
            "stroke": "#0070c0",
            "fill": "#bfdbef",
            "label": true
        },
        "nodes": [
            "666747ce63dfca18",
            "82e139d665440e8d",
            "a71a7acbd224bbc2",
            "baf7420b5b216cc2",
            "ba67b269c046e330",
            "8e058063d7977bdc",
            "6bcf93306278ae07",
            "1d797e0280d34dfb",
            "991562c24c1dbb8a",
            "0177e3aab7653e72",
            "44b3fdac09e09d2a",
            "db7c93f50d03cd4e",
            "135c90e6ec2e17f6",
            "77c7e75eb1854049",
            "1043346252c517a7",
            "7c1bf4b5923a9948",
            "d1fe775ad04641c1",
            "28c49149129d34ef",
            "78726ae519ab086a",
            "0b1926129388787b",
            "1b678c07805e900a",
            "411ca984487686ba",
            "588935d38b66c7b2",
            "762d9f30ef250e1b",
            "6fae5298f072ae66",
            "70d89be8294e4cc1",
            "e288b3035af24eaa",
            "59f43ba9fea18da2",
            "8335934ae0775bcc",
            "079317a7798ae7d0",
            "483948c77608cd63",
            "7195074bdb1b3509",
            "c79f68ae78c2fa0a",
            "f5d2d824f63b0eed",
            "1c79434061d7ff76",
            "9406da99327c9644",
            "681ed7fd92333081",
            "d9ec1bb17c6cb2e5",
            "03eaa5c76a7cc0b0",
            "62ddf71e3259e377",
            "c1577d630be65884",
            "9fc1615f16cc61ed",
            "8fe93679b9f619bc",
            "42c541d584f35255",
            "b5149a289a574835",
            "2037f13cdb05275d",
            "5c39762c2eac8a7e",
            "569bafc9227ab6cd",
            "d10542b05ef1f56d",
            "ef767d928767cb70",
            "17c46e8b98657bce",
            "0b18dada9196baa4",
            "222395ae69864297",
            "c9fb5769ca6ccbec",
            "47c066e4018176fa",
            "09abf79dd626bde6",
            "9577f9202c890213",
            "9a29fe13cdb79569",
            "fe0b23306d0e87cf",
            "a83edc2636c90edd",
            "6e9040ac1662afc8",
            "9e6e49cced02e6c0",
            "de4df51e641b1f2d",
            "f7d336beb3bb2ce7",
            "fe7802ec805d07bd"
        ],
        "x": 34,
        "y": 179,
        "w": 2642,
        "h": 702
    },
    {
        "id": "7ce0f5d37c531784",
        "type": "group",
        "z": "8bea414da58d7b2a",
        "name": "Divide file proces",
        "style": {
            "stroke": "#0070c0",
            "label": true,
            "color": "#92d04f"
        },
        "nodes": [
            "38078d4521bd2654",
            "3260737fa16542db",
            "4bb9c7b82b1bedac",
            "a6432e2120d18a72",
            "dd4341b099b6c43b",
            "bc1ddb60e7ba20b4",
            "0ff19f9d39e738a8",
            "525bb633cc44c263",
            "3fa09efefbec581a",
            "9d6a0a67613cb9dd",
            "9b7638008790cf33",
            "f2d00448b92f52ab",
            "1577d5b3d256df56",
            "576cadf9d8acf893",
            "e7b9e2966ec9a530",
            "cc8d16bafb9ce20b",
            "0cd095660d72aa7b",
            "beb52d2cfee001bd",
            "bcf34a0e1dafbf59",
            "b4d6a94b71d62b66",
            "bb3b0def28dfa3ab",
            "5beab8f0741449f2",
            "5df5b12baaeb4642",
            "488f7c35727984eb",
            "a9268935b3c53447",
            "cb28fee928d8243e",
            "dbd5eb04908ef666",
            "a1670647af3c537e",
            "f7a921a1fdc52072",
            "5ef968aee91d6cb8",
            "9d3a3bd6261e69f7",
            "75e116bf63574213",
            "a54f017ce67d1c90",
            "01e9e039f4f03cc5",
            "65e85721599c7e36",
            "b16acac646f8c1a1",
            "52e8e4a529e9ea4c",
            "c0c85d0a428f6025",
            "d8e85292b920695a",
            "bd7768c1acd036b8",
            "40fd41773ef13c29",
            "6d58fa04eae60b9a",
            "787092111a0fe528",
            "62541437b715dd0c",
            "141e0fb9f85a2535",
            "8397a151d3c25458",
            "9ba826dcc38ae118",
            "3f0f0ff828bec701",
            "4453f7534b49020a",
            "96f05ecc5dd200b4",
            "fe443544d5884010",
            "867d3778dcfe053a",
            "a3a245f7e0af4a0c",
            "47578350c357cafb",
            "e8dd5a3cef19bc27",
            "49d631b883f016b9",
            "88ec2c91695ac6ae",
            "c2ba0116ea85ea24",
            "1e359ae0665bd358",
            "9759e1cf71d9ad17",
            "13c45d0b4d0d93c2",
            "dd2531395c7cd2e1",
            "661abc1c6fd76083",
            "0750d093421cd48f",
            "72d36a332da3a93e",
            "f83c02efeeaef247",
            "f86157e201cac1a7",
            "6250a3895597130c",
            "6ca28a2d34f1cbca"
        ],
        "x": 34,
        "y": 1019,
        "w": 1272,
        "h": 1122
    },
    {
        "id": "911c1ee2586e9d4d",
        "type": "group",
        "z": "8bea414da58d7b2a",
        "name": "Save to pinecone",
        "style": {
            "label": true
        },
        "nodes": [
            "447d219e04f5c4e9",
            "7be5a588bfe35ac5",
            "6cb8466c8d27b038",
            "0dd7f5e7c3f02753",
            "b453ce1aa8eb3e23",
            "6f43f46c6d6627e4",
            "fca11faee5518dfa",
            "96bc55efbe1eda75",
            "690ac56690a13aa4",
            "63d687c22b99e9d5",
            "b2634835a69a4769",
            "ed63a752615547a1",
            "48971cd8ed706f55",
            "0f76e81b4c2a0190",
            "7b65309666385ff9",
            "1f0712b9ddfca967",
            "3136f28333abd3e3",
            "85caaba3697848f2"
        ],
        "x": 34,
        "y": 2179,
        "w": 1112,
        "h": 282
    },
    {
        "id": "7908a755f1520aa7",
        "type": "mongodb",
        "hostname": "${AIBOTDB-MONGO-HOST-NAME}",
        "topology": "direct",
        "connectOptions": "authSource=admin",
        "port": "27017",
        "db": "${AIBOTDB-MONGO-DB-NAME}",
        "name": ""
    },
    {
        "id": "4b07803a52e468f5",
        "type": "telegram bot",
        "botname": "{global.get('telegram').BOT_NAME}",
        "usernames": "",
        "chatids": "",
        "baseapiurl": "",
        "updatemode": "polling",
        "pollinterval": "300",
        "usesocks": false,
        "sockshost": "",
        "socksprotocol": "socks5",
        "socksport": "6667",
        "socksusername": "anonymous",
        "sockspassword": "",
        "bothost": "",
        "botpath": "",
        "localbotport": "8443",
        "publicbotport": "8443",
        "privatekey": "",
        "certificate": "",
        "useselfsignedcertificate": false,
        "sslterminated": false,
        "verboselogging": false
    },
    {
        "id": "666747ce63dfca18",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "check command",
        "func": "msg.fromTG1 = msg.payload\nmsg.fromTG = msg.payload\nmsg.history = {\n    requestText: msg.payload.content,\n    startDate: Date.now(),\n    type: 'telegram'\n}\n\nconst process_env = global.get(\"telegram\")\nconst PRIVATE_TG_CHAT = process_env.PRIVATE_TG_CHAT\n\nconst date = msg.originalMessage.date\n\nmsg.typing = `typing${date}`\nglobal.set(`typing${date}`, true)\n\nif (msg.originalMessage.chat.type === \"group\" && (msg.payload.content.includes(\"http://\") || msg.payload.content.includes(\"https://\") && (msg.payload.chatId === PRIVATE_TG_CHAT))) {\n\n    return msg.payload.content === '/start' ? [msg, null, null] : [null, null, msg];\n\n}\nelse if (msg.originalMessage.chat.type === \"group\") {\n    return msg.payload.content === '/start' ? [msg, null, null] : [null, msg, null]\n}\nelse if (msg.originalMessage.chat.type === \"private\") {\n    return msg.payload.content === '/start' ? [msg, null, null] : [null, msg, null]\n}\nelse {\n\n    return (msg.payload.type === 'message' &&\n        (msg.payload.content.includes(`@${global.get('process_env').BOT_NAME}`) || msg.payload.content === '/start')) ?\n        ((msg.payload.content === '/start') ? [msg, null, null] : [null, msg, null]) :\n        [null, null];\n}",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 420,
        "wires": [
            [
                "a71a7acbd224bbc2"
            ],
            [
                "baf7420b5b216cc2",
                "ba67b269c046e330"
            ],
            [
                "8e058063d7977bdc",
                "6bcf93306278ae07"
            ]
        ]
    },
    {
        "id": "a71a7acbd224bbc2",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "/start",
        "func": "msg.payload.content = global.get(\"telegram\").WELCOME;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 320,
        "wires": [
            [
                "991562c24c1dbb8a",
                "0177e3aab7653e72"
            ]
        ]
    },
    {
        "id": "5c39762c2eac8a7e",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "send to user from chat",
        "func": "const responseChatGPT = msg.statusCode < 400 ? msg.payload.choices[0].message.content : `statusCode: ${msg.statusCode} \\npayload: ${typeof msg.payload === 'string' ? msg.payload : msg.payload?.error.message}`\nlet history = global.get(`history${msg.fromTG.chatId}`) || [];\nmsg.history.answer= responseChatGPT\nconst date = msg.originalMessage.date\nmsg.payload = {\n    ...msg.fromTG,\n    content: responseChatGPT,\n    type: \"message\",\n}\n\nglobal.set(`typing${date}`, undefined)\n\n return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1940,
        "y": 400,
        "wires": [
            [
                "0b18dada9196baa4",
                "222395ae69864297"
            ]
        ]
    },
    {
        "id": "c1577d630be65884",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "to GPT",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1800,
        "y": 360,
        "wires": []
    },
    {
        "id": "1d797e0280d34dfb",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "fromTG",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 280,
        "y": 360,
        "wires": []
    },
    {
        "id": "569bafc9227ab6cd",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "from GPT",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1880,
        "y": 440,
        "wires": []
    },
    {
        "id": "0177e3aab7653e72",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "chek user",
        "func": "msg.url = env.get(\"nodered\") + `/checkUser`;\n\n\nmsg.payload = {\nchat_id: msg.originalMessage.from.id\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 260,
        "wires": [
            [
                "1b678c07805e900a",
                "411ca984487686ba"
            ]
        ]
    },
    {
        "id": "1b678c07805e900a",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "query",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 910,
        "y": 260,
        "wires": [
            [
                "59f43ba9fea18da2",
                "411ca984487686ba"
            ]
        ]
    },
    {
        "id": "59f43ba9fea18da2",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "save/update",
        "func": "if(msg.payload.length > 0){\n   return[null,msg]\n}\n\nelse{\n    msg.method=\"POST\"\n    msg.url = env.get(\"nodered\") +`/saveUser`;\n    msg.payload = {\n        first_name: msg.originalMessage.from.first_name ? msg.originalMessage.from.first_name :'',\n        last_name: msg.originalMessage.from.last_name ? msg.originalMessage.from.last_name : '',\n        username: msg.originalMessage.from.username,\n        chat_id: msg.originalMessage.from.id,\n        language_code: msg.originalMessage.from.language_code,\n        type: 'telegram'\n    }\n    \nreturn[msg,null]\n}\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 260,
        "wires": [
            [
                "483948c77608cd63",
                "411ca984487686ba"
            ],
            []
        ]
    },
    {
        "id": "483948c77608cd63",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "method": "use",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1290,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "c9fb5769ca6ccbec",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "save history ",
        "func": "msg.history.endDate = Date.now()\nmsg.history.chat_id = msg.originalMessage.from.id\nmsg.history.user_name = msg.originalMessage.from.username\nmsg.payload = msg.history\nmsg.url = env.get(\"nodered\") + `/saveUserMessage`;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2400,
        "y": 380,
        "wires": [
            [
                "09abf79dd626bde6",
                "47c066e4018176fa"
            ]
        ]
    },
    {
        "id": "09abf79dd626bde6",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 2580,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "47c066e4018176fa",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "debug 403",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2390,
        "y": 320,
        "wires": []
    },
    {
        "id": "222395ae69864297",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "debug 404",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2150,
        "y": 420,
        "wires": []
    },
    {
        "id": "f5d2d824f63b0eed",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "to P",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1470,
        "y": 460,
        "wires": []
    },
    {
        "id": "d1fe775ad04641c1",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "Get Link Info",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 590,
        "y": 700,
        "wires": [
            [
                "70d89be8294e4cc1",
                "e288b3035af24eaa"
            ]
        ]
    },
    {
        "id": "6bcf93306278ae07",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "func": "let regex = /(http[s]?:\\/\\/[^\\s]+)/g;\n\nmsg.collection = \"knowlegebase\"\n\nvar result = msg.payload.content.match(regex);\nmsg.payload.link = result[0];\n\nmsg.current_link = result[0];\nmsg.url = result[0];\n\nif(msg._id){\n    msg._id = objectid(msg._id)\n    node.warn(\"1\")\n    return [msg,null]\n    \n}else{\n    msg._id = objectid();\n    msg.payload = {\n        _id: msg._id,\n        name: msg.payload.name,\n        file: msg.payload.file,\n        url: msg.payload.link,\n        vectors: [],\n        status: \"pending\",\n        deleted: false,\n        createdAt: new Date()\n    };\n    node.warn(\"2\")\n    return [null,msg]\n}\n\n\n\n\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 380,
        "y": 720,
        "wires": [
            [
                "d1fe775ad04641c1",
                "28c49149129d34ef"
            ],
            [
                "d1fe775ad04641c1",
                "78726ae519ab086a",
                "0b1926129388787b"
            ]
        ]
    },
    {
        "id": "079317a7798ae7d0",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "Create Pages",
        "func": "msg.filename = \"/data/\" + msg.current_link.split(\"://\")[1].replace(/\\//g, '_') + \".txt\";\nlet str = msg.payload.text;\nmsg.ll = msg.payload.text.length;\n\nfunction test2(str, index) {\n    const result = [];\n\n    while (index < str.length) {\n        let endIndex = index + 500 <= str.length ? index + 500 : str.length;\n        let sub = str.slice(index, endIndex);\n        let last = sub.lastIndexOf(\".\");\n\n        if (last !== -1) {\n            result.push({\n                \"text\": str.slice(index, index + last + 1)\n            });\n            index += last + 1;\n        } else {\n            result.push({\n                \"text\": str.slice(index, endIndex)\n            });\n            index = endIndex;\n        }\n    }\n\n    return result;\n}\n\nmsg.pages = test2(str, 0);\nnode.warn(msg.pages)\nmsg.array = msg.pages;\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 960,
        "y": 700,
        "wires": [
            [
                "c79f68ae78c2fa0a"
            ]
        ]
    },
    {
        "id": "70d89be8294e4cc1",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "Scrape",
        "func": "\nconst { extractor } = unfluff;\n\nmsg.payload = unfluff(msg.payload);\nmsg.payload.originalSourceUrl = msg.responseUrl;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "unfluff",
                "module": "unfluff"
            }
        ],
        "x": 780,
        "y": 700,
        "wires": [
            [
                "079317a7798ae7d0"
            ]
        ]
    },
    {
        "id": "e288b3035af24eaa",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "debug 410",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 790,
        "y": 660,
        "wires": []
    },
    {
        "id": "ef767d928767cb70",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "ToPinecone",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1410,
        "y": 800,
        "wires": []
    },
    {
        "id": "9406da99327c9644",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "post",
        "func": "msg.collection = \"knowlegebase\"\n\nmsg.query = { \"_id\": msg._id }\nmsg.payload = {\n    \"$push\": {\n        \"vectors\": {\n            id: msg.vector_id,\n            metadata: msg.toSave,\n        }\n    }\n\n};\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1550,
        "y": 840,
        "wires": [
            [
                "9fc1615f16cc61ed"
            ]
        ]
    },
    {
        "id": "d10542b05ef1f56d",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "create vector",
        "func": "delete msg.filepath;\ndelete msg.filename;\n\n\nmsg.toSave = {\n   question: msg.payload.choices[0].message.content,\n   result: msg.text\n}\n\nmsg.OPENAI_API_KEY = global.get(\"process_env\").OPENAI_API;\nmsg.input = msg.toSave.result\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 840,
        "wires": [
            [
                "2037f13cdb05275d",
                "a83edc2636c90edd"
            ]
        ]
    },
    {
        "id": "d9ec1bb17c6cb2e5",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "the end",
        "func": "const date = msg.originalMessage.date\n// delete msg.payload\nglobal.set(`typing${date}`, undefined)\nmsg.payload = {\n    chatId: msg.fromTG1.chatId,\n    messageId: msg.fromTG1.messageId,\n    content: \"upload finish\",\n    type: \"message\",\n    date: msg.fromTG1.date\n}\n\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 720,
        "wires": [
            [
                "42c541d584f35255"
            ]
        ]
    },
    {
        "id": "681ed7fd92333081",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "update knowlegebase",
        "func": "msg.collection = \"knowlegebase\"\n\nmsg.query = { \"_id\": msg._id }\nmsg.payload = {\n \n        $set: {\n            status: \"done\"\n        }\n    };\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1380,
        "y": 660,
        "wires": [
            [
                "8fe93679b9f619bc"
            ]
        ]
    },
    {
        "id": "db7c93f50d03cd4e",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "typing",
        "func": "msg.payload = {\n    chatId: msg.payload.chatId,\n    type: 'action',\n    content: \"typing\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 500,
        "wires": [
            [
                "588935d38b66c7b2"
            ]
        ]
    },
    {
        "id": "44b3fdac09e09d2a",
        "type": "delay",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 755,
        "y": 500,
        "wires": [
            [
                "baf7420b5b216cc2"
            ]
        ],
        "l": false
    },
    {
        "id": "7c1bf4b5923a9948",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "typing",
        "func": "msg.payload = {\n    chatId: msg.payload.chatId,\n    type: 'action',\n    content: \"upload_document\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 640,
        "wires": [
            [
                "6fae5298f072ae66"
            ]
        ]
    },
    {
        "id": "1043346252c517a7",
        "type": "delay",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 625,
        "y": 640,
        "wires": [
            [
                "8e058063d7977bdc"
            ]
        ],
        "l": false
    },
    {
        "id": "17c46e8b98657bce",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "debug 411",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1690,
        "y": 720,
        "wires": []
    },
    {
        "id": "2037f13cdb05275d",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "create VEC",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 800,
        "wires": []
    },
    {
        "id": "78726ae519ab086a",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 570,
        "y": 780,
        "wires": []
    },
    {
        "id": "28c49149129d34ef",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 390,
        "y": 680,
        "wires": []
    },
    {
        "id": "03eaa5c76a7cc0b0",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "create vector",
        "func": "delete msg.filepath;\ndelete msg.filename;\ndelete msg.text;\nconst process_env = global.get(\"process_env\")\nmsg.OPENAI_API_KEY = process_env.OPENAI_API\n\nmsg.text = msg.payload.text\n  msg.messages= [\n    { \"role\": \"system\", \"content\": `create me the questionfor this text : ${msg.payload.text}`},\n     \n    ]\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 840,
        "wires": [
            [
                "b5149a289a574835",
                "2037f13cdb05275d"
            ]
        ]
    },
    {
        "id": "1c79434061d7ff76",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "create vector",
        "func": "delete msg.filepath;\ndelete msg.filename;\ndelete msg.text;\nconst process_env = global.get(\"process_env\")\n// msg.OPENAI_API_KEY = process_env.OPENAI_API\nmsg.model ='gpt-3.5-turbo-16k'\nconst content = msg.fromTG.content.includes(`@${global.get('telegram').BOT_NAME}`) ? msg.fromTG.content.replace(`@${global.get('telegram').BOT_NAME}`, '') : msg.fromTG.content;\n\nif (msg.messagesLast.length>0){\n  msg.messages = [\n    { \"role\": \"system\", \"content\": global.get(\"process_env\").PROMPT + msg.payload.matches[0].metadata.result + \", \" + msg.payload.matches[1].metadata.result + ` This 3 previous messages on chat for you to understand context: ${JSON.stringify(msg.messagesLast) }`},\n    { \"role\": \"user\", \"content\": content }\n  ]\n}\nelse{\n  msg.messages = [\n    { \"role\": \"system\", \"content\": global.get(\"process_env\").PROMPT + msg.payload.matches[0].metadata.result + \", \" + msg.payload.matches[1].metadata.result },\n    { \"role\": \"user\", \"content\": content }\n  ]\n}\n\n\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1650,
        "y": 400,
        "wires": [
            [
                "62ddf71e3259e377",
                "c1577d630be65884"
            ]
        ]
    },
    {
        "id": "0b1926129388787b",
        "type": "link call",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 590,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "9fc1615f16cc61ed",
        "type": "link call",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1720,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "8fe93679b9f619bc",
        "type": "link call",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1580,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "66763628722735fb",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "confirm token",
        "func": "msg.payload = msg.payload[\"hub.challenge\"]\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 980,
        "wires": [
            [
                "4816299b040f2829",
                "16b172fced11b810"
            ]
        ]
    },
    {
        "id": "4816299b040f2829",
        "type": "http response",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 550,
        "y": 980,
        "wires": []
    },
    {
        "id": "83503c945cbb4c4d",
        "type": "http in",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "",
        "url": "/messangerBot",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 1100,
        "wires": [
            [
                "caa3ef679b43edbc",
                "96831d7c1dcb47fa"
            ]
        ]
    },
    {
        "id": "caa3ef679b43edbc",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "check payload",
        "func": "if (!msg.payload.entry[0].messaging[0].message.is_echo){\n    msg.old = msg.payload\n    msg.payload={\n        content: msg.payload.entry[0].messaging[0].message.text\n    } \n    msg.OPENAI_API_KEY = global.get(\"process_env\").OPENAI_API;\n    msg.input = msg.payload.content;\n\nreturn [null,msg];\n} else{\nreturn [msg, null];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 1100,
        "wires": [
            [
                "1962e32d56dd9f06"
            ],
            [
                "cc2767e9ed1dcea1",
                "1962e32d56dd9f06",
                "7f89c6e66b7532de"
            ]
        ]
    },
    {
        "id": "1962e32d56dd9f06",
        "type": "http response",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 590,
        "y": 1080,
        "wires": []
    },
    {
        "id": "fb2196741549bce1",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "send response",
        "func": "msg.answer = msg.payload.choices[0].message.content\nconst process_env = global.get(\"META\")\nmsg.url = process_env.META_URL\nmsg.token = `Bearer ${process_env.META_TOKEN}`\n\nconst senderID = msg.old.entry[0].messaging[0].sender.id;\nconst recipientID = msg.old.entry[0].messaging[0].recipient.id;\nmsg.payload={\n    \n    \"recipient\": {\n        \"id\": senderID\n    },\n    \"messaging_type\": \"RESPONSE\",\n        \"message\": {\n            \"text\": msg.payload.choices[0].message.content,\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 1120,
        "wires": [
            [
                "650845245a602f3c",
                "ff6b626110f2f6ec"
            ]
        ]
    },
    {
        "id": "650845245a602f3c",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "application/json",
                "valueValue": ""
            },
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "msg",
                "valueValue": "token"
            }
        ],
        "x": 1365,
        "y": 1120,
        "wires": [
            [
                "34e51cbe5a4a131a",
                "edb73f62309898e3"
            ]
        ],
        "l": false
    },
    {
        "id": "cc2767e9ed1dcea1",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "chek user",
        "func": "msg.url = env.get(\"nodered\") + `/checkUser`;\nconst senderID = msg.old.entry[0].messaging[0].sender.id;\nmsg.payload = {\n    chat_id: Number(senderID) \n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 1040,
        "wires": [
            [
                "9432065d3374bca1"
            ]
        ]
    },
    {
        "id": "9432065d3374bca1",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "query",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 730,
        "y": 1040,
        "wires": [
            [
                "baefdb1424cd8868",
                "752a70a77c9750d8"
            ]
        ]
    },
    {
        "id": "baefdb1424cd8868",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "save/update",
        "func": "if (msg.payload.length > 0) {\n    return [null, msg]\n}\n\nelse {\n    const senderID = msg.old.entry[0].messaging[0].sender.id;\n    msg.method = \"POST\"\n    msg.url = env.get(\"nodered\") + `/saveUser`;\n    msg.payload = {\n        chat_id: Number(senderID) ,\n        user_name: Number(senderID) ,\n        type: 'messanger'\n    }\n\n    return [msg, null]\n}\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 1040,
        "wires": [
            [
                "62ee4ed8b0807623",
                "752a70a77c9750d8"
            ],
            []
        ]
    },
    {
        "id": "62ee4ed8b0807623",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "",
        "method": "use",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1070,
        "y": 1040,
        "wires": [
            []
        ]
    },
    {
        "id": "34e51cbe5a4a131a",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "save history ",
        "func": "if (msg.statusCode === 200) {\n    msg.history = {}\n    msg.history.requestText = msg.old.entry[0].messaging[0].message.text\n    msg.history.answer = msg.answer\n    msg.history.date = Date.now()\n    const senderID = msg.old.entry[0].messaging[0].sender.id;\n    msg.history.chat_id = Number(senderID) \n    msg.history.user_name = Number(senderID) \n    msg.history.type = 'messanger' \n    msg.payload = msg.history\n    msg.url = env.get(\"nodered\") + `/saveUserMessage`;\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 1120,
        "wires": [
            [
                "ed51dc47c043feec"
            ]
        ]
    },
    {
        "id": "ed51dc47c043feec",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1585,
        "y": 1120,
        "wires": [
            []
        ],
        "l": false
    },
    {
        "id": "ab5370a9f61f6320",
        "type": "http in",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "",
        "url": "/messangerBot",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 980,
        "wires": [
            [
                "66763628722735fb"
            ]
        ]
    },
    {
        "id": "16b172fced11b810",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "debug 454",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 980,
        "wires": []
    },
    {
        "id": "d4884dc3f42c77e8",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "debug 455",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 1160,
        "wires": []
    },
    {
        "id": "ff6b626110f2f6ec",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "debug 456",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1370,
        "y": 1160,
        "wires": []
    },
    {
        "id": "edb73f62309898e3",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "debug 457",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1470,
        "y": 1080,
        "wires": []
    },
    {
        "id": "9f8e791c6b9a642c",
        "type": "http in",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "",
        "url": "/whatsApp",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 1420,
        "wires": [
            [
                "a5f2c2ab21518eb7"
            ]
        ]
    },
    {
        "id": "a5f2c2ab21518eb7",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "check payload",
        "func": "node.warn(msg.payload.entry[0].changes[0].value.messages);\n// const date = msg.payload.entry[0].id\n// msg.typing = `typing${date}`\n// global.set(`typing${date}`, true)\nif(msg.payload.entry[0].changes[0].value.messages){\n    msg.old = msg.payload\n    msg.payload={\n        content: msg.old.entry[0].changes[0].value.messages[0].text.body\n    } \n    msg.OPENAI_API_KEY = global.get(\"process_env\").OPENAI_API;\n    msg.input = msg.payload.content;\nreturn [msg,msg];\n} else{\nreturn [msg, null];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 1420,
        "wires": [
            [
                "3e397bf3b91a5907",
                "db7d2c1d52f05bf9"
            ],
            [
                "a8182a7e59ef243a",
                "8bddac81611d93ed"
            ]
        ]
    },
    {
        "id": "3e397bf3b91a5907",
        "type": "http response",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 530,
        "y": 1400,
        "wires": []
    },
    {
        "id": "72c0f7facf326866",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "send response",
        "func": "msg.answer = msg.payload.choices[0].message.content\nconst process_env = global.get(\"WHATSAPP\")\nmsg.url = `${process_env.WHATSAPP_URL}`\nmsg.token = `Bearer ${process_env.WHATSAPP_TOKEN}`\nmsg.payload = {\n    \"messaging_product\": \"whatsapp\", \"to\": msg.old.entry[0].changes[0].value.contacts[0].wa_id, \"type\": \"text\", \"text\": { \"body\": msg.payload.choices[0].message.content, preview_url: false}\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 1440,
        "wires": [
            [
                "0a2e4892c4e243c2",
                "7917d687a61f2409"
            ]
        ]
    },
    {
        "id": "0a2e4892c4e243c2",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "application/json",
                "valueValue": ""
            },
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "msg",
                "valueValue": "token"
            }
        ],
        "x": 1430,
        "y": 1440,
        "wires": [
            [
                "201d52af1c42d0e7"
            ]
        ]
    },
    {
        "id": "0e20c35adb5cc171",
        "type": "http in",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "",
        "url": "/whatsApp",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 1540,
        "wires": [
            [
                "09ed5a18c5e2572d",
                "602464edb3541c8a"
            ]
        ]
    },
    {
        "id": "09ed5a18c5e2572d",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "webhook",
        "func": "msg.payload = msg.payload[\"hub.challenge\"]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 1540,
        "wires": [
            [
                "56f20785fda555c8"
            ]
        ]
    },
    {
        "id": "602464edb3541c8a",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "debug 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 340,
        "y": 1580,
        "wires": []
    },
    {
        "id": "56f20785fda555c8",
        "type": "http response",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 510,
        "y": 1540,
        "wires": []
    },
    {
        "id": "a8182a7e59ef243a",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "chek user",
        "func": "msg.url = env.get(\"nodered\") + `/checkUser`;\n\nmsg.payload = {\n    chat_id: Number(msg.old.entry[0].changes[0].value.contacts[0].wa_id)\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 1320,
        "wires": [
            [
                "f08426907c45fac4"
            ]
        ]
    },
    {
        "id": "f08426907c45fac4",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "query",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 710,
        "y": 1320,
        "wires": [
            [
                "f5be53459c334004",
                "cd6205f05718e984"
            ]
        ]
    },
    {
        "id": "f5be53459c334004",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "save/update",
        "func": "if (msg.payload.length > 0) {\n    return [null, msg]\n}\n\nelse {\n    msg.method = \"POST\"\n    msg.url = env.get(\"nodered\") + `/saveUser`;\n    msg.payload = {\n        chat_id: Number(msg.old.entry[0].changes[0].value.contacts[0].wa_id),\n        user_name: msg.old.entry[0].changes[0].value.contacts[0].profile.name,\n        type: 'whatsApp'\n    }\n\n    return [msg, null]\n}\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 1320,
        "wires": [
            [
                "8855b83b6672aa0a"
            ],
            []
        ]
    },
    {
        "id": "8855b83b6672aa0a",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "",
        "method": "use",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1050,
        "y": 1320,
        "wires": [
            []
        ]
    },
    {
        "id": "201d52af1c42d0e7",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "save history ",
        "func": "if (msg.statusCode === 200) {\n    msg.history = {}\n    msg.history.requestText = msg.old.entry[0].changes[0].value.messages[0].text.body\n    msg.history.answer = msg.answer\n    msg.history.date = Date.now()\n    msg.history.type = 'whatsApp' \n    msg.history.chat_id = Number(msg.old.entry[0].changes[0].value.contacts[0].wa_id)\n    msg.history.user_name = msg.old.entry[0].changes[0].value.contacts[0].profile.name\n    msg.payload = msg.history\n    msg.url = env.get(\"nodered\") + `/saveUserMessage`;\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1590,
        "y": 1440,
        "wires": [
            [
                "12444a1783ffbd19"
            ]
        ]
    },
    {
        "id": "12444a1783ffbd19",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1750,
        "y": 1440,
        "wires": [
            []
        ]
    },
    {
        "id": "83e70ce5a4defd36",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "debug 445",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1390,
        "y": 1520,
        "wires": []
    },
    {
        "id": "cd6205f05718e984",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "debug 446",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 890,
        "y": 1360,
        "wires": []
    },
    {
        "id": "db7d2c1d52f05bf9",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "debug 450",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 550,
        "y": 1360,
        "wires": []
    },
    {
        "id": "7917d687a61f2409",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "40d09c6e6df96683",
        "name": "debug 453",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1430,
        "y": 1400,
        "wires": []
    },
    {
        "id": "96831d7c1dcb47fa",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "debug 458",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 370,
        "y": 1140,
        "wires": []
    },
    {
        "id": "dba0f7ab6e4b919d",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "confirm token",
        "func": "msg.payload = msg.payload[\"hub.challenge\"]\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 1720,
        "wires": [
            [
                "9901b6a7a9032582",
                "cf9a6ba45df67d83"
            ]
        ]
    },
    {
        "id": "9901b6a7a9032582",
        "type": "http response",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 550,
        "y": 1720,
        "wires": []
    },
    {
        "id": "243611d5c2db94f9",
        "type": "http in",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "",
        "url": "/instagramBot",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 1840,
        "wires": [
            [
                "92213ea20ab9b1ef",
                "a83a80258217806d"
            ]
        ]
    },
    {
        "id": "92213ea20ab9b1ef",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "check payload",
        "func": "node.warn(msg.payload.entry[0]?.messaging[0]?.message?.is_echo);\nif (msg.payload.entry[0]?.messaging && msg.payload.entry[0]?.messaging[0]?.message?.is_echo === undefined){\n\n    msg.old = msg.payload\n    msg.payload={\n        content: msg.payload.entry[0].messaging[0].message.text\n    }\n\n    msg.OPENAI_API_KEY = global.get(\"process_env\").OPENAI_API;\n    msg.input = msg.payload.content;\nreturn [null,msg];\n}\n else{\nreturn [msg, null];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 1840,
        "wires": [
            [
                "8ba088e5adc829b1"
            ],
            [
                "b052742bc3945ec3",
                "8ba088e5adc829b1",
                "8bbbf3db55d9fe93"
            ]
        ]
    },
    {
        "id": "8ba088e5adc829b1",
        "type": "http response",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 590,
        "y": 1840,
        "wires": []
    },
    {
        "id": "627bfa9d93208c59",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "send response",
        "func": "msg.answer = msg.payload.choices[0].message.content\nconst process_env = global.get(\"META\")\nmsg.url = process_env.META_URL\nmsg.token = `Bearer ${process_env.META_TOKEN}`\n\nmsg.senderID = msg.old.entry[0].messaging[0].sender.id;\n\nmsg.payload={\n    \n    \"recipient\": {\n        \"id\": msg.senderID\n    },\n    \"messaging_type\": \"RESPONSE\",\n        \"message\": {\n            \"text\": msg.payload.choices[0].message.content,\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1220,
        "y": 1900,
        "wires": [
            [
                "a8cba982ca4f9115",
                "504f2332759ef484"
            ]
        ]
    },
    {
        "id": "a8cba982ca4f9115",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "application/json",
                "valueValue": ""
            },
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "msg",
                "valueValue": "token"
            }
        ],
        "x": 1390,
        "y": 1900,
        "wires": [
            [
                "bcf5974f2cef9cba",
                "3e64811eeb98af3f"
            ]
        ]
    },
    {
        "id": "b052742bc3945ec3",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "chek user",
        "func": "msg.url = env.get(\"nodered\") + `/checkUser`;\nconst senderID = msg.old.entry[0].messaging[0].sender.id;\nmsg.payload = {\n    chat_id: Number(senderID) \n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 1780,
        "wires": [
            [
                "5eac3e8dfce81d88"
            ]
        ]
    },
    {
        "id": "5eac3e8dfce81d88",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "query",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 730,
        "y": 1780,
        "wires": [
            [
                "51b3787563ee1a38",
                "beeff7858c8e1db1"
            ]
        ]
    },
    {
        "id": "51b3787563ee1a38",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "save/update",
        "func": "if (msg.payload.length > 0) {\n    return [null, msg]\n}\n\nelse {\n    const senderID = msg.old.entry[0].messaging[0].sender.id;\n    msg.method = \"POST\"\n    msg.url = env.get(\"nodered\") + `/saveUser`;\n    msg.payload = {\n        chat_id: Number(senderID),\n        user_name: Number(senderID),\n        type: 'instagram' \n    }\n\n    return [msg, null]\n}\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 1780,
        "wires": [
            [
                "693d79d4423ce154",
                "beeff7858c8e1db1"
            ],
            []
        ]
    },
    {
        "id": "693d79d4423ce154",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "",
        "method": "use",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1070,
        "y": 1780,
        "wires": [
            []
        ]
    },
    {
        "id": "bcf5974f2cef9cba",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "save history ",
        "func": "if (msg.statusCode === 200) {\n    msg.history = {}\n    msg.history.requestText = msg.old.entry[0].messaging[0].message.text\n    msg.history.answer = msg.answer\n    msg.history.date = Date.now()\n    msg.history.chat_id = Number(msg.senderID) \n    msg.history.user_name = Number(msg.senderID) \n    msg.history.type = 'instagram' \n    msg.payload = msg.history\n    msg.url = env.get(\"nodered\") + `/saveUserMessage`;\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1550,
        "y": 1900,
        "wires": [
            [
                "99caac847f5df515",
                "3e64811eeb98af3f"
            ]
        ]
    },
    {
        "id": "99caac847f5df515",
        "type": "http request",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1750,
        "y": 1900,
        "wires": [
            []
        ]
    },
    {
        "id": "fbd6146e89b1d42d",
        "type": "http in",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "",
        "url": "/instagramBot",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 1720,
        "wires": [
            [
                "dba0f7ab6e4b919d"
            ]
        ]
    },
    {
        "id": "cf9a6ba45df67d83",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "debug 459",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 1720,
        "wires": []
    },
    {
        "id": "12c72333898f97b7",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "debug 460",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 830,
        "y": 1860,
        "wires": []
    },
    {
        "id": "504f2332759ef484",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "debug 461",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1370,
        "y": 1940,
        "wires": []
    },
    {
        "id": "3e64811eeb98af3f",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "debug 462",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1570,
        "y": 1860,
        "wires": []
    },
    {
        "id": "a83a80258217806d",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "debug 463",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 370,
        "y": 1800,
        "wires": []
    },
    {
        "id": "752a70a77c9750d8",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "debug 464",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 980,
        "wires": []
    },
    {
        "id": "411ca984487686ba",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "to GPT",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 220,
        "wires": []
    },
    {
        "id": "beeff7858c8e1db1",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "debug 465",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 930,
        "y": 1820,
        "wires": []
    },
    {
        "id": "82e139d665440e8d",
        "type": "telegram receiver",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "bot": "4b07803a52e468f5",
        "saveDataDir": "",
        "filterCommands": false,
        "x": 150,
        "y": 420,
        "wires": [
            [
                "1d797e0280d34dfb",
                "666747ce63dfca18"
            ],
            []
        ]
    },
    {
        "id": "991562c24c1dbb8a",
        "type": "telegram sender",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "bot": "4b07803a52e468f5",
        "haserroroutput": false,
        "outputs": 1,
        "x": 770,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "0b18dada9196baa4",
        "type": "telegram sender",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "bot": "4b07803a52e468f5",
        "haserroroutput": true,
        "outputs": 2,
        "x": 2150,
        "y": 360,
        "wires": [
            [
                "c9fb5769ca6ccbec",
                "47c066e4018176fa"
            ],
            [
                "47c066e4018176fa"
            ]
        ]
    },
    {
        "id": "588935d38b66c7b2",
        "type": "telegram sender",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "bot": "4b07803a52e468f5",
        "haserroroutput": false,
        "outputs": 1,
        "x": 675,
        "y": 500,
        "wires": [
            [
                "44b3fdac09e09d2a"
            ]
        ],
        "l": false
    },
    {
        "id": "6fae5298f072ae66",
        "type": "telegram sender",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "bot": "4b07803a52e468f5",
        "haserroroutput": false,
        "outputs": 1,
        "x": 565,
        "y": 640,
        "wires": [
            [
                "1043346252c517a7"
            ]
        ],
        "l": false
    },
    {
        "id": "42c541d584f35255",
        "type": "telegram sender",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "bot": "4b07803a52e468f5",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1510,
        "y": 720,
        "wires": [
            [
                "17c46e8b98657bce"
            ]
        ]
    },
    {
        "id": "c79f68ae78c2fa0a",
        "type": "array-loop",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "key": "count",
        "keyType": "msg",
        "reset": false,
        "resetValue": "value-null",
        "array": "array",
        "arrayType": "msg",
        "x": 1160,
        "y": 700,
        "wires": [
            [
                "681ed7fd92333081",
                "d9ec1bb17c6cb2e5"
            ],
            [
                "03eaa5c76a7cc0b0"
            ]
        ]
    },
    {
        "id": "baf7420b5b216cc2",
        "type": "while-loop",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "condi": "global.get(`${msg.typing}`) === true",
        "limit": true,
        "limitTime": "100",
        "time": "counter",
        "timeType": "msg",
        "x": 635,
        "y": 440,
        "wires": [
            [],
            [
                "db7c93f50d03cd4e"
            ]
        ],
        "l": false
    },
    {
        "id": "8e058063d7977bdc",
        "type": "while-loop",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "condi": "global.get(`${msg.typing}`) === true",
        "limit": true,
        "limitTime": "100",
        "time": "counter",
        "timeType": "msg",
        "x": 515,
        "y": 580,
        "wires": [
            [],
            [
                "7c1bf4b5923a9948"
            ]
        ],
        "l": false
    },
    {
        "id": "b5149a289a574835",
        "type": "openai-ubos",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "genarate answer",
        "model": "gpt-3.5-turbo",
        "temperature": 0.02,
        "max_tokens": 2000,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 830,
        "y": 840,
        "wires": [
            [
                "d10542b05ef1f56d"
            ]
        ]
    },
    {
        "id": "62ddf71e3259e377",
        "type": "openai-ubos",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "genarate unswer",
        "model": "gpt-3.5-turbo",
        "temperature": 0.02,
        "max_tokens": 2000,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 1775,
        "y": 400,
        "wires": [
            [
                "5c39762c2eac8a7e",
                "569bafc9227ab6cd"
            ]
        ],
        "l": false
    },
    {
        "id": "ba67b269c046e330",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "function 356",
        "func": "msg.payload={\n    chat_id: msg.originalMessage.from.id,\n    type: 'telegram'\n}\nmsg.sort={\n    _id: -1\n}\n\nmsg.collection = 'users_messages'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 400,
        "wires": [
            [
                "135c90e6ec2e17f6",
                "77c7e75eb1854049"
            ]
        ]
    },
    {
        "id": "135c90e6ec2e17f6",
        "type": "link call",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 770,
        "y": 400,
        "wires": [
            [
                "762d9f30ef250e1b"
            ]
        ]
    },
    {
        "id": "762d9f30ef250e1b",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "function 357",
        "func": "if(msg.payload.length>0){\n    msg.messagesLast= msg.payload.map((e)=> {\n        return{\n            bot: e.answer,\n            user: e.requestText\n        }\n    }).slice(0,3)\n    msg.OPENAI_API_KEY = global.get(\"process_env\").OPENAI_API;\n    msg.input = msg.fromTG.content.includes(`@${global.get('telegram').BOT_NAME}`) ? msg.fromTG.content.replace(`@${global.get('telegram').BOT_NAME}`, '') : msg.fromTG.content;\n    return msg;\n}\nelse{\n    msg.messagesLast=[]\n    msg.payload = msg.fromTG1\n    msg.OPENAI_API_KEY = global.get(\"process_env\").OPENAI_API;\n    msg.input = msg.fromTG.content.includes(`@${global.get('telegram').BOT_NAME}`) ? msg.fromTG.content.replace(`@${global.get('telegram').BOT_NAME}`, '') : msg.fromTG.content;\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 400,
        "wires": [
            [
                "8335934ae0775bcc",
                "9a29fe13cdb79569"
            ]
        ]
    },
    {
        "id": "77c7e75eb1854049",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "fromTG",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 780,
        "y": 360,
        "wires": []
    },
    {
        "id": "8335934ae0775bcc",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "fromTG",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1080,
        "y": 360,
        "wires": []
    },
    {
        "id": "7195074bdb1b3509",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "from P",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1470,
        "y": 360,
        "wires": []
    },
    {
        "id": "0c7d6e4b6b8d46cc",
        "type": "inject",
        "z": "c8208e6a65d3c2af",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 60,
        "wires": [
            [
                "75970c435748a436"
            ]
        ]
    },
    {
        "id": "a49735024ef22310",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "name": "fromTG",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 660,
        "y": 60,
        "wires": []
    },
    {
        "id": "75970c435748a436",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "name": "function 358",
        "func": "const vector = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n\nmsg.payload = {\n    name: global.get(\"process_env\").PIPECONE_INDEX,\n    \"topK\": 100,\n    \"includeMetadata\": true,\n    // \"includeValues\": true,\n    vector\n};\n\nmsg.PINECONE_API_KEY = global.get(\"process_env\").PIPECONE_API\nmsg.PINECONE_ENVIRONMENT = global.get(\"process_env\").PIPECONE_ENV\nmsg.PINECONE_BASE_URL = global.get(\"process_env\").PIPECONE_URL\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 100,
        "wires": [
            [
                "fb6f85bd1aeb6ae7"
            ]
        ]
    },
    {
        "id": "e7e15d4180b2138e",
        "type": "http in",
        "z": "c8208e6a65d3c2af",
        "name": "",
        "url": "/getVectors1",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 100,
        "wires": [
            [
                "75970c435748a436"
            ]
        ]
    },
    {
        "id": "a39f53db2b53d4b1",
        "type": "http response",
        "z": "c8208e6a65d3c2af",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 650,
        "y": 100,
        "wires": []
    },
    {
        "id": "9577f9202c890213",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "function 361",
        "func": "const vector = msg.payload.data[0].embedding\n\nmsg.payload = {\n    name: global.get(\"process_env\").PIPECONE_INDEX,\n    \"topK\": 2,\n    \"includeMetadata\": true,\n    vector\n};\n\nmsg.PINECONE_API_KEY = global.get(\"process_env\").PIPECONE_API\nmsg.PINECONE_ENVIRONMENT = global.get(\"process_env\").PIPECONE_ENV\nmsg.PINECONE_BASE_URL = global.get(\"process_env\").PIPECONE_URL\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 400,
        "wires": [
            [
                "f5d2d824f63b0eed",
                "f7d336beb3bb2ce7"
            ]
        ]
    },
    {
        "id": "9a29fe13cdb79569",
        "type": "openai-ubos",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "model": "text-embedding-ada-002",
        "temperature": 0.5,
        "max_tokens": 60,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 1120,
        "y": 400,
        "wires": [
            [
                "9577f9202c890213",
                "fe0b23306d0e87cf"
            ]
        ]
    },
    {
        "id": "fe0b23306d0e87cf",
        "type": "debug",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "fromTG",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1280,
        "y": 360,
        "wires": []
    },
    {
        "id": "6e9040ac1662afc8",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "function 363",
        "func": "const vector = msg.payload.data[0].embedding\nmsg.vector_id = objectid()\nmsg.payload = {\n    name: global.get(\"process_env\").PIPECONE_INDEX,\n    vectors: [{\n        id: msg.vector_id,\n        values: msg.payload.data[0].embedding,\n        metadata: msg.toSave\n    }]\n};\n\nmsg.PINECONE_API_KEY = global.get(\"process_env\").PIPECONE_API\nmsg.PINECONE_ENVIRONMENT = global.get(\"process_env\").PIPECONE_ENV\nmsg.PINECONE_BASE_URL = global.get(\"process_env\").PIPECONE_URL\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1295,
        "y": 840,
        "wires": [
            [
                "fe7802ec805d07bd"
            ]
        ],
        "l": false
    },
    {
        "id": "a83edc2636c90edd",
        "type": "openai-ubos",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "model": "text-embedding-ada-002",
        "temperature": 0.5,
        "max_tokens": 60,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 1180,
        "y": 840,
        "wires": [
            [
                "6e9040ac1662afc8"
            ]
        ]
    },
    {
        "id": "9e6e49cced02e6c0",
        "type": "inject",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 780,
        "y": 740,
        "wires": [
            [
                "de4df51e641b1f2d"
            ]
        ]
    },
    {
        "id": "de4df51e641b1f2d",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "function 364",
        "func": " msg.payload={\n     choices:[{\n         message:{\n             content:'test'\n         }\n     }]\n }\nmsg.text='test'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 780,
        "wires": [
            [
                "2037f13cdb05275d",
                "d10542b05ef1f56d"
            ]
        ]
    },
    {
        "id": "6ea0bca567f98258",
        "type": "pinecone-vector-ubos",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "demoversion",
        "actionType": "query",
        "apiKey": "",
        "environment": "",
        "x": 850,
        "y": 1120,
        "wires": [
            [
                "28efd2464c3c839c"
            ]
        ]
    },
    {
        "id": "a47dc852f2a3d493",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "function 366",
        "func": "const vector = msg.payload.data[0].embedding\n\nmsg.payload = {\n    name: global.get(\"process_env\").PIPECONE_INDEX,\n    \"topK\": 2,\n    \"includeMetadata\": true,\n    vector\n};\n\nmsg.PINECONE_API_KEY = global.get(\"process_env\").PIPECONE_API\nmsg.PINECONE_ENVIRONMENT = global.get(\"process_env\").PIPECONE_ENV\nmsg.PINECONE_BASE_URL = global.get(\"process_env\").PIPECONE_URL\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 725,
        "y": 1120,
        "wires": [
            [
                "6ea0bca567f98258"
            ]
        ],
        "l": false
    },
    {
        "id": "7f89c6e66b7532de",
        "type": "openai-ubos",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "",
        "model": "text-embedding-ada-002",
        "temperature": 0.5,
        "max_tokens": 60,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 600,
        "y": 1120,
        "wires": [
            [
                "a47dc852f2a3d493"
            ]
        ]
    },
    {
        "id": "28efd2464c3c839c",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "create vector",
        "func": "delete msg.filepath;\ndelete msg.filename;\ndelete msg.text;\nconst process_env = global.get(\"process_env\")\n// msg.OPENAI_API_KEY = process_env.OPENAI_API\nmsg.model = 'gpt-3.5-turbo-16k'\nconst content = msg.fromTG.content.includes(`@${global.get('telegram').BOT_NAME}`) ? msg.fromTG.content.replace(`@${global.get('telegram').BOT_NAME}`, '') : msg.fromTG.content;\n\nmsg.messages = [\n  { \"role\": \"system\", \"content\": global.get(\"process_env\").PROMPT + msg.payload.matches[0].metadata.result + \", \" + msg.payload.matches[1].metadata.result },\n  { \"role\": \"user\", \"content\": msg.old.entry[0].messaging[0].message.text }\n]\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 1120,
        "wires": [
            [
                "a65aaa50a45d0252"
            ]
        ]
    },
    {
        "id": "a65aaa50a45d0252",
        "type": "openai-ubos",
        "z": "c8208e6a65d3c2af",
        "g": "ebee837ffce65a75",
        "name": "genarate unswer",
        "model": "gpt-3.5-turbo",
        "temperature": 0.02,
        "max_tokens": 2000,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 1125,
        "y": 1120,
        "wires": [
            [
                "fb2196741549bce1"
            ]
        ],
        "l": false
    },
    {
        "id": "ec114b44f0f2b0e3",
        "type": "pinecone-vector-ubos",
        "z": "c8208e6a65d3c2af",
        "name": "demoversion",
        "actionType": "query",
        "apiKey": "",
        "environment": "",
        "x": 830,
        "y": 1440,
        "wires": [
            [
                "96fdc9ebf7f8fd4d"
            ]
        ]
    },
    {
        "id": "9592d313e2e286eb",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "name": "function 367",
        "func": "const vector = msg.payload.data[0].embedding\n\nmsg.payload = {\n    name: global.get(\"process_env\").PIPECONE_INDEX,\n    \"topK\": 2,\n    \"includeMetadata\": true,\n    vector\n};\n\nmsg.PINECONE_API_KEY = global.get(\"process_env\").PIPECONE_API\nmsg.PINECONE_ENVIRONMENT = global.get(\"process_env\").PIPECONE_ENV\nmsg.PINECONE_BASE_URL = global.get(\"process_env\").PIPECONE_URL\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 705,
        "y": 1440,
        "wires": [
            [
                "ec114b44f0f2b0e3"
            ]
        ],
        "l": false
    },
    {
        "id": "8bddac81611d93ed",
        "type": "openai-ubos",
        "z": "c8208e6a65d3c2af",
        "name": "",
        "model": "text-embedding-ada-002",
        "temperature": 0.5,
        "max_tokens": 60,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 580,
        "y": 1440,
        "wires": [
            [
                "9592d313e2e286eb"
            ]
        ]
    },
    {
        "id": "96fdc9ebf7f8fd4d",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "name": "create vector",
        "func": "delete msg.filepath;\ndelete msg.filename;\ndelete msg.text;\nconst process_env = global.get(\"process_env\")\n// msg.OPENAI_API_KEY = process_env.OPENAI_API\nmsg.model = 'gpt-3.5-turbo-16k'\n\nmsg.messages = [\n  { \"role\": \"system\", \"content\": global.get(\"process_env\").PROMPT + msg.payload.matches[0].metadata.result + \", \" + msg.payload.matches[1].metadata.result },\n  { \"role\": \"user\", \"content\": msg.old.entry[0].changes[0].value.messages[0].text.body }\n]\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 1440,
        "wires": [
            [
                "44b9e0968d17375a"
            ]
        ]
    },
    {
        "id": "44b9e0968d17375a",
        "type": "openai-ubos",
        "z": "c8208e6a65d3c2af",
        "name": "genarate unswer",
        "model": "gpt-3.5-turbo",
        "temperature": 0.02,
        "max_tokens": 2000,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 1105,
        "y": 1440,
        "wires": [
            [
                "72c0f7facf326866"
            ]
        ],
        "l": false
    },
    {
        "id": "947b8cf521fa8b81",
        "type": "pinecone-vector-ubos",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "demoversion",
        "actionType": "query",
        "apiKey": "",
        "environment": "",
        "x": 810,
        "y": 1900,
        "wires": [
            [
                "641684d8ce0a590f"
            ]
        ]
    },
    {
        "id": "ea1f64a48c2abd72",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "name": "function 368",
        "func": "const vector = msg.payload.data[0].embedding\n\nmsg.payload = {\n    name: global.get(\"process_env\").PIPECONE_INDEX,\n    \"topK\": 2,\n    \"includeMetadata\": true,\n    vector\n};\n\nmsg.PINECONE_API_KEY = global.get(\"process_env\").PIPECONE_API\nmsg.PINECONE_ENVIRONMENT = global.get(\"process_env\").PIPECONE_ENV\nmsg.PINECONE_BASE_URL = global.get(\"process_env\").PIPECONE_URL\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 705,
        "y": 1880,
        "wires": [
            [
                "947b8cf521fa8b81",
                "12c72333898f97b7"
            ]
        ],
        "l": false
    },
    {
        "id": "8bbbf3db55d9fe93",
        "type": "openai-ubos",
        "z": "c8208e6a65d3c2af",
        "name": "",
        "model": "text-embedding-ada-002",
        "temperature": 0.5,
        "max_tokens": 60,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 580,
        "y": 1880,
        "wires": [
            [
                "ea1f64a48c2abd72"
            ]
        ]
    },
    {
        "id": "641684d8ce0a590f",
        "type": "function",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "create vector",
        "func": "delete msg.filepath;\ndelete msg.filename;\ndelete msg.text;\nconst process_env = global.get(\"process_env\")\n// msg.OPENAI_API_KEY = process_env.OPENAI_API\nmsg.model = 'gpt-3.5-turbo-16k'\n\nmsg.messages = [\n  { \"role\": \"system\", \"content\": global.get(\"process_env\").PROMPT + msg.payload.matches[0].metadata.result + \", \" + msg.payload.matches[1].metadata.result },\n  { \"role\": \"user\", \"content\": msg.old.entry[0].messaging[0].message.text }\n]\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 1900,
        "wires": [
            [
                "e0933beca89886f4"
            ]
        ]
    },
    {
        "id": "e0933beca89886f4",
        "type": "openai-ubos",
        "z": "c8208e6a65d3c2af",
        "g": "7f86806a4ca0c715",
        "name": "genarate unswer",
        "model": "gpt-3.5-turbo",
        "temperature": 0.02,
        "max_tokens": 2000,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 1085,
        "y": 1900,
        "wires": [
            [
                "627bfa9d93208c59"
            ]
        ],
        "l": false
    },
    {
        "id": "fb6f85bd1aeb6ae7",
        "type": "pinecone-vector-ubos",
        "z": "c8208e6a65d3c2af",
        "name": "demoversion",
        "actionType": "query",
        "apiKey": "",
        "environment": "",
        "x": 490,
        "y": 100,
        "wires": [
            [
                "a39f53db2b53d4b1",
                "a49735024ef22310"
            ]
        ]
    },
    {
        "id": "f7d336beb3bb2ce7",
        "type": "pinecone-vector-ubos",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "demoversion",
        "actionType": "query",
        "apiKey": "",
        "environment": "",
        "x": 1490,
        "y": 400,
        "wires": [
            [
                "1c79434061d7ff76",
                "7195074bdb1b3509"
            ]
        ]
    },
    {
        "id": "fe7802ec805d07bd",
        "type": "pinecone-vector-ubos",
        "z": "c8208e6a65d3c2af",
        "g": "cbd9c53fe26c3884",
        "name": "demoversion",
        "actionType": "query",
        "apiKey": "",
        "environment": "",
        "x": 1410,
        "y": 840,
        "wires": [
            [
                "9406da99327c9644"
            ]
        ]
    },
    {
        "id": "2677414dc3b763e4",
        "type": "link in",
        "z": "33ad232901cfdd1c",
        "name": "mongo Find",
        "links": [],
        "x": 65,
        "y": 60,
        "wires": [
            [
                "249710f1ad698a20"
            ]
        ]
    },
    {
        "id": "56c2fced239f2936",
        "type": "link in",
        "z": "33ad232901cfdd1c",
        "name": "mongo Aggregate",
        "links": [],
        "x": 65,
        "y": 120,
        "wires": [
            [
                "fb78182cc4835041"
            ]
        ]
    },
    {
        "id": "8771d95b528d34d0",
        "type": "link in",
        "z": "33ad232901cfdd1c",
        "name": "mongo Insert",
        "links": [],
        "x": 65,
        "y": 220,
        "wires": [
            [
                "703258bd8f8bf4d7",
                "f3044d88f842fe9e"
            ]
        ]
    },
    {
        "id": "d1949ed8cdf3c5ed",
        "type": "link in",
        "z": "33ad232901cfdd1c",
        "name": "mongo Update",
        "links": [],
        "x": 65,
        "y": 280,
        "wires": [
            [
                "86de144f4f3b1450",
                "4e41ef5ff791e8ec"
            ]
        ]
    },
    {
        "id": "cc5e7181a25ef63d",
        "type": "link out",
        "z": "33ad232901cfdd1c",
        "name": "link out 1",
        "mode": "return",
        "links": [],
        "x": 325,
        "y": 60,
        "wires": []
    },
    {
        "id": "466a89b9ea3e18b6",
        "type": "link out",
        "z": "33ad232901cfdd1c",
        "name": "link out 2",
        "mode": "return",
        "links": [],
        "x": 335,
        "y": 120,
        "wires": []
    },
    {
        "id": "703258bd8f8bf4d7",
        "type": "link out",
        "z": "33ad232901cfdd1c",
        "name": "link out 4",
        "mode": "return",
        "links": [],
        "x": 215,
        "y": 180,
        "wires": []
    },
    {
        "id": "86de144f4f3b1450",
        "type": "link out",
        "z": "33ad232901cfdd1c",
        "name": "link out 5",
        "mode": "return",
        "links": [],
        "x": 215,
        "y": 320,
        "wires": []
    },
    {
        "id": "f3044d88f842fe9e",
        "type": "mongodb out",
        "z": "33ad232901cfdd1c",
        "mongodb": "7908a755f1520aa7",
        "name": "db",
        "collection": "",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 240,
        "y": 220,
        "wires": []
    },
    {
        "id": "4e41ef5ff791e8ec",
        "type": "mongodb out",
        "z": "33ad232901cfdd1c",
        "mongodb": "7908a755f1520aa7",
        "name": "db",
        "collection": "",
        "payonly": false,
        "upsert": false,
        "multi": false,
        "operation": "update",
        "x": 240,
        "y": 280,
        "wires": []
    },
    {
        "id": "fb78182cc4835041",
        "type": "mongodb in",
        "z": "33ad232901cfdd1c",
        "mongodb": "7908a755f1520aa7",
        "name": "db",
        "collection": "",
        "operation": "aggregate",
        "x": 210,
        "y": 120,
        "wires": [
            [
                "466a89b9ea3e18b6"
            ]
        ]
    },
    {
        "id": "249710f1ad698a20",
        "type": "mongodb in",
        "z": "33ad232901cfdd1c",
        "mongodb": "7908a755f1520aa7",
        "name": "db",
        "collection": "",
        "operation": "find",
        "x": 190,
        "y": 60,
        "wires": [
            [
                "cc5e7181a25ef63d"
            ]
        ]
    },
    {
        "id": "b1cbc1d37577fdbd",
        "type": "http in",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "url": "/chekUserExist",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 60,
        "wires": [
            [
                "06c7c7103269ba13"
            ]
        ]
    },
    {
        "id": "b7f9b16fd9b17654",
        "type": "http response",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 730,
        "y": 60,
        "wires": []
    },
    {
        "id": "33d8f81e06fa10e4",
        "type": "http in",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "url": "/updateUserChatData",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 120,
        "wires": [
            [
                "5f374d352c58e52d"
            ]
        ]
    },
    {
        "id": "6766302ec1d2eb2d",
        "type": "http in",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "url": "/saveUserChatData",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 180,
        "wires": [
            [
                "0c407bc4ae621990"
            ]
        ]
    },
    {
        "id": "5f374d352c58e52d",
        "type": "function",
        "z": "4004e7d2fbdbf6a9",
        "name": "update users_chat",
        "func": "msg.query = {\n    _id:objectid(msg.payload._id)\n}\nlet obj = msg.payload\nmsg.collection = 'users_chat'\n\ndelete obj._id;\nmsg.payload = obj\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 390,
        "y": 120,
        "wires": [
            [
                "0abbbe697992f29b"
            ]
        ]
    },
    {
        "id": "0c407bc4ae621990",
        "type": "function",
        "z": "4004e7d2fbdbf6a9",
        "name": "save users_chat",
        "func": "msg.collection = 'users_chat'\n\nmsg.payload.deleted = false\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 180,
        "wires": [
            [
                "d522fbbfff81ae43"
            ]
        ]
    },
    {
        "id": "06c7c7103269ba13",
        "type": "function",
        "z": "4004e7d2fbdbf6a9",
        "name": "find users_chat",
        "func": "msg.payload = {\n    chat_id: Number(msg.payload.chat_id) \n}\n\nmsg.collection = 'users_chat'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 60,
        "wires": [
            [
                "3ba0fdedd6f6201e"
            ]
        ]
    },
    {
        "id": "b2e1f244c6bd955d",
        "type": "http response",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 770,
        "y": 180,
        "wires": []
    },
    {
        "id": "a1ebaee935089a3b",
        "type": "http response",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 770,
        "y": 120,
        "wires": []
    },
    {
        "id": "f24d44f7262b52cd",
        "type": "http in",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "url": "/getAllUsers",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 300,
        "wires": [
            [
                "31a716a792e6a4c0"
            ]
        ]
    },
    {
        "id": "7477d82efd1305b2",
        "type": "http response",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 690,
        "y": 300,
        "wires": []
    },
    {
        "id": "fd6379cb31404638",
        "type": "http in",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "url": "/saveUserMessage",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 240,
        "wires": [
            [
                "108f67f6c7289131"
            ]
        ]
    },
    {
        "id": "108f67f6c7289131",
        "type": "function",
        "z": "4004e7d2fbdbf6a9",
        "name": "save users_messages",
        "func": "msg.collection = 'users_messages'\n\nmsg.payload.deleted = false\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 240,
        "wires": [
            [
                "6d4cba3aa8be1c26"
            ]
        ]
    },
    {
        "id": "27289d926d3a2b25",
        "type": "http response",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 830,
        "y": 240,
        "wires": []
    },
    {
        "id": "87dbe29697f2e5c1",
        "type": "http in",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "url": "/getChatHIstory",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 540,
        "wires": [
            [
                "6e5657b56e44ccaf"
            ]
        ]
    },
    {
        "id": "6e5657b56e44ccaf",
        "type": "function",
        "z": "4004e7d2fbdbf6a9",
        "name": "get users_messages",
        "func": "msg.payload = {\n    chat_id: Number(msg.payload.id)\n}\nmsg.collection = 'users_messages'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 540,
        "wires": [
            [
                "16223ecf470a223f"
            ]
        ]
    },
    {
        "id": "eefe631abc8cde08",
        "type": "http response",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 730,
        "y": 540,
        "wires": []
    },
    {
        "id": "9de68b716677dfcd",
        "type": "http in",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "url": "/saveUser",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 420,
        "wires": [
            [
                "946838aa6a2c923d"
            ]
        ]
    },
    {
        "id": "946838aa6a2c923d",
        "type": "function",
        "z": "4004e7d2fbdbf6a9",
        "name": "save users",
        "func": "msg.payload.deleted = false\nmsg.collection = 'users'\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 420,
        "wires": [
            [
                "f5a82bc844496abf"
            ]
        ]
    },
    {
        "id": "44bd463107561a17",
        "type": "http response",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 690,
        "y": 420,
        "wires": []
    },
    {
        "id": "5c6a28d3c955de54",
        "type": "http in",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "url": "/checkUser",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 480,
        "wires": [
            [
                "1c17a713153514dd"
            ]
        ]
    },
    {
        "id": "1c17a713153514dd",
        "type": "function",
        "z": "4004e7d2fbdbf6a9",
        "name": "find users",
        "func": "msg.payload={\n    chat_id: Number(msg.payload.chat_id) \n}\nmsg.collection = 'users'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 480,
        "wires": [
            [
                "2ca3887f8000c42e"
            ]
        ]
    },
    {
        "id": "c251e84a8957ce9d",
        "type": "http response",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 690,
        "y": 480,
        "wires": []
    },
    {
        "id": "bd0a57e25a0432e1",
        "type": "http in",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "url": "/getUsersTelegram",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 360,
        "wires": [
            [
                "c5818e7815a34e57"
            ]
        ]
    },
    {
        "id": "93858da710ccfe98",
        "type": "http response",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 850,
        "y": 360,
        "wires": []
    },
    {
        "id": "3ba0fdedd6f6201e",
        "type": "link call",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 570,
        "y": 60,
        "wires": [
            [
                "b7f9b16fd9b17654"
            ]
        ]
    },
    {
        "id": "0abbbe697992f29b",
        "type": "link call",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 620,
        "y": 120,
        "wires": [
            [
                "a1ebaee935089a3b"
            ]
        ]
    },
    {
        "id": "6d4cba3aa8be1c26",
        "type": "link call",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 650,
        "y": 240,
        "wires": [
            [
                "27289d926d3a2b25"
            ]
        ]
    },
    {
        "id": "d522fbbfff81ae43",
        "type": "link call",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 610,
        "y": 180,
        "wires": [
            [
                "b2e1f244c6bd955d"
            ]
        ]
    },
    {
        "id": "f5a82bc844496abf",
        "type": "link call",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 420,
        "wires": [
            [
                "44bd463107561a17"
            ]
        ]
    },
    {
        "id": "2ca3887f8000c42e",
        "type": "link call",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 480,
        "wires": [
            [
                "c251e84a8957ce9d"
            ]
        ]
    },
    {
        "id": "16223ecf470a223f",
        "type": "link call",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 570,
        "y": 540,
        "wires": [
            [
                "eefe631abc8cde08",
                "844b66189eb1c08e"
            ]
        ]
    },
    {
        "id": "844b66189eb1c08e",
        "type": "debug",
        "z": "4004e7d2fbdbf6a9",
        "name": "debug 405",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 870,
        "y": 540,
        "wires": []
    },
    {
        "id": "c13653a3c3d46321",
        "type": "template",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "css",
        "syntax": "mustache",
        "template": ".header{\ntop: 0px !important;\nheight: 66px !important;\npadding: 0px !important;\n/* width: 100% !important; */\nborder-bottom: 2px solid rgb(241, 243, 244) !important;\n}\n\n.menu_section{\nbox-shadow: rgba(0, 0, 0, 0.25) 1px 2px 3px !important;\nheight: 100vh !important;\npadding: 0px !important;\nleft: 0px !important;\nborder-right: 2px solid rgb(241, 243, 244) !important;\n}\n\n.main_section{\npadding: 0px !important;\nheight: 100vh !important;\nposition: fixed !important;\ntop: 66px !important; \n}\n\n.tab_login>div>div>div>div{\nbox-shadow: none !important;\n}\n\n.tab_login>div>div>div>div>div{\nbackground: transparent !important;\n}\n\n.frame_section{\nheight: 100vh !important;\nposition: fixed !important;\ntop: 16px !important; \n}\n\n.scroll_section{\n    height: 100% !important;\n    top: 66px !important; \npadding: 0px !important;\n\n}\n\n.image{\n    padding: 4px 14px !important;\n    left: 0px !important;\n    width: 100% !important;\n    border-bottom: 2px solid rgb(241, 243, 244) !important;\n    height: 75px !important;\n}\n\n\n.menu .active span{\ncolor: #2a2f36 !important;\n}\n\n.menu .active {\n    background: #ebf1fb !important;\n}\n\n.menu button:hover{\nbackground: #ebf1fb;\n}\n\n.menu span[role=\"img\"]{\nmargin-left: 8px !important;\nmargin-top: 3px !important;\n\n}\n.menu .bp3-collapse-body .sub_category {\n    padding: 5px 5px 5px 20px !important;\n}\n.menu button{\n    box-shadow: none !important;\n}\n\n.menu span{\n    font-size: 16px !important;\n    font-weight: 400 !important;\n    color: #00000099 !important;\n}\n\n.menu {\n    left: 0px !important;\n    width: 100% !important;\n    padding: 0 !important;\n}\n\n.menu_wrap{\n    position: fixed !important;\n    left: 0px!important;\n    top: 0px !important;\n    height: 100vh !important;\n    /* width: 178.312px!important; */\n    padding: 0px!important;\n    box-shadow: rgba(0, 0, 0, 0.25) 1px 2px 3px !important;\n}\n\n.menu button {\n    justify-content: start !important;\n    padding: 5px 10px 5px 15px !important;\n    margin-bottom: 5px !important;\n}\n\n.setting_title{\n    padding: 4px 14px !important;\n    left: 0px !important;\n    width: 100% !important;\n    border-bottom: 2px solid rgb(241, 243, 244) !important;\n}\n\n\n.setting_text{\n    padding: 4px 14px !important;\n    left: 0px !important;\n    width: 100% !important;\n    border-bottom: 2px solid rgb(241, 243, 244) !important; \n}\n\n.setting_text .bp3-ui-text {\n    font-weight: 500 !important;\n    font-size: 16px !important;\n}\n\n.setting_title .bp3-ui-text {\n    font-weight: 600 !important;\n    font-size: 18px !important;\n}\n\n.telegramList {\n    padding: 10px 20px !important;\n}\n\n.telegramList .custom-wrapper-canvas-list{\n    display: flex;\n    flex-direction: column !important;\n}\n.telegramList .custom-wrapper-canvas-list button {\n    display: none !important;\n}\n.telegramList .custom-wrapper-canvas-list .t--widget-containerwidget{\n    width: 90% !important;\n    position: static !important;\n    border-radius: 8px!important;\n    padding: 0 !important;\n    margin-bottom: 7px;\n    margin-right: auto !important;\n    margin-left: 0 !important;\n    background-color: #cfcfdb !important;\n}\n.telegramList .custom-wrapper-canvas-list .t--widget-containerwidget:nth-of-type(odd){\n    margin-right: 0 !important;\n    margin-left: auto !important;\n    background-color: #e5e5e6 !important;\n}\n.telegramList .t--widget-textwidget{\n    width: auto !important;\n    position: static !important;\n    padding: 5px 15px !important;\n    height: 100% !important;\n}\n.telegramList .t--widget-textwidget span{\n    font-weight: 500; \n    font-size: 16px;\n    line-height: 125%;\n}\n\n.telegramList .custom-wrapper-canvas-list .t--widget-containerwidget:nth-of-type(odd) .t--widget-textwidget span{\n    text-align: end;\n}\n\n.telegramWrap{\n    padding: 0!important;\n}\n\n.container{\n    min-height: 100vh;\n}\n\n.selectedTab{\n    box-shadow: rgb(235, 239, 242) -1px 0px 0px inset, rgb(235, 239, 242) 0px 0px 0px inset, rgb(55 169 235) 0px 4px 0px inset !important;\n}",
        "output": "str",
        "x": 280,
        "y": 620,
        "wires": [
            [
                "6c14c16dc9e0d8f4"
            ]
        ]
    },
    {
        "id": "6c14c16dc9e0d8f4",
        "type": "http response",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "statusCode": "",
        "headers": {
            "content-type": "text/css"
        },
        "x": 430,
        "y": 620,
        "wires": []
    },
    {
        "id": "cbdef52a04ca4507",
        "type": "http in",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "url": "/css",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 620,
        "wires": [
            [
                "c13653a3c3d46321"
            ]
        ]
    },
    {
        "id": "31a716a792e6a4c0",
        "type": "function",
        "z": "4004e7d2fbdbf6a9",
        "name": "get users_chat",
        "func": "msg.collection = 'users_chat'\nmsg.payload={}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 300,
        "wires": [
            [
                "76404382f2b1732b"
            ]
        ]
    },
    {
        "id": "c5818e7815a34e57",
        "type": "function",
        "z": "4004e7d2fbdbf6a9",
        "name": "get users",
        "func": "msg.collection = 'users'\nmsg.payload = {}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 360,
        "wires": [
            [
                "7dce76ede6c5ac60"
            ]
        ]
    },
    {
        "id": "76404382f2b1732b",
        "type": "link call",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 300,
        "wires": [
            [
                "7477d82efd1305b2"
            ]
        ]
    },
    {
        "id": "7dce76ede6c5ac60",
        "type": "link call",
        "z": "4004e7d2fbdbf6a9",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 360,
        "wires": [
            [
                "9e73142cfd50b560"
            ]
        ]
    },
    {
        "id": "9e73142cfd50b560",
        "type": "function",
        "z": "4004e7d2fbdbf6a9",
        "name": "function 334",
        "func": "msg.payload={\n    telegram: msg.payload.filter(e => e.type ==='telegram'),\n    messanger: msg.payload.filter(e => e.type === 'messanger'),\n    whatsApp: msg.payload.filter(e => e.type === 'whatsApp'),\n    instagram: msg.payload.filter(e => e.type === 'instagram'),\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 360,
        "wires": [
            [
                "93858da710ccfe98"
            ]
        ]
    },
    {
        "id": "f97b0c9a1ee37a8c",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 470,
        "y": 180,
        "wires": []
    },
    {
        "id": "99624067aae5195b",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "err login",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 480,
        "y": 220,
        "wires": []
    },
    {
        "id": "9bb0630c766c1fae",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 450,
        "y": 520,
        "wires": []
    },
    {
        "id": "1b8da8f5dff0448a",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "err register",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 470,
        "y": 560,
        "wires": []
    },
    {
        "id": "cda158a3d19d64d9",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1370,
        "y": 1520,
        "wires": []
    },
    {
        "id": "7a70680f44f5df9c",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "err register",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1390,
        "y": 1560,
        "wires": []
    },
    {
        "id": "aa679389020af958",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "menu grouping",
        "func": "msg.payload = msg.payload[0];\nmsg.permissions = msg.payload.permissions;\n\nfunction sortByPositionNumber(arr) {\n    return arr.sort((a, b) => +a.position - +b.position);\n}\n\nmsg.menu = sortByPositionNumber(msg.payload.menu).map(el => {\n\n    if (el.isParent) {\n        return {\n            \"label\": el.name,\n            \"value\": el.name,\n            \"icon\": el.icon ? el.icon : \"\",\n            \"children\": el.childModules.length \n                ? sortByPositionNumber(el.childModules)\n                  .map(item => ({\n                      \"label\": item.name,\n                      \"value\": item.name,\n                      \"icon\": item.icon ? item.icon : \"\"\n                  })) \n                : []\n        }\n    } else {\n        return {\n            \"label\": el.name,\n            \"value\": el.name,\n            \"children\": [],\n            \"icon\": el.icon ? el.icon : \"\",\n        }\n    }\n    \n});\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1440,
        "y": 840,
        "wires": [
            [
                "3c6be83529dc0fcd",
                "80886c4b206ae578"
            ]
        ]
    },
    {
        "id": "3c6be83529dc0fcd",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "check user permissions",
        "func": "const pageName = msg.check.page_id.replace('%20', ' ');\n\nconst parentPage = msg.menu.map((el) => el.label).includes(pageName);\nconst childPage = msg.menu.filter((e) => e.children.length > 0).flatMap((el) => el.children).map((elem) => elem.label).includes(pageName);\n\nif (parentPage || childPage || pageName == \"Chat\" || pageName == \"Vectors\" || pageName == \"Content\" || pageName === \"BaseDetails\") {\n\n    msg.statusCode = 200;\n    msg.payload = {\n        auth: \"Success\",\n        code: 200,\n        user: {\n            \"menu\": msg.menu,\n            \"permission\": msg.permissions,\n            \"translation\": msg.payload.translation[0],\n            \"info\": msg.user\n        }\n    }\n\n} else {\n\n    msg.payload = {\n        auth: \"Unautorizate\",\n        code: 401,\n        login_id: msg.menu[0].value + `?pageName=${msg.menu[0].value}`,\n        app_id: msg.check.app_id\n    }\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1670,
        "y": 840,
        "wires": [
            [
                "2a1cf553e1e9ec78",
                "caff712e2eb791e2"
            ]
        ]
    },
    {
        "id": "80886c4b206ae578",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "menu grouping",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1640,
        "y": 800,
        "wires": []
    },
    {
        "id": "14b59f3691ef69ba",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "func": "msg.collection = \"admin_roles\";\n\nmsg.payload={\n    name:msg.payload.name,\n    deleted:false,\n    permissions: [],\n    createdAt: new Date((new Date().toISOString()))\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 1440,
        "wires": [
            [
                "399a4d9543fe95a1",
                "5e4d4597f4c69b03"
            ]
        ]
    },
    {
        "id": "84a0df2970ba557a",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "createRole",
        "url": "/createRole",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 1440,
        "wires": [
            [
                "14b59f3691ef69ba"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "399a4d9543fe95a1",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 410,
        "y": 1460,
        "wires": []
    },
    {
        "id": "8b8038ef3ffa67dc",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "getRoles",
        "url": "/getRoles",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 1220,
        "wires": [
            [
                "669f5378dc89b756"
            ]
        ]
    },
    {
        "id": "a2903e704c5feffd",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 590,
        "y": 1220,
        "wires": []
    },
    {
        "id": "cf996b8f5729052e",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "addModuleToRole",
        "url": "/addModuleToRole",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 1580,
        "wires": [
            [
                "98ea56df1bdf7663",
                "a79b5a026be5770c"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "bb8c3b11be10027d",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 470,
        "y": 1600,
        "wires": []
    },
    {
        "id": "98ea56df1bdf7663",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "func": "msg.collection = \"admin_roles\";\n\nlet crud = {\n    \"canCreate\": false,\n    \"canRead\": false,\n    \"canEdit\": false,\n    \"canRemove\": false\n}\n\nmsg.payload.options.map(e => {\n    if (e == \"C\") {\n        crud.canCreate = true\n    }\n    else if (e == \"R\") {\n        crud.canRead = true\n    }\n    else if (e == \"U\") {\n        crud.canEdit = true\n    } else if (e == \"D\") {\n        crud.canRemove = true\n    }\n})\n\n\nlet modules = msg.payload.moduleName.map((name, index)=> {\n    return {\n        \"name\": name,\n        \"value\": msg.payload.moduleValue[index]\n    }\n\n})\n\nlet preparedModules\n = modules.map(item => {\n    return{\n        module: item.name,\n        moduleId: objectid(item.value),\n        ...crud\n    }\n})\n\nmsg.query={\n    \"_id\":objectid(msg.payload._id)\n}\n\nmsg.payload={\n    $push: {\n        permissions: {\n            $each: [...preparedModules]\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 320,
        "y": 1580,
        "wires": [
            [
                "bb8c3b11be10027d",
                "da93f58c9901602e"
            ]
        ]
    },
    {
        "id": "5e4d4597f4c69b03",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 440,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "669f5378dc89b756",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "func": "msg.collection=\"admin_roles\"\nmsg.payload={\n    deleted: false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 1220,
        "wires": [
            [
                "f8d3962a2d3d4295"
            ]
        ]
    },
    {
        "id": "f8d3962a2d3d4295",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 440,
        "y": 1220,
        "wires": [
            [
                "a2903e704c5feffd",
                "22c15e1e7bf3a3ca"
            ]
        ]
    },
    {
        "id": "da93f58c9901602e",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 540,
        "y": 1560,
        "wires": [
            []
        ]
    },
    {
        "id": "c1327a786ae3deed",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "func": "msg.collection =\"admin_roles\"\n\nmsg.query={\n    _id: objectid(msg.payload._id)\n}\n\nmsg.payload={\n    $set:{\n        name: msg.payload.name\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 280,
        "y": 1700,
        "wires": [
            [
                "1a8d5dbb5642beda",
                "18133ecfe411d7f0"
            ]
        ]
    },
    {
        "id": "9af1975a343bc582",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "updateRole",
        "url": "/updateRole",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 1700,
        "wires": [
            [
                "c1327a786ae3deed"
            ]
        ],
        "icon": "font-awesome/fa-edit"
    },
    {
        "id": "1a8d5dbb5642beda",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "10",
        "x": 500,
        "y": 1680,
        "wires": [
            []
        ]
    },
    {
        "id": "18133ecfe411d7f0",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 430,
        "y": 1720,
        "wires": []
    },
    {
        "id": "d7b0e35cdd28547a",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "deleteModuleFromRole",
        "url": "/deleteModuleFromRole",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 1960,
        "wires": [
            [
                "7510771007812d39"
            ]
        ],
        "icon": "font-awesome/fa-remove"
    },
    {
        "id": "7510771007812d39",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "func": "msg.collection = \"admin_roles\";\n\nmsg.query = {\n   \"_id\": objectid(msg.payload._id)\n};\n\nconst deleteModulesId = msg.payload.moduleId.map(i => objectid(i));\n\nmsg.payload = {\n    $pull: {\n        permissions: {\n            moduleId: {\n                $in: deleteModulesId\n            }\n        }\n    }\n}\n\n// msg.payload = {\n//     $pull: {\n//         \"permissions\": {\n//             \"moduleId\": objectid(msg.payload.moduleId)\n//         }\n//     }\n// }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 340,
        "y": 1960,
        "wires": [
            [
                "2cceb3d0a93343d8",
                "9fe78a1700cc52d7",
                "83c8060a7ab3bf27"
            ]
        ]
    },
    {
        "id": "2cceb3d0a93343d8",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 560,
        "y": 2000,
        "wires": [
            []
        ]
    },
    {
        "id": "1383178398d4778b",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "deleteRole",
        "url": "/deleteRole",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 1820,
        "wires": [
            [
                "777f378a36dc63f0"
            ]
        ],
        "icon": "font-awesome/fa-remove"
    },
    {
        "id": "777f378a36dc63f0",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "func": "msg.collection =\"admin_roles\"\n\nmsg.query={\n    _id: objectid(msg.payload._id)\n}\n\nmsg.payload={\n    $set:{\n        deleted: true\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 260,
        "y": 1820,
        "wires": [
            [
                "c387f054fc1d8ef2",
                "ee0773620e14dc5e"
            ]
        ]
    },
    {
        "id": "ee0773620e14dc5e",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 410,
        "y": 1840,
        "wires": []
    },
    {
        "id": "c387f054fc1d8ef2",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 480,
        "y": 1800,
        "wires": [
            []
        ]
    },
    {
        "id": "9fe78a1700cc52d7",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 490,
        "y": 1960,
        "wires": []
    },
    {
        "id": "83c8060a7ab3bf27",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 1920,
        "wires": []
    },
    {
        "id": "a79b5a026be5770c",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 310,
        "y": 1540,
        "wires": []
    },
    {
        "id": "22c15e1e7bf3a3ca",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "all Roles",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 1180,
        "wires": []
    },
    {
        "id": "d66bda1905ec670a",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "get roles",
        "func": "msg.collection = \"admin_roles\"\nlet match = {};\nif (msg.payload.name != \",\" && msg.payload.name) {\n    match = {\n        name: { $regex: msg.payload.name, $options: \"i\" }\n    }\n}\n\nmsg.payload = {\n    deleted: false, \n    ...match\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 1340,
        "wires": [
            [
                "f8956004b58baaad"
            ]
        ]
    },
    {
        "id": "f8956004b58baaad",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 460,
        "y": 1340,
        "wires": [
            [
                "753babafc6ec97fd",
                "78b779b42c51cffb"
            ]
        ]
    },
    {
        "id": "78b779b42c51cffb",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "all roles",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 1300,
        "wires": []
    },
    {
        "id": "753babafc6ec97fd",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 610,
        "y": 1340,
        "wires": []
    },
    {
        "id": "881a3a438a261f6f",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "752a8b5a286babe5",
        "name": "getAllRoles",
        "url": "/getAllRoles",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 1340,
        "wires": [
            [
                "d66bda1905ec670a"
            ]
        ],
        "info": "Use in: User Management"
    },
    {
        "id": "4f0b3da36fb0040c",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "login",
        "url": "/login",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 140,
        "wires": [
            [
                "5fd1692f7e8d87b5",
                "1b70be2e868d8c04"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "5fd1692f7e8d87b5",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "check",
        "func": "const regexEmail = /^(([^<>()[\\]\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@(([^<>()[\\]\\.,;:\\s@\\\"]+\\.)+[^<>()[\\]\\.,;:\\s@\\\"]{2,})$/i;\nconst regexPassword = /^(?!.*\\s).{8,}/;\nconst email = msg.payload.email.toLowerCase();\n\nif (!regexEmail.test(email)) {\n    msg.statusCode = 401;\n    msg.payload = {\n        data: \"Email is invalid\",\n        code: 401\n    }\n\n    return [null, msg];\n\n} else if (!regexPassword.test(msg.payload.password)) {\n    msg.statusCode = 401;\n    msg.payload = {\n        data: \"The password is invalid. The value must be at least 8 characters and without whitespaces\",\n        code: 401\n    }\n\n    return [null, msg];\n    \n} else {\n    msg.collection = \"admins\"\n    msg.fromApp = msg.payload\n\n    node.warn(msg.fromApp)\n\n    msg.payload = {\n        email: email,\n        deleted: false,\n        active: true\n    }\n\n    return [msg, null];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 140,
        "wires": [
            [
                "3664e53bb83334c6",
                "1aa6084c940d35b0"
            ],
            [
                "f97b0c9a1ee37a8c",
                "99624067aae5195b"
            ]
        ]
    },
    {
        "id": "abfb844120e384b4",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1230,
        "y": 120,
        "wires": []
    },
    {
        "id": "62a0db821ee1373d",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "check auth",
        "func": "let bcrypt = global.get('bcrypt')\nif(msg.payload.length === 0){\n    msg.statusCode = 401;\n    msg.payload = {\n        data: \"Incorrect email or password\",\n        code:401\n    }\n    node.warn(\"Email not found\");\n    return [null,msg]\n} else {\n\n    let check = await bcrypt.compare(msg.fromApp.password, msg.payload[0].password);\n\n    if (!check) {\n        msg.statusCode = 401;\n        msg.payload = {\n            data: \"Incorrect email or password\",\n            code: 401\n        }\n        node.warn(\"Password incorrect\");\n        return [null, msg]\n    }\n\n    if (msg.payload[0].active === false) {\n        msg.statusCode = 401;\n        msg.payload = {\n            data: \"Email not activated\",\n            code: 401\n        }\n        return [null, msg]\n    }\n}\n\n\n\nreturn[msg,null]",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 140,
        "wires": [
            [
                "c4b1bd96421d0281",
                "8e793c55c7af2219"
            ],
            [
                "0791faf1cee2fe7f",
                "43a4fd40f853d3a1"
            ]
        ]
    },
    {
        "id": "0791faf1cee2fe7f",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1130,
        "y": 180,
        "wires": []
    },
    {
        "id": "c4b1bd96421d0281",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "jwt token",
        "func": "msg.payload = msg.payload[0]\nconst token = jwt.sign(\n    { user_id: msg.payload._id, email:msg.payload.email },\n    \"test\",\n    {\n        expiresIn: \"1400m\",\n    }\n);\n\nmsg.cookies = {};\nmsg.cookies[\"user_token\"] = token;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 1060,
        "y": 140,
        "wires": [
            [
                "abfb844120e384b4",
                "cd1dfd3d06c80ef4"
            ]
        ]
    },
    {
        "id": "cd1dfd3d06c80ef4",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1230,
        "y": 80,
        "wires": []
    },
    {
        "id": "e78bfdb95d2722e4",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "check_token",
        "url": "/check_token",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 880,
        "wires": [
            [
                "268b887a3da70c7d",
                "f7a7e47f575cc20f"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "91e2852778907a59",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "statusCode": "401",
        "headers": {},
        "x": 1040,
        "y": 920,
        "wires": []
    },
    {
        "id": "268b887a3da70c7d",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "check jwt",
        "func": "msg.check = msg.payload;\nconst decoded = jwt.verify(msg.payload.token, 'test');\nmsg.payload = decoded\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 320,
        "y": 880,
        "wires": [
            [
                "7e24ab9c80ca59ea",
                "c86dcb9df78cebf6"
            ]
        ]
    },
    {
        "id": "7e24ab9c80ca59ea",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 840,
        "wires": []
    },
    {
        "id": "f7a7e47f575cc20f",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "Checker",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 320,
        "y": 840,
        "wires": []
    },
    {
        "id": "2c60c99cba5d66e8",
        "type": "catch",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "scope": [
            "268b887a3da70c7d"
        ],
        "uncaught": false,
        "x": 100,
        "y": 980,
        "wires": [
            [
                "7822047ac02138e4",
                "dfd63696a37ed3ef"
            ]
        ]
    },
    {
        "id": "7822047ac02138e4",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "func": "msg.payload = {\n    auth: \"Unautorizate\",\n    code: 401,\n    login_id: msg.check.login_id,\n    app_id: msg.check.app_id\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 270,
        "y": 980,
        "wires": [
            [
                "e80f4ed8349b066e",
                "ad274da8cc3c3022"
            ]
        ]
    },
    {
        "id": "e80f4ed8349b066e",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 430,
        "y": 980,
        "wires": []
    },
    {
        "id": "c86dcb9df78cebf6",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "check",
        "func": "msg.collection = \"admins\"\nmsg.fromApp = msg.payload\nmsg.payload = {\n    // email : msg.fromApp.email,\n    _id: objectid(msg.payload.user_id),\n    deleted:false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 490,
        "y": 880,
        "wires": [
            [
                "8ebd248a8eed9491",
                "1f52497bc2ed6264"
            ]
        ]
    },
    {
        "id": "bdd3c6716bf4d72a",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "check auth",
        "func": "\nif(msg.payload.length > 0){\n    msg.payload = msg.payload[0]\n    msg.user = {\n        auth: \"Success\",\n        code:200,\n        user: msg.payload\n    }\n    return [msg,null]\n}else{\n    msg.payload = {\n        auth: \"Unautorizate\",\n        code: 401,\n        login_id:msg.check.login_id,\n        app_id:msg.check.app_id\n    }\n    return [null,msg]\n}\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 880,
        "wires": [
            [
                "c8359b5d14016069",
                "f36403b4bdb0a3b9"
            ],
            [
                "91e2852778907a59"
            ]
        ]
    },
    {
        "id": "ad274da8cc3c3022",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 430,
        "y": 1020,
        "wires": []
    },
    {
        "id": "2a1cf553e1e9ec78",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1870,
        "y": 800,
        "wires": []
    },
    {
        "id": "dfd63696a37ed3ef",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 290,
        "y": 1020,
        "wires": []
    },
    {
        "id": "63e96537c28f9852",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 840,
        "wires": []
    },
    {
        "id": "caff712e2eb791e2",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1870,
        "y": 840,
        "wires": []
    },
    {
        "id": "8e793c55c7af2219",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1050,
        "y": 80,
        "wires": []
    },
    {
        "id": "43a4fd40f853d3a1",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "err login",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1060,
        "y": 220,
        "wires": []
    },
    {
        "id": "61ea6b2dafed34ff",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 670,
        "y": 140,
        "wires": [
            [
                "62a0db821ee1373d",
                "5d9628083a55b25a"
            ]
        ]
    },
    {
        "id": "8ebd248a8eed9491",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 690,
        "y": 880,
        "wires": [
            [
                "bdd3c6716bf4d72a",
                "63e96537c28f9852"
            ]
        ]
    },
    {
        "id": "9bdeada5928fdb22",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "links": [
            "56c2fced239f2936"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1260,
        "y": 840,
        "wires": [
            [
                "8c5efef801cc1dc0",
                "aa679389020af958"
            ]
        ]
    },
    {
        "id": "8c5efef801cc1dc0",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "THIS",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1410,
        "y": 800,
        "wires": []
    },
    {
        "id": "1b70be2e868d8c04",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 330,
        "y": 100,
        "wires": []
    },
    {
        "id": "30eee249014d5f9c",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "signout",
        "url": "/signout",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 340,
        "wires": [
            [
                "7bb68135adb77b5f",
                "b33db8bb0f9df1e6"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "d3246b62cc5c7d48",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "Checker",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 300,
        "wires": []
    },
    {
        "id": "c3b9152502b0b7de",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 670,
        "y": 340,
        "wires": []
    },
    {
        "id": "b33db8bb0f9df1e6",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "Checker",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 320,
        "y": 300,
        "wires": []
    },
    {
        "id": "7bb68135adb77b5f",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "check jwt",
        "func": "msg.cookies={\n    user_token: null\n}\n\nmsg.payload={\n    success: true\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 340,
        "wires": [
            [
                "d3246b62cc5c7d48",
                "d5ece23b520b810f"
            ]
        ]
    },
    {
        "id": "d5ece23b520b810f",
        "type": "delay",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 500,
        "y": 340,
        "wires": [
            [
                "c3b9152502b0b7de"
            ]
        ]
    },
    {
        "id": "3664e53bb83334c6",
        "type": "delay",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "pauseType": "delay",
        "timeout": "4",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 480,
        "y": 140,
        "wires": [
            [
                "61ea6b2dafed34ff",
                "a9c57cc5fea578f4"
            ]
        ]
    },
    {
        "id": "f36403b4bdb0a3b9",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "get roles",
        "func": "msg.collection = \"admin_roles\"\nmsg.payload = [\n    {\n        $match:{\n            \"_id\": ObjectId(msg.payload.roles)\n        }\n    },\n    {\n        $lookup: {\n            from: 'translation',\n            as: 'translation',\n            pipeline: [\n                {\n                    $match: {\n                        deleted: false,\n                        language: msg.user.user.language\n                    }\n                }\n            ]\n        }\n    },\n    {\n        $lookup:\n        {\n            from: \"admin_modules\",\n            localField: \"permissions.moduleId\",\n            foreignField: \"_id\",\n            as: \"menu\"\n    }\n},\n]\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "ObjectId",
                "module": "objectid"
            }
        ],
        "x": 1040,
        "y": 840,
        "wires": [
            [
                "9bdeada5928fdb22"
            ]
        ]
    },
    {
        "id": "c8359b5d14016069",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 800,
        "wires": []
    },
    {
        "id": "5d9628083a55b25a",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "msg from db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 100,
        "wires": []
    },
    {
        "id": "1aa6084c940d35b0",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "msg to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 100,
        "wires": []
    },
    {
        "id": "a9c57cc5fea578f4",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "msg delay to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 680,
        "y": 180,
        "wires": []
    },
    {
        "id": "16b45fd91269424a",
        "type": "catch",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "g",
        "scope": [
            "f36403b4bdb0a3b9"
        ],
        "uncaught": false,
        "x": 1470,
        "y": 920,
        "wires": [
            [
                "8e724f7bfa9319f6",
                "6ab136250b17e86c"
            ]
        ]
    },
    {
        "id": "8e724f7bfa9319f6",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "show err Unautorizate",
        "func": "msg.payload ={\n    auth: \"Unautorizate\",\n    code: 401,\n    login_id: msg.check.login_id,\n    }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1660,
        "y": 920,
        "wires": [
            [
                "caff712e2eb791e2",
                "6ab136250b17e86c"
            ]
        ]
    },
    {
        "id": "6ab136250b17e86c",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1870,
        "y": 980,
        "wires": []
    },
    {
        "id": "1f52497bc2ed6264",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "query to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 670,
        "y": 840,
        "wires": []
    },
    {
        "id": "baba729d5c88e013",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 310,
        "y": 440,
        "wires": []
    },
    {
        "id": "f4e52f3a41956c87",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "check ",
        "func": "const regexEmail = /^(([^<>()[\\]\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@(([^<>()[\\]\\.,;:\\s@\\\"]+\\.)+[^<>()[\\]\\.,;:\\s@\\\"]{2,})$/i;\nconst regexPassword = /^(?!.*\\s).{8,}/;\nconst email = msg.payload.email.toLowerCase();\n\nif (!regexEmail.test(email)) {\n    msg.statusCode = 401;\n    msg.payload = {\n        data: \"Email is invalid\",\n        code: 401\n    }\n\n    return [null, msg];\n\n} else if (!regexPassword.test(msg.payload.password)) {\n    msg.statusCode = 401;\n    msg.payload = {\n        data: \"The password is invalid. The value must be at least 8 characters and without whitespaces\",\n        code: 401\n    }\n\n    return [null, msg];\n\n} else {\n    msg.collection = \"admins\";\n    msg.oldpayload = msg.payload;\n\n    msg.payload = {\n        email: email,\n        deleted: false\n    };\n\n    return [msg, null];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 480,
        "wires": [
            [
                "25b819b5a56c3054",
                "3443d8e7d57ade22"
            ],
            [
                "9bb0630c766c1fae",
                "1b8da8f5dff0448a"
            ]
        ]
    },
    {
        "id": "25b819b5a56c3054",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 490,
        "y": 480,
        "wires": [
            [
                "7d7b3c509b17950d",
                "56afed1bb13cc979"
            ]
        ]
    },
    {
        "id": "3443d8e7d57ade22",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "msg to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 440,
        "wires": []
    },
    {
        "id": "7d7b3c509b17950d",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "check",
        "func": "if (msg.payload.length > 0) {\n    if (!msg.payload[0].active) {\n        const decoded = jwt.verify(msg.payload[0].verifyToken, 'test');\n        const dateNow = new Date().getTime();\n\n        if (decoded.exp < dateNow) {\n            msg.query = { _id: objectid(msg.payload[0]._id) }\n            msg.payload = {\n                $set: {\n                    deleted: false\n                }\n            }\n\n            return [null, null, msg, null]\n        } else {\n            msg.payload = {\n                verifyToken: msg.payload[0].verifyToken,\n                email: msg.payload[0].email\n            }\n\n            return [null, null, null, msg]\n        }\n    } else {\n        msg.payload = {\n            data: \"This email address already exists\",\n            code: 400,\n        }\n        return [null, msg, null, null]\n    }\n}\nelse {\n    return [msg, null, null, null]\n}\n\n\n",
        "outputs": 4,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            },
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 650,
        "y": 480,
        "wires": [
            [
                "d1143196b526568d",
                "2a9c245b96099f4e"
            ],
            [
                "dca099b2fda6a31e",
                "612c15931c94db0f"
            ],
            [
                "8cbf4dcd5bda929e"
            ],
            [
                "84a3404c5002c4f7"
            ]
        ]
    },
    {
        "id": "d1143196b526568d",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "registration user",
        "func": "let bcrypt = global.get('bcrypt')\nlet jwt = global.get('jsonwebtoken')\nlet randomColor = \"#\" + Math.floor(Math.random() * 16777215).toString(16);\nlet encryptedPassword = await bcrypt.hash(msg.oldpayload.password, 10);\nconst verifyToken = await jwt.sign(\n    { id: Math.round(Math.random()) },\n    \"test\",\n    {\n        expiresIn: \"150m\",\n    }\n);\n\nmsg.cookies = {};\nmsg.cookies[\"verify_token\"] = verifyToken;\nmsg.cookies[\"email_register\"] = msg.oldpayload.email;\n\nmsg.payload = {\n    \"_id\": objectid(),\n    \"deleted\": false,\n    \"avatarColor\": randomColor,\n    \"createdAt\": new Date(),\n    \"roles\": [objectid(\"\")],\n    \"active\": false,\n    \"firstname\": msg.oldpayload.firstname,\n    \"lastname\": msg.oldpayload.lastname,\n    \"email\": msg.oldpayload.email.toLowerCase(),\n    \"password\": encryptedPassword,\n    verifyToken,\n    resetPassToken: \"\",\n    resetPassExpireToken: null\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1040,
        "y": 420,
        "wires": [
            [
                "84a3404c5002c4f7",
                "eeceed583550e3fa",
                "faaade0d0c380b57"
            ]
        ]
    },
    {
        "id": "dca099b2fda6a31e",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "statusCode": "400",
        "headers": {},
        "x": 860,
        "y": 460,
        "wires": []
    },
    {
        "id": "612c15931c94db0f",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "err when created user",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 920,
        "y": 360,
        "wires": []
    },
    {
        "id": "2a9c245b96099f4e",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 400,
        "wires": []
    },
    {
        "id": "faaade0d0c380b57",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1240,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "84a3404c5002c4f7",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "msg to email",
        "func": "const token = msg.payload.verifyToken;\nconst nodeUrl = env.get(\"nodeUrl\");\nconst url = `${nodeUrl}/verifyToken?token=${token}`;\nconst text = `\n<div style=\"padding: 10px 0; color: black;\">\n    <h1>Confirm Your Email Address</h1>\n    <p>Tap the button below to confirm your email address. If you didn't create an account, you can delete this email.</p>\n    <a href=\"${url}\" target=\"_blank\" style=\"margin: 10px 0; display: inline-block; padding: 16px 36px; font-family: 'Source Sans Pro', Helvetica, Arial, sans-serif; font-size: 16px; color: #ffffff; text-decoration: none; border-radius: 6px; background: #95e4f0;\">Confirm</a>\n</div>\n`;\n\nmsg.to = msg.payload.email;\nmsg.topic = 'Verify';\nmsg.payload = text;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 1010,
        "y": 580,
        "wires": [
            [
                "621d5d5a41669c64",
                "d5af917bfe74ba4c"
            ]
        ]
    },
    {
        "id": "eeceed583550e3fa",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1210,
        "y": 420,
        "wires": []
    },
    {
        "id": "621d5d5a41669c64",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "msg to email",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1210,
        "y": 540,
        "wires": []
    },
    {
        "id": "d5af917bfe74ba4c",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1190,
        "y": 620,
        "wires": []
    },
    {
        "id": "65b608719a7b1d8f",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "repeatRegisterEmail",
        "url": "/repeatRegisterEmail",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 680,
        "wires": [
            [
                "12507e3542cead46",
                "52911e87debd8301"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "12507e3542cead46",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "email and token",
        "func": "msg.payload = {\n    verifyToken: msg.req.cookies.verify_token,\n    email: msg.req.cookies.email_register.toLowerCase()\n}\nmsg.email = msg.req.cookies.email_register.toLowerCase();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 680,
        "wires": [
            [
                "4f4233c2503ef413",
                "fca1a6e7c2a907ba"
            ]
        ]
    },
    {
        "id": "52911e87debd8301",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 350,
        "y": 720,
        "wires": []
    },
    {
        "id": "7d24a5806739b5fb",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 910,
        "y": 720,
        "wires": []
    },
    {
        "id": "fca1a6e7c2a907ba",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "msg to email",
        "func": "const token = msg.payload.verifyToken;\nconst nodeUrl = env.get(\"nodeUrl\");\nconst url = `${nodeUrl}/verifyToken?token=${token}`;\nconst text = `\n<div style=\"padding: 10px 0; color: black;\">\n    <h1>Confirm Your Email Address</h1>\n    <p>Tap the button below to confirm your email address. If you didn't create an account, you can delete this email.</p>\n    <a href=\"${url}\" target=\"_blank\" style=\"margin: 10px 0; display: inline-block; padding: 16px 36px; font-family: 'Source Sans Pro', Helvetica, Arial, sans-serif; font-size: 16px; color: #ffffff; text-decoration: none; border-radius: 6px; background: #95e4f0;\">Confirm</a>\n</div>\n`;\n\nmsg.to = msg.payload.email;\nmsg.topic = 'Verify';\nmsg.payload = text;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 570,
        "y": 680,
        "wires": [
            [
                "38264f88df3f51f8",
                "3f2728a428f70979"
            ]
        ]
    },
    {
        "id": "38264f88df3f51f8",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "repeat msg to email",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 770,
        "y": 640,
        "wires": []
    },
    {
        "id": "4f4233c2503ef413",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "payload",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 560,
        "y": 640,
        "wires": []
    },
    {
        "id": "3f2728a428f70979",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "msg to page",
        "func": "msg.payload = {\n    data: `We sent the email \"${msg.email}\" again. Please, check your inbox or spam.`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 720,
        "wires": [
            [
                "7d24a5806739b5fb",
                "787c14ff2d5c5657"
            ]
        ]
    },
    {
        "id": "787c14ff2d5c5657",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "finish",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 680,
        "wires": []
    },
    {
        "id": "72dddb2443952553",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "registration",
        "url": "/registration",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 480,
        "wires": [
            [
                "f4e52f3a41956c87",
                "baba729d5c88e013"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "8cbf4dcd5bda929e",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 900,
        "y": 500,
        "wires": [
            [
                "d1143196b526568d"
            ]
        ]
    },
    {
        "id": "56afed1bb13cc979",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "7cf09a5628ba29e5",
        "name": "db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 540,
        "wires": []
    },
    {
        "id": "8bf11e1db155c406",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "d47c4baf98dd7d3b",
        "name": "verifyToken",
        "url": "/verifyToken",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 870,
        "y": 1220,
        "wires": [
            [
                "f05c31a436d493c1",
                "28e417acf6703c8e"
            ]
        ]
    },
    {
        "id": "b19133390f7fff7a",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "d47c4baf98dd7d3b",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1610,
        "y": 1220,
        "wires": []
    },
    {
        "id": "28e417acf6703c8e",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "d47c4baf98dd7d3b",
        "name": "query to db",
        "func": "msg.collection = \"admins\";\nmsg.cameToken = msg.payload.token;\n\nmsg.payload = {\n    verifyToken: msg.payload.token\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 1220,
        "wires": [
            [
                "38300e6abcb36ac3",
                "f8ac81b8f44aa1c1"
            ]
        ]
    },
    {
        "id": "f05c31a436d493c1",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "d47c4baf98dd7d3b",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1070,
        "y": 1180,
        "wires": []
    },
    {
        "id": "15bc335d0fad3f03",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "d47c4baf98dd7d3b",
        "name": "finish",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1630,
        "y": 1180,
        "wires": []
    },
    {
        "id": "38300e6abcb36ac3",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "d47c4baf98dd7d3b",
        "name": "query to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 1180,
        "wires": []
    },
    {
        "id": "a7b60ea648465b13",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "d47c4baf98dd7d3b",
        "name": "res db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1430,
        "y": 1180,
        "wires": []
    },
    {
        "id": "2ebbf3d403304123",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "d47c4baf98dd7d3b",
        "name": "redirect to page",
        "func": "node.warn(msg)\nconst token = await jwt.sign(\n    { user_id: msg.payload[0]._id, email: msg.payload[0].email },\n    \"test\",\n    {\n        expiresIn: \"150m\",\n    }\n);\n\nconst uiUrl = env.get(\"uiUrl\");\n\nmsg.token = token\nmsg.statusCode = 302\nmsg.headers = {\n    \"Access-Control-Allow-Origin\": \"*\",\n    \"Access-Control-Allow-Credentials\": true,\n    \"location\": `${uiUrl}/Login`\n}\n\nmsg.collection = \"admins\";\nmsg.query = {\n    _id: objectid(msg.payload[0]._id)\n}\nmsg.payload = {\n    $set: {\n        active: true,\n        verifyToken: null\n    }\n}\n\nnode.send(msg)",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            },
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1440,
        "y": 1220,
        "wires": [
            [
                "b19133390f7fff7a",
                "15bc335d0fad3f03",
                "4ca2aafdce75631b"
            ]
        ]
    },
    {
        "id": "f8ac81b8f44aa1c1",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "d47c4baf98dd7d3b",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1280,
        "y": 1220,
        "wires": [
            [
                "2ebbf3d403304123",
                "a7b60ea648465b13"
            ]
        ]
    },
    {
        "id": "4ca2aafdce75631b",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "d47c4baf98dd7d3b",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1680,
        "y": 1260,
        "wires": [
            []
        ]
    },
    {
        "id": "ab301c55037892a5",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "queryToResetPassword",
        "url": "/queryToResetPassword",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 900,
        "y": 1660,
        "wires": [
            [
                "33cd63d87b4e381c",
                "de3eb89f39a1530a"
            ]
        ]
    },
    {
        "id": "33cd63d87b4e381c",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1130,
        "y": 1620,
        "wires": []
    },
    {
        "id": "de3eb89f39a1530a",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "query to db",
        "func": "msg.collection = \"admins\";\nmsg.token = msg.payload.token;\n\nmsg.payload = {\n    resetPassToken: msg.payload.token\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1150,
        "y": 1660,
        "wires": [
            [
                "c48a80eca03bbba4",
                "c3173697fb7f4bac"
            ]
        ]
    },
    {
        "id": "c48a80eca03bbba4",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "query to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1330,
        "y": 1620,
        "wires": []
    },
    {
        "id": "c3173697fb7f4bac",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1350,
        "y": 1660,
        "wires": [
            [
                "348f8ae5da73c0d5",
                "15933ef85e8b2695"
            ]
        ]
    },
    {
        "id": "348f8ae5da73c0d5",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "redirect to page",
        "func": "const dateNow = new Date().getTime();\nconst uiUrl = env.get(\"uiUrl\");\n\nif (msg.payload[0].resetPassExpireToken > dateNow) {\n    msg.statusCode = 302\n    msg.headers = {\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Access-Control-Allow-Credentials\": true,\n        \"location\": `${uiUrl}/ResetPassword?token=${msg.token}`\n    }\n} else {\n    msg.payload = '<h1>Link expired</h1>';\n};\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "https://nodered-0131-64942bd3a77d221100000463.ubos.tech/?#objectid",
                "module": "objectid"
            },
            {
                "var": "jsonwebtoken",
                "module": "jsonwebtoken"
            }
        ],
        "x": 1520,
        "y": 1660,
        "wires": [
            [
                "b89f08cda462a95f",
                "9fec925d9c6148b0"
            ]
        ]
    },
    {
        "id": "15933ef85e8b2695",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "res db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1510,
        "y": 1620,
        "wires": []
    },
    {
        "id": "b89f08cda462a95f",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1690,
        "y": 1660,
        "wires": []
    },
    {
        "id": "9fec925d9c6148b0",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "finish queryToResetPassword",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1770,
        "y": 1620,
        "wires": []
    },
    {
        "id": "0614831a6dd18bbb",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "sendEmailForResetPassword",
        "url": "/sendEmailForResetPassword",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 920,
        "y": 1480,
        "wires": [
            [
                "0b8815511f027788",
                "acc53e48e5c37796"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "0b8815511f027788",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "query to db",
        "func": "const regexEmail = /^(([^<>()[\\]\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@(([^<>()[\\]\\.,;:\\s@\\\"]+\\.)+[^<>()[\\]\\.,;:\\s@\\\"]{2,})$/i;\nconst email = msg.payload.email.toLowerCase();\n\nif (!regexEmail.test(email)) {\n\n    msg.statusCode = 401;\n    msg.payload = {\n        data: \"Email is invalid\",\n        code: 401\n    }\n\n    return [null, msg];\n\n} else {\n    msg.collection = \"admins\";\n\n    msg.email = msg.payload.email;\n\n    msg.payload = {\n        email: email,\n        deleted: false\n    }\n\n    return [msg, null];\n} \n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1190,
        "y": 1480,
        "wires": [
            [
                "a64da465eda134a3"
            ],
            [
                "cda158a3d19d64d9",
                "7a70680f44f5df9c"
            ]
        ]
    },
    {
        "id": "acc53e48e5c37796",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1170,
        "y": 1440,
        "wires": []
    },
    {
        "id": "a64da465eda134a3",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1390,
        "y": 1480,
        "wires": [
            [
                "3839f7c847da4d06",
                "2757cb2a62d54166"
            ]
        ]
    },
    {
        "id": "3839f7c847da4d06",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "send response",
        "func": "if (msg.payload.length === 0){\n    msg.statusCode = 401;\n\n    msg.payload = {\n        data: \"Forbidden! Incorrect email.\",\n        code: 401\n    }\n    return [null, msg]\n}\n\nmsg.payload = msg.payload[0];\n    \nreturn[msg, null]\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1560,
        "y": 1480,
        "wires": [
            [
                "f949b57456c57058",
                "8427d42401796f0a"
            ],
            [
                "ca3b0d180179516b",
                "f0fde05b39c69287"
            ]
        ]
    },
    {
        "id": "2757cb2a62d54166",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "Item after DB",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1550,
        "y": 1440,
        "wires": []
    },
    {
        "id": "f949b57456c57058",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "item",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1730,
        "y": 1420,
        "wires": []
    },
    {
        "id": "8427d42401796f0a",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "query to db",
        "func": "// Add 30 minutes\nconst date = new Date();\nconst expireTime = date.setMinutes(date.getMinutes() + 30);\nconst token = crypto.randomBytes(64).toString('hex');\n\nmsg.oldpayload = msg.payload;\nmsg.token = token;\n\nmsg.cookies = {};\nmsg.cookies[\"user_email\"] = msg.email;\n\nmsg.collection = \"admins\";\nmsg.query = {\n    _id: objectid(msg.payload._id)\n}\nmsg.payload = {\n    $set: {\n        resetPassToken: token,\n        resetPassExpireToken: expireTime\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            },
            {
                "var": "crypto",
                "module": "crypto"
            }
        ],
        "x": 1750,
        "y": 1460,
        "wires": [
            [
                "cb0efb585b6584ea",
                "5b474b857331162b",
                "216c8a6f073f5011"
            ]
        ]
    },
    {
        "id": "ca3b0d180179516b",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1730,
        "y": 1500,
        "wires": []
    },
    {
        "id": "f0fde05b39c69287",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "err email not found",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1770,
        "y": 1540,
        "wires": []
    },
    {
        "id": "cb0efb585b6584ea",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "query to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 1380,
        "wires": []
    },
    {
        "id": "5b474b857331162b",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "msg to email",
        "func": "const nodeUrl = env.get(\"nodeUrl\");\nconst url = `${nodeUrl}/queryToResetPassword?token=${msg.token}`;\n\nconst text = `\n<div style=\"padding: 10px 0; color: black;\">\n    <h1>We received a request to reset your password</h1>\n    <p>Use the link below to set up a new password for your account. If you did not request to reset your password, ignore this email and the link will expire on its own.</p>\n    <a href=\"${url}\" target=\"_blank\" style=\"margin: 10px 0; display: inline-block; padding: 16px 36px; font-family: 'Source Sans Pro', Helvetica, Arial, sans-serif; font-size: 16px; color: #ffffff; text-decoration: none; border-radius: 6px; background: #2E3D49;\">\n        SET NEW PASSWORD\n    </a>\n</div>\n`;\n\nmsg.to = msg.oldpayload.email;\nmsg.topic = 'Reset password';\nmsg.payload = text;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 1930,
        "y": 1460,
        "wires": [
            [
                "47112228019a0ace",
                "73896d5cbf2b11df"
            ]
        ]
    },
    {
        "id": "216c8a6f073f5011",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1980,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "47112228019a0ace",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2150,
        "y": 1500,
        "wires": []
    },
    {
        "id": "73896d5cbf2b11df",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "finish sendEmailForResetPassword",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2240,
        "y": 1420,
        "wires": []
    },
    {
        "id": "8bd61a8f68025413",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "resetPassword",
        "url": "/resetPassword",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 880,
        "y": 1860,
        "wires": [
            [
                "faf358394ddc4fe6",
                "e5a3c3eb0171a5bd"
            ]
        ],
        "icon": "font-awesome/fa-edit"
    },
    {
        "id": "faf358394ddc4fe6",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "came resetPassword",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1120,
        "y": 1820,
        "wires": []
    },
    {
        "id": "e5a3c3eb0171a5bd",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "query to db",
        "func": "msg.newPassword = msg.payload.password;\n\nmsg.collection = \"admins\";\nmsg.payload = {\n    resetPassToken: msg.payload.token\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 1860,
        "wires": [
            [
                "f393416741ceb5bb"
            ]
        ]
    },
    {
        "id": "f393416741ceb5bb",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1280,
        "y": 1860,
        "wires": [
            [
                "1e3f1d731ea39467",
                "f94300e01993e46c"
            ]
        ]
    },
    {
        "id": "f94300e01993e46c",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "query update pass",
        "func": "let bcrypt = global.get('bcrypt')\nlet jwt = global.get('jsonwebtoken')\nconst dateNow = new Date().getTime();\nlet check = await bcrypt.compare(msg.newPassword, msg.payload[0].password);\nlet encryptedPassword = await bcrypt.hash(msg.newPassword, 10);\n\nmsg.oldpayload = msg.payload;\n\nif (msg.payload[0].resetPassExpireToken < dateNow) {\n\n    msg.payload = '<h1>link expired</h1>';\n\n} else {\n\n    if (!!check) {\n\n        msg.statusCode = 401;\n        msg.payload = {\n            data: 'The password must be different from the previous one',\n            code: 401\n        }\n\n        return [null, msg];\n\n    } else {\n        \n        msg.collection = \"admins\";\n        msg.query = {\n            _id: objectid(msg.payload[0]._id)\n        }\n        msg.payload = {\n            $set: {\n                password: encryptedPassword,\n                resetPassToken: \"\",\n                resetPassExpireToken: null\n            }\n        }\n        \n        return [msg, null];\n\n    }\n\n}\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1470,
        "y": 1860,
        "wires": [
            [
                "36f9a70a94832862",
                "030414dfd3ed59a5",
                "fcb9bc55f1082cf3"
            ],
            [
                "6ed5acebd2a44763"
            ]
        ]
    },
    {
        "id": "1e3f1d731ea39467",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "res db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1430,
        "y": 1820,
        "wires": []
    },
    {
        "id": "36f9a70a94832862",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "query to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1670,
        "y": 1780,
        "wires": []
    },
    {
        "id": "030414dfd3ed59a5",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "msg to email",
        "func": "const uiUrl = env.get(\"uiUrl\");\nconst url = `${uiUrl}/Login`;\nconst dateChanged = new Date().toString().slice(0, 24);\nconst text = `\n<div style=\"padding: 10px 0; color: black;\" display: block;>\n    <img src=\"https://www.iconpacks.net/icons/2/free-icon-check-mark-3280.png\"; alt=\"Success Icon\"; width=90px; height=90px;>\n    <h1 text-align=\"center\" >Password changed!</h1>\n    <p>\n        Your password has been changed successfully. \n        This is a confirmation that your password was changed at <b>${dateChanged}</b>\n        <br><br>\n        Use your new password to log in.\n    </p>\n    <a href=\"${url}\" target=\"_blank\" style=\"margin: 10px 0; display: inline-block; padding: 16px 36px; font-family: 'Source Sans Pro', Helvetica, Arial, sans-serif; font-size: 16px; color: #ffffff; text-decoration: none; border-radius: 6px; background: #72D393;\">\n        <b>LOGIN NOW</b>\n    </a>\n</div>\n`;\n\nmsg.to = msg.oldpayload[0].email;\nmsg.topic = 'Password changed';\nmsg.payload = text;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 1670,
        "y": 1860,
        "wires": [
            [
                "c5b4ccce77d03e87",
                "0617a8c9543f9896"
            ]
        ]
    },
    {
        "id": "fcb9bc55f1082cf3",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1680,
        "y": 1820,
        "wires": [
            []
        ]
    },
    {
        "id": "c5b4ccce77d03e87",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "finish sendEmailForResetPassword",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1960,
        "y": 1780,
        "wires": []
    },
    {
        "id": "0617a8c9543f9896",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1870,
        "y": 1860,
        "wires": []
    },
    {
        "id": "6ed5acebd2a44763",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "same pasword",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1680,
        "y": 1920,
        "wires": [
            [
                "5322da50da8b810a"
            ]
        ]
    },
    {
        "id": "5322da50da8b810a",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "b69c8ee37e3e0852",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1850,
        "y": 1920,
        "wires": []
    },
    {
        "id": "f5be1263c0467e95",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "delete user query",
        "func": "msg.collection = \"admins\"\n\nmsg.query = {\n    \"_id\": objectid(msg.payload._id)\n};\n\nmsg.payload = {\n    $set: { \"deleted\": true }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 350,
        "y": 3400,
        "wires": [
            [
                "9c4e434bd50c7629",
                "6f74a492cde629ef",
                "055f25983fece25e"
            ]
        ]
    },
    {
        "id": "e06c13c7edcdcd74",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "get users query",
        "func": "msg.collection = \"admins\";\n\nmsg.payload=[\n    {\n      $match:{\n        deleted:false\n      }\n    },\n    {\n      $lookup: {\n       \"from\": \"admin_roles\",\n       \"localField\": \"roles\",\n       \"foreignField\":\"_id\",\n       \"as\": \"role_items\"\n     }\n    }\n]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 3120,
        "wires": [
            [
                "ac19deab86cb78e0",
                "db9c3ea65883774f"
            ]
        ]
    },
    {
        "id": "e53113f64379a00a",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "getUsers",
        "url": "/getUsers",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 3120,
        "wires": [
            [
                "e06c13c7edcdcd74"
            ]
        ]
    },
    {
        "id": "ac19deab86cb78e0",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "",
        "links": [
            "56c2fced239f2936"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 560,
        "y": 3120,
        "wires": [
            [
                "c905fee71d44c8d6",
                "4cbf03980d53b40c"
            ]
        ]
    },
    {
        "id": "4cbf03980d53b40c",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 910,
        "y": 3120,
        "wires": []
    },
    {
        "id": "c905fee71d44c8d6",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "all users",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 3080,
        "wires": []
    },
    {
        "id": "cbe2971087f33fe5",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "editUserRole",
        "url": "/editUserRole",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 3240,
        "wires": [
            [
                "805f5b498ea3ba78"
            ]
        ],
        "icon": "font-awesome/fa-edit"
    },
    {
        "id": "805f5b498ea3ba78",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "edit role query",
        "func": "msg.collection = \"admins\";\n\nmsg.query = {\n    \"_id\": objectid(msg.payload._id)\n}\n\nmsg.payload = {\n    $set: {\n        \"roles\": [objectid(msg.payload.role)]\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 340,
        "y": 3240,
        "wires": [
            [
                "30c126c804b1a781",
                "751980e9e08597cb",
                "ca45317f305a9e94"
            ]
        ]
    },
    {
        "id": "751980e9e08597cb",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 580,
        "y": 3200,
        "wires": [
            []
        ]
    },
    {
        "id": "30c126c804b1a781",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 510,
        "y": 3240,
        "wires": []
    },
    {
        "id": "ca45317f305a9e94",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "user role edited",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 540,
        "y": 3280,
        "wires": []
    },
    {
        "id": "11ae1973a48d1646",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "deleteUser",
        "url": "/deleteUser",
        "method": "delete",
        "upload": true,
        "swaggerDoc": "",
        "x": 100,
        "y": 3400,
        "wires": [
            [
                "f5be1263c0467e95"
            ]
        ],
        "icon": "font-awesome/fa-remove"
    },
    {
        "id": "9c4e434bd50c7629",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "deleteUser msg to DB",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 580,
        "y": 3440,
        "wires": []
    },
    {
        "id": "055f25983fece25e",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 530,
        "y": 3400,
        "wires": []
    },
    {
        "id": "6f74a492cde629ef",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 600,
        "y": 3360,
        "wires": [
            []
        ]
    },
    {
        "id": "52c5f9f84fbd0e5a",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "createUser",
        "url": "/createUser",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 3580,
        "wires": [
            [
                "1cfa1bef551eea8c",
                "5a847e417c0b356f"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "1cfa1bef551eea8c",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "query",
        "func": "msg.collection = \"admins\";\nmsg.oldpayload = msg.payload;\n\nmsg.payload = {\n    email: msg.payload.email,\n    deleted: false\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 3580,
        "wires": [
            [
                "a09abdd606dfe92f",
                "e7b39c38c93e3854"
            ]
        ]
    },
    {
        "id": "5a847e417c0b356f",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 310,
        "y": 3620,
        "wires": []
    },
    {
        "id": "a09abdd606dfe92f",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 480,
        "y": 3580,
        "wires": [
            [
                "9159b9aa416b3084",
                "755a42caae4e1af0"
            ]
        ]
    },
    {
        "id": "e7b39c38c93e3854",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "msg to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 3540,
        "wires": []
    },
    {
        "id": "9159b9aa416b3084",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "check",
        "func": "if (msg.payload.length > 0) {\n    msg.payload = {\n        data: \"This email address already exists\",\n        code: 400,\n    }\n    return [null, msg]\n}\nelse{\n    return [msg, null]\n}\n\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 3580,
        "wires": [
            [
                "f1cc129781765941",
                "34bdf0171571de42"
            ],
            [
                "c6e9cd738f822557",
                "830a855b4d7f7858"
            ]
        ]
    },
    {
        "id": "755a42caae4e1af0",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 3620,
        "wires": []
    },
    {
        "id": "c6e9cd738f822557",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "",
        "statusCode": "400",
        "headers": {},
        "x": 820,
        "y": 3620,
        "wires": []
    },
    {
        "id": "830a855b4d7f7858",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "err when created user",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 860,
        "y": 3660,
        "wires": []
    },
    {
        "id": "f1cc129781765941",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "registration user",
        "func": "let bcrypt = global.get('bcrypt')\nlet jwt = global.get('jsonwebtoken')\nlet randomColor = \"#\" + Math.floor(Math.random() * 16777215).toString(16);\nlet encryptedPassword = await bcrypt.hash(msg.oldpayload.password, 10);\n\nmsg.payload = {\n    \"_id\": objectid(),\n    \"deleted\": false,\n    \"avatarColor\": randomColor,\n    \"createdAt\": new Date(),\n    \"roles\": [objectid(msg.oldpayload.role)],\n    \"active\": true,\n    \"firstname\": msg.oldpayload.firstname,\n    \"lastname\": msg.oldpayload.lastname,\n    \"email\": msg.oldpayload.email,\n    \"password\": encryptedPassword,\n    verifyToken: null,\n    resetPassToken: \"\",\n    resetPassExpireToken: null\n}\n\nreturn msg;\n\n\n\n\n\n\n\n// let randomColor = \"#\" + Math.floor(Math.random() * 16777215).toString(16);\n// let encryptedPassword = await bcrypt.hash(msg.oldpayload.password, 10);\n// const verifyToken = await jwt.sign(\n//     { id: Math.round(Math.random()) },\n//     \"test\",\n//     {\n//         expiresIn: \"150m\",\n//     }\n// );\n\n// msg.cookies = {};\n// msg.cookies[\"verify_token\"] = verifyToken;\n// msg.cookies[\"email_register\"] = msg.oldpayload.email;\n\n// msg.payload = {\n//     \"_id\": objectid(),\n//     \"deleted\": false,\n//     \"avatarColor\": randomColor,\n//     \"createdAt\": new Date(),\n//     \"roles\": [objectid(\"634fe97d28c82b00103cd25d\")],\n//     \"active\": false,\n//     \"firstname\": msg.oldpayload.firstname,\n//     \"lastname\": msg.oldpayload.lastname,\n//     \"email\": msg.oldpayload.email,\n//     \"password\": encryptedPassword,\n//     verifyToken,\n//     resetPassToken: \"\",\n//     resetPassExpireToken: null\n// }\n\n// return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 840,
        "y": 3560,
        "wires": [
            [
                "8d02360a631dcfd2",
                "4db5cfe770e539c9",
                "b8b946c615b8106b"
            ]
        ]
    },
    {
        "id": "34bdf0171571de42",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 810,
        "y": 3520,
        "wires": []
    },
    {
        "id": "8d02360a631dcfd2",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1050,
        "y": 3600,
        "wires": []
    },
    {
        "id": "4db5cfe770e539c9",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1090,
        "y": 3520,
        "wires": [
            []
        ]
    },
    {
        "id": "b8b946c615b8106b",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1050,
        "y": 3560,
        "wires": []
    },
    {
        "id": "db9c3ea65883774f",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "1c10aa09f2bae3b6",
        "name": "all users",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 3080,
        "wires": []
    },
    {
        "id": "e7fd978ce87aca9f",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "createParentModule",
        "url": "/createParentModule",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 2280,
        "wires": [
            [
                "d70a394b4312d3ef",
                "c2b7abe6d2dfa874"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "85568b61aa0c227a",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 510,
        "y": 2240,
        "wires": []
    },
    {
        "id": "d70a394b4312d3ef",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "func": "msg.collection = \"admin_modules\"\n\nmsg.payload = {\n    ...msg.payload,\n    deleted: false,\n    isParent: false\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 2280,
        "wires": [
            [
                "9552e6aaf4e9e730",
                "85568b61aa0c227a"
            ]
        ]
    },
    {
        "id": "5d71844b960e0965",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "getModules",
        "url": "/getModules",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 2160,
        "wires": [
            [
                "aa8ef0110ab08941"
            ]
        ]
    },
    {
        "id": "5c368970a09368c6",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 630,
        "y": 2160,
        "wires": []
    },
    {
        "id": "aa8ef0110ab08941",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "func": "msg.collection=\"admin_modules\"\nmsg.payload={\n    deleted:false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 2160,
        "wires": [
            [
                "4c265b78766e0676"
            ]
        ]
    },
    {
        "id": "376174881ff1a55a",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "createChildModule",
        "url": "/createChildModule",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 2680,
        "wires": [
            [
                "232d8d9e33cae211"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "061a5e02eefac437",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 510,
        "y": 2680,
        "wires": []
    },
    {
        "id": "232d8d9e33cae211",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "query",
        "func": "msg.collection = \"admin_modules\";\n\nif (msg.payload.parentModule) {\n    msg.query={\n        \"_id\": objectid(msg.payload.parentModule)\n    };\n\n    msg.payload = {\n        $addToSet: {\n            childModules: {\n                name: msg.payload.childModule,\n                page_id: msg.payload.childModule,\n                position: msg.payload.position\n            }\n        },\n        $set: {\n            isParent: true\n        }\n    }\n\n    return [msg,];\n} else {\n    \n    \n    msg.payload={\n        ...msg.payload,\n        deleted: false,\n        isParent: false\n    }\n    return [,msg];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 350,
        "y": 2680,
        "wires": [
            [
                "b29925263067250f",
                "061a5e02eefac437"
            ],
            [
                "7800f240d6ce9d3c",
                "061a5e02eefac437"
            ]
        ]
    },
    {
        "id": "a52c0bddea4b8ea1",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "deleteChildModule",
        "url": "/deleteChildModule",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 2960,
        "wires": [
            [
                "1c83404957bea119",
                "f085a549ae9699b7"
            ]
        ],
        "icon": "font-awesome/fa-remove"
    },
    {
        "id": "1c83404957bea119",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "query",
        "func": "msg.collection=\"admin_modules\";\n\nmsg.query = {\n    \"_id\": objectid(msg.payload._id)\n};\n\nmsg.payload = {\n    $pull: {\n        \"childModules\": {\n            \"name\": msg.payload.childModule_id\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 350,
        "y": 2960,
        "wires": [
            [
                "dc98a8249850bce2",
                "6fbefd201f3acbfd"
            ]
        ]
    },
    {
        "id": "6fbefd201f3acbfd",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 510,
        "y": 2920,
        "wires": []
    },
    {
        "id": "4c265b78766e0676",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 480,
        "y": 2160,
        "wires": [
            [
                "5c368970a09368c6",
                "2c7eed711063667b"
            ]
        ]
    },
    {
        "id": "dc98a8249850bce2",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 560,
        "y": 2960,
        "wires": [
            []
        ]
    },
    {
        "id": "7800f240d6ce9d3c",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 540,
        "y": 2720,
        "wires": [
            []
        ]
    },
    {
        "id": "b29925263067250f",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 560,
        "y": 2640,
        "wires": [
            []
        ]
    },
    {
        "id": "9552e6aaf4e9e730",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 540,
        "y": 2280,
        "wires": [
            []
        ]
    },
    {
        "id": "f085a549ae9699b7",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 350,
        "y": 2920,
        "wires": []
    },
    {
        "id": "2730235d0daf0113",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 350,
        "y": 2800,
        "wires": []
    },
    {
        "id": "ace4106e83f92bd4",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 580,
        "y": 2840,
        "wires": [
            []
        ]
    },
    {
        "id": "3d521620d0c4a209",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "updateChildModule",
        "url": "/updateChildModule",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 2840,
        "wires": [
            [
                "c5a49592c2319b79",
                "2730235d0daf0113"
            ]
        ],
        "icon": "font-awesome/fa-edit"
    },
    {
        "id": "c5a49592c2319b79",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "query",
        "func": "msg.collection = \"admin_modules\";\n\nmsg.query = {\n    \"_id\": objectid(msg.payload._id),\n    \"childModules.name\": msg.payload.name\n};\n\nmsg.payload = {\n    $set: {\n        \"childModules.$.position\": msg.payload.position\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 350,
        "y": 2840,
        "wires": [
            [
                "ace4106e83f92bd4",
                "69b2546c20e0f849"
            ]
        ]
    },
    {
        "id": "69b2546c20e0f849",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 530,
        "y": 2800,
        "wires": []
    },
    {
        "id": "c2b7abe6d2dfa874",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 350,
        "y": 2240,
        "wires": []
    },
    {
        "id": "2c7eed711063667b",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "all modules",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 2120,
        "wires": []
    },
    {
        "id": "e293cccc7303a4fe",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 330,
        "y": 2480,
        "wires": []
    },
    {
        "id": "ae8e77cbc6311e1a",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "\"deleted\": true",
        "func": "msg.collection = \"admin_modules\";\n\nmsg.query = {\n    \"_id\": objectid(msg.payload._id)\n};\n\nmsg.payload = {\n    $set: {\n        deleted: true\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 360,
        "y": 2520,
        "wires": [
            [
                "5f292bba63355586",
                "32729a9b111b8383"
            ]
        ]
    },
    {
        "id": "ee6d35faa631e26d",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "url": "/deleteModule",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 2540,
        "wires": [
            [
                "ae8e77cbc6311e1a",
                "4344a46a2b2adc00",
                "e293cccc7303a4fe",
                "133ba599444e0f8b"
            ]
        ]
    },
    {
        "id": "5f292bba63355586",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "finsih parent delete",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 2520,
        "wires": []
    },
    {
        "id": "32729a9b111b8383",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 580,
        "y": 2520,
        "wires": [
            [
                "5f292bba63355586"
            ]
        ]
    },
    {
        "id": "4344a46a2b2adc00",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "delete using pull",
        "func": "msg.collection = \"admin_roles\"\n\nmsg.query = {\n    \"permissions.moduleId\": objectid(msg.payload._id)\n}\n\nmsg.payload =\n    { $pull: { \"permissions\": { \"moduleId\": objectid(msg.payload._id) } } }\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 360,
        "y": 2560,
        "wires": [
            [
                "1cee9102777633e6",
                "d9f3e63efb88e1c2"
            ]
        ]
    },
    {
        "id": "1cee9102777633e6",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "finish childs delete",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 2560,
        "wires": []
    },
    {
        "id": "133ba599444e0f8b",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 730,
        "y": 2540,
        "wires": []
    },
    {
        "id": "d9f3e63efb88e1c2",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 580,
        "y": 2560,
        "wires": [
            [
                "1cee9102777633e6"
            ]
        ]
    },
    {
        "id": "1d7ed8fcc9ca2114",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "update roles",
        "func": "msg.collection = \"admin_roles\";\n\nmsg.query = {\n    \"permissions.moduleId\": objectid(msg.payload._id)\n    }\n\nmsg.payload = {\n    $set: {\n        \"permissions.$.module\": msg.payload.name\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 330,
        "y": 2360,
        "wires": [
            [
                "0fd0d2b6ef60273a",
                "aea44c2995d364d2"
            ]
        ]
    },
    {
        "id": "02e59b0e8b788849",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "updateParentModule",
        "url": "/updateParentModule",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 2380,
        "wires": [
            [
                "bc255567ba2f7b55",
                "1d7ed8fcc9ca2114",
                "0da57daeb8571c67"
            ]
        ],
        "icon": "font-awesome/fa-edit"
    },
    {
        "id": "0fd0d2b6ef60273a",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "finish",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 830,
        "y": 2360,
        "wires": []
    },
    {
        "id": "aea44c2995d364d2",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 540,
        "y": 2360,
        "wires": [
            []
        ]
    },
    {
        "id": "0da57daeb8571c67",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 710,
        "y": 2380,
        "wires": []
    },
    {
        "id": "bc255567ba2f7b55",
        "type": "function",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "update parent",
        "func": "msg.collection = \"admin_modules\";\n\nmsg.query = {\n    _id: objectid(msg.payload._id)\n};\n\nmsg.payload = {\n    $set: {\n        icon: msg.payload.icon,\n        position: msg.payload.position,\n        name: msg.payload.name\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 340,
        "y": 2400,
        "wires": [
            [
                "aed0f134a3d46198",
                "22995a8e4464c6e5"
            ]
        ]
    },
    {
        "id": "aed0f134a3d46198",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 560,
        "y": 2400,
        "wires": [
            []
        ]
    },
    {
        "id": "22995a8e4464c6e5",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "finish",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 2400,
        "wires": []
    },
    {
        "id": "dfc0082f4e1725eb",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "name": "",
        "url": "/checkData",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 4020,
        "wires": [
            [
                "0ed5ffc9543206b2"
            ]
        ]
    },
    {
        "id": "0ed5ffc9543206b2",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "get users query",
        "func": "msg.collection = \"admins\";\n\nmsg.payload= {\n        deleted:false\n      }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 4020,
        "wires": [
            [
                "a16c674049b8b976"
            ]
        ]
    },
    {
        "id": "a16c674049b8b976",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 470,
        "y": 4020,
        "wires": [
            [
                "c72a2c8a045b457d"
            ]
        ]
    },
    {
        "id": "70ee1c32372fcc96",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 810,
        "y": 4020,
        "wires": []
    },
    {
        "id": "9a8108100cd6ee7f",
        "type": "http in",
        "z": "f4036141cc030bcf",
        "name": "",
        "url": "/makeSetting",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 4080,
        "wires": [
            [
                "dfad2ae10a1f2170"
            ]
        ]
    },
    {
        "id": "87633d946b21622f",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "admin_modules",
        "func": "if(msg.payload.length===0){\n     msg.payload = [\n     { \"name\": \"App settings\", \"position\": 1, \"icon\": \"\", \"deleted\": false, \"isParent\": false }, \n     { \"name\": \"Demo\", \"position\": 2, \"icon\": \"\", \"deleted\": false, \"isParent\": false },\n     { \"name\": \"Base\", \"position\": 3, \"icon\": \"\", \"deleted\": false, \"isParent\": false }, \n     { \"name\": \"Users\", \"position\": 4, \"icon\": \"\", \"deleted\": false, \"isParent\": false }, \n     { \"name\": \"Management\", \"position\": 5, \"icon\": \"\", \"deleted\": false, \"isParent\": true, \"childModules\": [{ \"name\": \"Modules\", \"page_id\": \"Modules\", \"position\": 1 }, { \"name\": \"AdminRoles\", \"page_id\": \"AdminRoles\", \"position\": 2 }, { \"name\": \"User Management\", \"page_id\": \"User Management\", \"position\": 3 }] }\n     ]\nmsg.collection = \"admin_modules\"\n\nreturn msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 4080,
        "wires": [
            [
                "b2a92124f982054e",
                "33be9c73fb386787"
            ]
        ]
    },
    {
        "id": "b2a92124f982054e",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "name": "find_",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 770,
        "y": 4080,
        "wires": [
            [
                "27cb7798ca8f35c8",
                "5d3d35e852dc7f1d"
            ]
        ]
    },
    {
        "id": "62b62daee225d3a2",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "get module",
        "func": "msg.collection = \"admin_modules\"\nmsg.payload={deleted:false}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 4080,
        "wires": [
            [
                "70e4181ae3f0275a",
                "31b68e0532fa7867"
            ]
        ]
    },
    {
        "id": "70e4181ae3f0275a",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "name": "find_",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1130,
        "y": 4080,
        "wires": [
            [
                "ad8d80973130a52d",
                "248459854d23f5ab"
            ]
        ]
    },
    {
        "id": "ad8d80973130a52d",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "admin_roles",
        "func": "msg.payload=\n        { \"name\": \"admin\", \"deleted\": false, \"permissions\": [\n            { \"module\": \"App settings\", \"moduleId\": msg.payload.filter(e => e.name ==='App settings')[0]._id, \"canCreate\": true, \"canRead\": true, \"canEdit\": true, \"canRemove\": true }, \n            { \"module\": \"Demo\", \"moduleId\": msg.payload.filter(e => e.name === 'Demo')[0]._id, \"canCreate\": true, \"canRead\": true, \"canEdit\": true, \"canRemove\": true }, \n            { \"module\": \"Base\", \"moduleId\": msg.payload.filter(e => e.name === 'Base')[0]._id, \"canCreate\": true, \"canRead\": true, \"canEdit\": true, \"canRemove\": true }, \n            { \"module\": \"Users\", \"moduleId\": msg.payload.filter(e => e.name === 'Users')[0]._id, \"canCreate\": true, \"canRead\": true, \"canEdit\": true, \"canRemove\": true }, \n            { \"module\": \"Management\", \"moduleId\": msg.payload.filter(e => e.name === 'Management')[0]._id, \"canCreate\": true, \"canRead\": true, \"canEdit\": true, \"canRemove\": true }], \n        \"createdAt\":Date.now() }\n        \nmsg.collection = \"admin_roles\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 4080,
        "wires": [
            [
                "5116a17ede9b9174",
                "a760317f5d87d5e0"
            ]
        ]
    },
    {
        "id": "5116a17ede9b9174",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "name": "find_",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1450,
        "y": 4080,
        "wires": [
            [
                "961e3c913cd2112c",
                "36e76b17892bcd11"
            ]
        ]
    },
    {
        "id": "7daf979c3e2c7a76",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "get roles",
        "func": "msg.collection = \"admin_roles\"\nmsg.payload={deleted:false}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1660,
        "y": 4080,
        "wires": [
            [
                "2f1541549a290ef7",
                "82d0377b6a70b903"
            ]
        ]
    },
    {
        "id": "2f1541549a290ef7",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "name": "find_",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1810,
        "y": 4080,
        "wires": [
            [
                "89a826aed605c070",
                "26fccf484ffe2b48"
            ]
        ]
    },
    {
        "id": "89a826aed605c070",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "admins",
        "func": "let bcrypt = global.get('bcrypt')\nlet result = '';\nconst characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\nconst charactersLength = characters.length;\nfor (let i = 0; i < 8; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n}\n\nlet encryptedPassword = await bcrypt.hash(result, 10);\n\nmsg.password=result\nmsg.payload = {\n    \"deleted\": false,\n    \"avatarColor\": \"#80f124\",\n    \"createdAt\": Date.now(),\n    \"roles\": [msg.payload[0]._id],\n    \"active\": true,\n    \"firstname\": \"admin\",\n    \"lastname\": \"admin\",\n    \"email\": \"admin@ubos.tech\",\n    \"password\": encryptedPassword,\n    \"verifyToken\": null,\n    \"resetPassToken\": \"\",\n    \"resetPassExpireToken\": null\n}\nmsg.collection = \"admins\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1940,
        "y": 4080,
        "wires": [
            [
                "a38a8f1480c9758d",
                "94fe01e84d30294a"
            ]
        ]
    },
    {
        "id": "a38a8f1480c9758d",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "name": "find_",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2090,
        "y": 4080,
        "wires": [
            [
                "f9a5ece7a7b6bc85",
                "d7163630a6c0c37c"
            ]
        ]
    },
    {
        "id": "7c4aea010b5ff46a",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "get admin",
        "func": "msg.collection = \"admins\";\n\nmsg.payload = {\n    \"deleted\": false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2300,
        "y": 4080,
        "wires": [
            [
                "44c1d1f78ec482d1",
                "f3e4d8f73264ddf6"
            ]
        ]
    },
    {
        "id": "44c1d1f78ec482d1",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "name": "find_",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2450,
        "y": 4080,
        "wires": [
            [
                "ea6e2fbb4b416587",
                "8af0df21aadf4c84"
            ]
        ]
    },
    {
        "id": "ea6e2fbb4b416587",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "send response",
        "func": "msg.payload={\n    error: false,\n    email: msg.payload[0].email,\n    password: msg.password\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2600,
        "y": 4080,
        "wires": [
            [
                "ebea711cc8d850d3",
                "f3e689179c45a333",
                "5043535bb60779a6"
            ]
        ]
    },
    {
        "id": "ebea711cc8d850d3",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2750,
        "y": 4080,
        "wires": []
    },
    {
        "id": "27cb7798ca8f35c8",
        "type": "delay",
        "z": "f4036141cc030bcf",
        "name": "",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 875,
        "y": 4080,
        "wires": [
            [
                "62b62daee225d3a2"
            ]
        ],
        "l": false
    },
    {
        "id": "961e3c913cd2112c",
        "type": "delay",
        "z": "f4036141cc030bcf",
        "name": "",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1565,
        "y": 4080,
        "wires": [
            [
                "7daf979c3e2c7a76"
            ]
        ],
        "l": false
    },
    {
        "id": "f9a5ece7a7b6bc85",
        "type": "delay",
        "z": "f4036141cc030bcf",
        "name": "",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2205,
        "y": 4080,
        "wires": [
            [
                "7c4aea010b5ff46a"
            ]
        ],
        "l": false
    },
    {
        "id": "c72a2c8a045b457d",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "function 347",
        "func": "if(msg.payload.length>0){\n    msg.payload=[{data:true}]\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 4020,
        "wires": [
            [
                "70ee1c32372fcc96"
            ]
        ]
    },
    {
        "id": "daa9252c4d5e4a15",
        "type": "inject",
        "z": "f4036141cc030bcf",
        "g": "a89d39ed625d493a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 2200,
        "wires": [
            [
                "aa8ef0110ab08941"
            ]
        ]
    },
    {
        "id": "8f1a371dd4f3b4c8",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "check_",
        "func": "msg.collection = \"admins\";\n\nmsg.payload= {\n        deleted:false\n      }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 4080,
        "wires": [
            [
                "d9b51a25d7cf31a5",
                "48e1b949ea4ae66e"
            ]
        ]
    },
    {
        "id": "d9b51a25d7cf31a5",
        "type": "link call",
        "z": "f4036141cc030bcf",
        "name": "find_",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 470,
        "y": 4080,
        "wires": [
            [
                "87633d946b21622f",
                "9560b4401de9504f"
            ]
        ]
    },
    {
        "id": "dfad2ae10a1f2170",
        "type": "delay",
        "z": "f4036141cc030bcf",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 245,
        "y": 4080,
        "wires": [
            [
                "8f1a371dd4f3b4c8"
            ]
        ],
        "l": false
    },
    {
        "id": "25fbfb6c510a78e3",
        "type": "catch",
        "z": "f4036141cc030bcf",
        "name": "",
        "scope": [
            "9a8108100cd6ee7f",
            "87633d946b21622f",
            "62b62daee225d3a2",
            "ad8d80973130a52d",
            "7daf979c3e2c7a76",
            "89a826aed605c070",
            "7c4aea010b5ff46a",
            "ea6e2fbb4b416587",
            "44c1d1f78ec482d1"
        ],
        "uncaught": false,
        "x": 130,
        "y": 4300,
        "wires": [
            [
                "909b6dc35a1bf271",
                "b8765ebf35fcbee2",
                "fcdafe8c0d80cff3",
                "dbd0601d6a61d27f"
            ]
        ]
    },
    {
        "id": "fcdafe8c0d80cff3",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "function 351",
        "func": "msg.payload={}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 4360,
        "wires": [
            [
                "1b5e108dc61af00c"
            ]
        ]
    },
    {
        "id": "909b6dc35a1bf271",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "function 352",
        "func": "msg.payload={}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 4240,
        "wires": [
            [
                "9979252923793062"
            ]
        ]
    },
    {
        "id": "b8765ebf35fcbee2",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "function 353",
        "func": "msg.payload={}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 4300,
        "wires": [
            [
                "c6316eee1e014afc"
            ]
        ]
    },
    {
        "id": "ba4b22d80c1c5e19",
        "type": "http response",
        "z": "f4036141cc030bcf",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 610,
        "y": 4420,
        "wires": []
    },
    {
        "id": "dbd0601d6a61d27f",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "function 354",
        "func": "msg.statusCode===200\nmsg.payload={\n    error: true\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 4420,
        "wires": [
            [
                "ba4b22d80c1c5e19"
            ]
        ]
    },
    {
        "id": "f3e689179c45a333",
        "type": "function",
        "z": "f4036141cc030bcf",
        "name": "function 355",
        "func": "if(msg.payload.error===false){\nmsg.url =`http://nodered-svc.nodered:1880/checkUserTime`\nmsg.payload={\n    id: env.get(\"USER_ID\")\n}\nreturn msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2770,
        "y": 4120,
        "wires": [
            [
                "25823646b3e742b1",
                "870b84aa943a56e1"
            ]
        ]
    },
    {
        "id": "25823646b3e742b1",
        "type": "http request",
        "z": "f4036141cc030bcf",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 2970,
        "y": 4120,
        "wires": [
            [
                "870b84aa943a56e1"
            ]
        ]
    },
    {
        "id": "870b84aa943a56e1",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 481",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2790,
        "y": 4160,
        "wires": []
    },
    {
        "id": "1b5e108dc61af00c",
        "type": "mongodb out",
        "z": "f4036141cc030bcf",
        "mongodb": "7908a755f1520aa7",
        "name": "",
        "collection": "admin_roles",
        "payonly": false,
        "upsert": false,
        "multi": false,
        "operation": "delete",
        "x": 860,
        "y": 4360,
        "wires": []
    },
    {
        "id": "9979252923793062",
        "type": "mongodb out",
        "z": "f4036141cc030bcf",
        "mongodb": "7908a755f1520aa7",
        "name": "",
        "collection": "admins",
        "payonly": false,
        "upsert": false,
        "multi": false,
        "operation": "delete",
        "x": 840,
        "y": 4240,
        "wires": []
    },
    {
        "id": "c6316eee1e014afc",
        "type": "mongodb out",
        "z": "f4036141cc030bcf",
        "mongodb": "7908a755f1520aa7",
        "name": "",
        "collection": "admin_modules",
        "payonly": false,
        "upsert": false,
        "multi": false,
        "operation": "delete",
        "x": 870,
        "y": 4300,
        "wires": []
    },
    {
        "id": "48e1b949ea4ae66e",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 482",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 470,
        "y": 4120,
        "wires": []
    },
    {
        "id": "9560b4401de9504f",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 483",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 4120,
        "wires": []
    },
    {
        "id": "5d3d35e852dc7f1d",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 484",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 4120,
        "wires": []
    },
    {
        "id": "248459854d23f5ab",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 485",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1050,
        "y": 4120,
        "wires": []
    },
    {
        "id": "36e76b17892bcd11",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 486",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1270,
        "y": 4120,
        "wires": []
    },
    {
        "id": "26fccf484ffe2b48",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 487",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1670,
        "y": 4120,
        "wires": []
    },
    {
        "id": "d7163630a6c0c37c",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 488",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2110,
        "y": 4120,
        "wires": []
    },
    {
        "id": "8af0df21aadf4c84",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 489",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2530,
        "y": 4120,
        "wires": []
    },
    {
        "id": "f3e4d8f73264ddf6",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 490",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2390,
        "y": 4040,
        "wires": []
    },
    {
        "id": "5043535bb60779a6",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 491",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2690,
        "y": 4040,
        "wires": []
    },
    {
        "id": "94fe01e84d30294a",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 492",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2030,
        "y": 4020,
        "wires": []
    },
    {
        "id": "82d0377b6a70b903",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 493",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1730,
        "y": 4040,
        "wires": []
    },
    {
        "id": "a760317f5d87d5e0",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 494",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1390,
        "y": 4040,
        "wires": []
    },
    {
        "id": "31b68e0532fa7867",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 495",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 4020,
        "wires": []
    },
    {
        "id": "33be9c73fb386787",
        "type": "debug",
        "z": "f4036141cc030bcf",
        "name": "debug 496",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 3980,
        "wires": []
    },
    {
        "id": "b9dfba77cf0659da",
        "type": "http in",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "",
        "url": "/saveCredentials",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 280,
        "wires": [
            [
                "cebe20a19da025cb"
            ]
        ]
    },
    {
        "id": "0225b679b27c7cb6",
        "type": "http response",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "saveCredentials",
        "statusCode": "",
        "headers": {},
        "x": 940,
        "y": 280,
        "wires": []
    },
    {
        "id": "cebe20a19da025cb",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "set filename",
        "func": "msg.filename = '/data/credentials.json'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 280,
        "wires": [
            [
                "31926911dc3e927a"
            ]
        ]
    },
    {
        "id": "18bd79bbe3db2336",
        "type": "file",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 640,
        "y": 280,
        "wires": [
            [
                "14d2abc0b3f41cf9"
            ]
        ]
    },
    {
        "id": "14d2abc0b3f41cf9",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "return res",
        "func": "msg.payload={\n    success: true,\n    payload: \"Success!\"\n}\nmsg.statusCode = 200\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 280,
        "wires": [
            [
                "0225b679b27c7cb6"
            ]
        ]
    },
    {
        "id": "31926911dc3e927a",
        "type": "json",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 510,
        "y": 280,
        "wires": [
            [
                "18bd79bbe3db2336"
            ]
        ]
    },
    {
        "id": "1a1acd007e534462",
        "type": "file in",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 540,
        "y": 400,
        "wires": [
            [
                "cbd59739d47324a6"
            ]
        ]
    },
    {
        "id": "cbd59739d47324a6",
        "type": "json",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 670,
        "y": 400,
        "wires": [
            [
                "0b634a02e2f46fc7"
            ]
        ]
    },
    {
        "id": "bf38233f75e9e634",
        "type": "http in",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "",
        "url": "/getCredentials",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 400,
        "wires": [
            [
                "04ad2bf4e767fd19"
            ]
        ]
    },
    {
        "id": "4bf84b38cabfd2b8",
        "type": "http response",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 950,
        "y": 400,
        "wires": []
    },
    {
        "id": "0b634a02e2f46fc7",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "return res",
        "func": "msg.statusCode = 200\nglobal.set('isCredentialsSent', true)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 400,
        "wires": [
            [
                "4bf84b38cabfd2b8"
            ]
        ]
    },
    {
        "id": "04ad2bf4e767fd19",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "set filename",
        "func": "msg.filename = '/data/credentials.json'\nglobal.set('isCredentialsSent', false)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 400,
        "wires": [
            [
                "1a1acd007e534462",
                "d7144c5acabd38c0"
            ]
        ]
    },
    {
        "id": "fd42a251b9afd49b",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "default data",
        "func": "if (global.get('isCredentialsSent') === false){\n    msg.payload = {\n        \"openai_api\": '',\n        \"pipecone_api\": '',\n        \"pipecone_env\": '',\n        \"pipecone_index\": '',\n        \"prompt\": ''\n    }\n    global.set('isCredentialsSent', true)\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 440,
        "wires": [
            [
                "0b634a02e2f46fc7"
            ]
        ]
    },
    {
        "id": "d7144c5acabd38c0",
        "type": "delay",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 515,
        "y": 440,
        "wires": [
            [
                "fd42a251b9afd49b"
            ]
        ],
        "l": false
    },
    {
        "id": "2cd32bbc5f43b1e9",
        "type": "inject",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 120,
        "wires": [
            [
                "5ed03305ad9ca676"
            ]
        ]
    },
    {
        "id": "e3b8c26d52822ba0",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "ENV",
        "func": "const data = msg.payload\n\nlet process_env = {\n    OPENAI_API: data.openai_api,\n    PIPECONE_API: data.pipecone_api,\n    PIPECONE_ENV: data.pipecone_env,\n    PIPECONE_INDEX: data.pipecone_index,\n    PIPECONE_URL: data.pipecone_url,\n    PROMPT: data.prompt,\n}\n\nglobal.set(\"process_env\", process_env)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "219438abb376baad",
        "type": "complete",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "",
        "scope": [
            "0225b679b27c7cb6"
        ],
        "uncaught": false,
        "x": 150,
        "y": 80,
        "wires": [
            [
                "5ed03305ad9ca676"
            ]
        ]
    },
    {
        "id": "5ed03305ad9ca676",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "getEnvs",
        "func": "msg.filename = '/data/credentials.json'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 100,
        "wires": [
            [
                "8fe2f86059898917"
            ]
        ]
    },
    {
        "id": "8fe2f86059898917",
        "type": "file in",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 500,
        "y": 100,
        "wires": [
            [
                "22c15a24c4d0adfa"
            ]
        ]
    },
    {
        "id": "22c15a24c4d0adfa",
        "type": "json",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 585,
        "y": 100,
        "wires": [
            [
                "e3b8c26d52822ba0",
                "e2ddfce36897aa9d"
            ]
        ],
        "l": false
    },
    {
        "id": "e2ddfce36897aa9d",
        "type": "debug",
        "z": "4cba6f8219137af4",
        "g": "80544ac2e67c2381",
        "name": "debug 425",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 140,
        "wires": []
    },
    {
        "id": "b7d26d9f317a4ce9",
        "type": "http in",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "",
        "url": "/saveCredentialsTelegram",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 190,
        "y": 720,
        "wires": [
            [
                "a33aa3cab944b729"
            ]
        ]
    },
    {
        "id": "a44d45874ebeb754",
        "type": "http response",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "saveCredentialsTelegram",
        "statusCode": "",
        "headers": {},
        "x": 1010,
        "y": 720,
        "wires": []
    },
    {
        "id": "a33aa3cab944b729",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "set filename",
        "func": "msg.filename = '/data/credentialsTelegram.json'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 720,
        "wires": [
            [
                "77e03324263dd58d"
            ]
        ]
    },
    {
        "id": "0f3a84ec943e5b13",
        "type": "file",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 680,
        "y": 720,
        "wires": [
            [
                "24c4d892d84069d7"
            ]
        ]
    },
    {
        "id": "24c4d892d84069d7",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "return res",
        "func": "msg.payload={\n    success: true,\n    payload: \"Success!\"\n}\nmsg.statusCode = 200\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 720,
        "wires": [
            [
                "a44d45874ebeb754"
            ]
        ]
    },
    {
        "id": "77e03324263dd58d",
        "type": "json",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 550,
        "y": 720,
        "wires": [
            [
                "0f3a84ec943e5b13"
            ]
        ]
    },
    {
        "id": "ef69804671bc03dd",
        "type": "file in",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 540,
        "y": 840,
        "wires": [
            [
                "6608ddc70a4b2b60"
            ]
        ]
    },
    {
        "id": "6608ddc70a4b2b60",
        "type": "json",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 670,
        "y": 840,
        "wires": [
            [
                "6eeabcaa5729b632"
            ]
        ]
    },
    {
        "id": "8bea79732db57d81",
        "type": "http in",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "",
        "url": "/getCredentialsTelegram",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 840,
        "wires": [
            [
                "165d1d33afaf1c2e"
            ]
        ]
    },
    {
        "id": "2fbc0da069ce400e",
        "type": "http response",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 950,
        "y": 840,
        "wires": []
    },
    {
        "id": "6eeabcaa5729b632",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "return res",
        "func": "msg.statusCode = 200\nglobal.set('iscredentialsTelegramSent', true)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 840,
        "wires": [
            [
                "2fbc0da069ce400e"
            ]
        ]
    },
    {
        "id": "165d1d33afaf1c2e",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "set filename",
        "func": "msg.filename = '/data/credentialsTelegram.json'\nglobal.set('iscredentialsTelegramSent', false)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 840,
        "wires": [
            [
                "ef69804671bc03dd",
                "fd3c761bbe5711a4"
            ]
        ]
    },
    {
        "id": "c277b27f50de7b47",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "default data",
        "func": "if (global.get('iscredentialsTelegramSent') === false){\n    msg.payload = {\n        \"bot_token\": '',\n        \"bot_name\": '',\n        \"private_chat\": '',\n        \"welcome\": ''\n    }\n    global.set('iscredentialsTelegramSent', true)\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 880,
        "wires": [
            [
                "6eeabcaa5729b632"
            ]
        ]
    },
    {
        "id": "fd3c761bbe5711a4",
        "type": "delay",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 515,
        "y": 880,
        "wires": [
            [
                "c277b27f50de7b47"
            ]
        ],
        "l": false
    },
    {
        "id": "70087cd5c5a5c551",
        "type": "inject",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 600,
        "wires": [
            [
                "fda135fec557af97"
            ]
        ]
    },
    {
        "id": "5ad1a8b7bc330500",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "ENV",
        "func": "const data = msg.payload\n\nlet process_env = {\n    BOT_NAME: data.bot_name,\n    BOT_TOKEN: data.bot_token,\n    PRIVATE_TG_CHAT: data.private_chat,\n    WELCOME: data.welcome,\n}\n\nglobal.set(\"telegram\", process_env)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "3d0bcba9e1b0867e",
        "type": "complete",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "",
        "scope": [
            "a44d45874ebeb754"
        ],
        "uncaught": false,
        "x": 150,
        "y": 560,
        "wires": [
            [
                "fda135fec557af97"
            ]
        ]
    },
    {
        "id": "fda135fec557af97",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "getEnvs",
        "func": "msg.filename = '/data/credentialsTelegram.json'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 580,
        "wires": [
            [
                "175fb1669ebe74b6"
            ]
        ]
    },
    {
        "id": "175fb1669ebe74b6",
        "type": "file in",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 500,
        "y": 580,
        "wires": [
            [
                "0dc15aa186445a0f"
            ]
        ]
    },
    {
        "id": "0dc15aa186445a0f",
        "type": "json",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 585,
        "y": 580,
        "wires": [
            [
                "5ad1a8b7bc330500",
                "2baefbb8c45261ea"
            ]
        ],
        "l": false
    },
    {
        "id": "2baefbb8c45261ea",
        "type": "debug",
        "z": "4cba6f8219137af4",
        "g": "7ab0a46dbaab3e33",
        "name": "debug 467",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 620,
        "wires": []
    },
    {
        "id": "bb96d23ed888929e",
        "type": "http in",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "",
        "url": "/saveCredentialsWhatsApp",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 190,
        "y": 1180,
        "wires": [
            [
                "54e078af5c0d3adc"
            ]
        ]
    },
    {
        "id": "fcbb92757366bf33",
        "type": "http response",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "saveCredentialsWhatsApp",
        "statusCode": "",
        "headers": {},
        "x": 1040,
        "y": 1180,
        "wires": []
    },
    {
        "id": "54e078af5c0d3adc",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "set filename",
        "func": "msg.filename = '/data/credentialsWhatsApp.json'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1180,
        "wires": [
            [
                "604fb55d3034b5b3"
            ]
        ]
    },
    {
        "id": "81f9b8c4177c260c",
        "type": "file",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 700,
        "y": 1180,
        "wires": [
            [
                "4e7b3768b3931cfb"
            ]
        ]
    },
    {
        "id": "4e7b3768b3931cfb",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "return res",
        "func": "msg.payload={\n    success: true,\n    payload: \"Success!\"\n}\nmsg.statusCode = 200\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 1180,
        "wires": [
            [
                "fcbb92757366bf33"
            ]
        ]
    },
    {
        "id": "604fb55d3034b5b3",
        "type": "json",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 570,
        "y": 1180,
        "wires": [
            [
                "81f9b8c4177c260c"
            ]
        ]
    },
    {
        "id": "55b4fb10f4eea162",
        "type": "file in",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 540,
        "y": 1300,
        "wires": [
            [
                "446fd365d7fa0305"
            ]
        ]
    },
    {
        "id": "446fd365d7fa0305",
        "type": "json",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 670,
        "y": 1300,
        "wires": [
            [
                "07800ad0b4f9213f"
            ]
        ]
    },
    {
        "id": "6c030d2588a9b206",
        "type": "http in",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "",
        "url": "/getCredentialsWhatsApp",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 1300,
        "wires": [
            [
                "4216ad203406f19d"
            ]
        ]
    },
    {
        "id": "01556533647dfef3",
        "type": "http response",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 950,
        "y": 1300,
        "wires": []
    },
    {
        "id": "07800ad0b4f9213f",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "return res",
        "func": "msg.statusCode = 200\nglobal.set('isCredentialsWhatsAppSent', true)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 1300,
        "wires": [
            [
                "01556533647dfef3"
            ]
        ]
    },
    {
        "id": "4216ad203406f19d",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "set filename",
        "func": "msg.filename = '/data/credentialsWhatsApp.json'\nglobal.set('isCredentialsWhatsAppSent', false)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 1300,
        "wires": [
            [
                "55b4fb10f4eea162",
                "fe2d7ebe90fcf111"
            ]
        ]
    },
    {
        "id": "a5527e8d9cc266fe",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "default data",
        "func": "if (global.get('isCredentialsWhatsAppSent') === false){\n    msg.payload = {\n        \"whatsApp_url\": '',\n        \"whatsApp_token\": ''\n    }\n    global.set('isCredentialsWhatsAppSent', true)\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 1340,
        "wires": [
            [
                "07800ad0b4f9213f"
            ]
        ]
    },
    {
        "id": "fe2d7ebe90fcf111",
        "type": "delay",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 515,
        "y": 1340,
        "wires": [
            [
                "a5527e8d9cc266fe"
            ]
        ],
        "l": false
    },
    {
        "id": "1f8a739ea5ee02cd",
        "type": "inject",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 1020,
        "wires": [
            [
                "02f3af026c6e9af0"
            ]
        ]
    },
    {
        "id": "f22993bbddeb18b5",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "ENV",
        "func": "const data = msg.payload\n\nlet process_env = {\n    WHATSAPP_URL: data.whatsApp_url,\n    WHATSAPP_TOKEN: data.whatsApp_token\n}\n\nglobal.set(\"WHATSAPP\", process_env)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "746c06b58c3b2d30",
        "type": "complete",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "",
        "scope": [
            "fcbb92757366bf33"
        ],
        "uncaught": false,
        "x": 150,
        "y": 980,
        "wires": [
            [
                "02f3af026c6e9af0"
            ]
        ]
    },
    {
        "id": "02f3af026c6e9af0",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "getEnvs",
        "func": "msg.filename = '/data/credentialsWhatsApp.json'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 1000,
        "wires": [
            [
                "97ecf733940516b3"
            ]
        ]
    },
    {
        "id": "97ecf733940516b3",
        "type": "file in",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 500,
        "y": 1000,
        "wires": [
            [
                "e9e2f318883d6af3"
            ]
        ]
    },
    {
        "id": "e9e2f318883d6af3",
        "type": "json",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 585,
        "y": 1000,
        "wires": [
            [
                "f22993bbddeb18b5",
                "0f0d30344ca45f4a"
            ]
        ],
        "l": false
    },
    {
        "id": "0f0d30344ca45f4a",
        "type": "debug",
        "z": "4cba6f8219137af4",
        "g": "7a0dc49638e7953f",
        "name": "debug 468",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 1040,
        "wires": []
    },
    {
        "id": "80b27f596185b0b5",
        "type": "http in",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "",
        "url": "/saveCredentialsMeta",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 1660,
        "wires": [
            [
                "a1e983d79486f057"
            ]
        ]
    },
    {
        "id": "5c07c1802edd7436",
        "type": "http response",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "saveCredentialsMeta",
        "statusCode": "",
        "headers": {},
        "x": 980,
        "y": 1660,
        "wires": []
    },
    {
        "id": "a1e983d79486f057",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "set filename",
        "func": "msg.filename = '/data/credentialsMeta.json'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 1660,
        "wires": [
            [
                "eb6e8f5ff083dd6b"
            ]
        ]
    },
    {
        "id": "5a28a0e9ba4c93ae",
        "type": "file",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 660,
        "y": 1660,
        "wires": [
            [
                "d09342e7a96a3a1b"
            ]
        ]
    },
    {
        "id": "d09342e7a96a3a1b",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "return res",
        "func": "msg.payload={\n    success: true,\n    payload: \"Success!\"\n}\nmsg.statusCode = 200\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 1660,
        "wires": [
            [
                "5c07c1802edd7436"
            ]
        ]
    },
    {
        "id": "eb6e8f5ff083dd6b",
        "type": "json",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 1660,
        "wires": [
            [
                "5a28a0e9ba4c93ae"
            ]
        ]
    },
    {
        "id": "80328f5fc0f8cc4f",
        "type": "file in",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 540,
        "y": 1780,
        "wires": [
            [
                "4e85fd2ea67195c3"
            ]
        ]
    },
    {
        "id": "4e85fd2ea67195c3",
        "type": "json",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 670,
        "y": 1780,
        "wires": [
            [
                "411e5fefe630bd97"
            ]
        ]
    },
    {
        "id": "4eff46ab12c5c07e",
        "type": "http in",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "",
        "url": "/getCredentialsMeta",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 1780,
        "wires": [
            [
                "47f53d27d5551493"
            ]
        ]
    },
    {
        "id": "b303bbd2a2f63ba0",
        "type": "http response",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 950,
        "y": 1780,
        "wires": []
    },
    {
        "id": "411e5fefe630bd97",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "return res",
        "func": "msg.statusCode = 200\nglobal.set('isCredentialsMetaSent', true)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 1780,
        "wires": [
            [
                "b303bbd2a2f63ba0"
            ]
        ]
    },
    {
        "id": "47f53d27d5551493",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "set filename",
        "func": "msg.filename = '/data/credentialsMeta.json'\nglobal.set('isCredentialsMetaSent', false)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 1780,
        "wires": [
            [
                "80328f5fc0f8cc4f",
                "82e272bb8a733aad"
            ]
        ]
    },
    {
        "id": "7e12ce9603e46ae8",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "default data",
        "func": "if (global.get('isCredentialsMetaSent') === false){\n    msg.payload = {\n        \"meta_token\": '',\n        \"response_URL\": ''\n\n    }\n    global.set('isCredentialsMetaSent', true)\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 1820,
        "wires": [
            [
                "411e5fefe630bd97"
            ]
        ]
    },
    {
        "id": "82e272bb8a733aad",
        "type": "delay",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 515,
        "y": 1820,
        "wires": [
            [
                "7e12ce9603e46ae8"
            ]
        ],
        "l": false
    },
    {
        "id": "788b05fb52c4fe79",
        "type": "inject",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 1500,
        "wires": [
            [
                "db66ea7be2d27d87"
            ]
        ]
    },
    {
        "id": "097d5a354e0f8ea6",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "ENV",
        "func": "const data = msg.payload\n\nlet process_env = {\n    META_TOKEN: data.meta_token,\n    META_URL: data.response_URL\n}\n\nglobal.set(\"META\", process_env)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 1480,
        "wires": [
            []
        ]
    },
    {
        "id": "5008af5f7461f232",
        "type": "complete",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "",
        "scope": [
            "5c07c1802edd7436"
        ],
        "uncaught": false,
        "x": 150,
        "y": 1460,
        "wires": [
            [
                "db66ea7be2d27d87"
            ]
        ]
    },
    {
        "id": "db66ea7be2d27d87",
        "type": "function",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "getEnvs",
        "func": "msg.filename = '/data/credentialsMeta.json'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 1480,
        "wires": [
            [
                "eb9f04e925a2c58e"
            ]
        ]
    },
    {
        "id": "eb9f04e925a2c58e",
        "type": "file in",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 500,
        "y": 1480,
        "wires": [
            [
                "8a7b40691c947077"
            ]
        ]
    },
    {
        "id": "8a7b40691c947077",
        "type": "json",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 585,
        "y": 1480,
        "wires": [
            [
                "097d5a354e0f8ea6",
                "b1cb89a3b4ba7937"
            ]
        ],
        "l": false
    },
    {
        "id": "b1cb89a3b4ba7937",
        "type": "debug",
        "z": "4cba6f8219137af4",
        "g": "5cf2bc7a9091263d",
        "name": "debug 469",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 1520,
        "wires": []
    },
    {
        "id": "21cbda1bf24a2a69",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "url": "/getVectors2",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 1820,
        "y": 80,
        "wires": [
            [
                "19823422f5fa86c1"
            ]
        ]
    },
    {
        "id": "19823422f5fa86c1",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "to mongoDB",
        "func": "msg.collection = \"knowledgeObjects\"\nmsg.payload ={\n_id:objectid(msg.payload.id) \n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 2010,
        "y": 80,
        "wires": [
            [
                "48094b3f0e2ee8d9"
            ]
        ]
    },
    {
        "id": "48094b3f0e2ee8d9",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2190,
        "y": 80,
        "wires": [
            [
                "f152600620f043bd"
            ]
        ]
    },
    {
        "id": "f152600620f043bd",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2350,
        "y": 80,
        "wires": []
    },
    {
        "id": "962290bc68cb0b29",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "update",
        "func": "const question = msg.fromApp.question;\nconst result = msg.fromApp.result;\nconst id = msg.fromApp.id;\nconst url = msg.fromApp.url;\n\nlet updatedData = { url: url, question: question, result }; //      \nmsg.collection = \"knowledgeObjects\"\n\nmsg.query = { \"vectors.id\": id };\nmsg.payload = {\n    \"$set\": {\n        \"vectors.$\": {\n            id: id,\n            metadata: updatedData\n        }\n    }\n};\n\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 2610,
        "y": 160,
        "wires": [
            [
                "4bfdfc1b314f7faa",
                "cf4156d5c447a16c"
            ]
        ]
    },
    {
        "id": "3ce9a2870ef10866",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "url": "/updateVector",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 1830,
        "y": 160,
        "wires": [
            [
                "c99c1f560bd3c907",
                "7a196d148fa3944d"
            ]
        ]
    },
    {
        "id": "14f30a7985cc31c8",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2890,
        "y": 180,
        "wires": []
    },
    {
        "id": "4bfdfc1b314f7faa",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "status",
        "func": "msg.payload = {\n    \"success\": true,\n    \"payload\": \"Successfully updated\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2750,
        "y": 180,
        "wires": [
            [
                "14f30a7985cc31c8"
            ]
        ]
    },
    {
        "id": "c19961b743cde705",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "url": "/deleteVector1",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 1840,
        "y": 320,
        "wires": [
            [
                "20ef169512cdd410",
                "06b21e1c324bcb90"
            ]
        ]
    },
    {
        "id": "20ef169512cdd410",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "delete",
        "func": "let vectorIds = msg.req.query.id;\n\nconst process_env = global.get(\"process_env\")\nmsg.PIPECONE_URL = process_env.PIPECONE_URL\nmsg.PIPECONE_API = process_env.PIPECONE_API\n\nmsg.headers = {\n    'Api-Key': msg.PIPECONE_API,\n    'Content-Type': 'application/json'\n};\n\nmsg.url = `${msg.PIPECONE_URL}/vectors/delete`;\nmsg.payload = { ids: vectorIds };\nmsg.ids = vectorIds\n\n\nreturn msg;\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 2030,
        "y": 320,
        "wires": [
            [
                "d36889816ac0fe8e"
            ]
        ]
    },
    {
        "id": "f033b92e5ba13fcc",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2490,
        "y": 300,
        "wires": []
    },
    {
        "id": "8444301221890904",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "the end",
        "func": "const id = msg.req.query.id;\nmsg.collection = \"knowledgeObjects\"\n\nmsg.query = { \"vectors.id\": id };\nmsg.payload = {\n    \"$pull\": {\n        \"vectors\": {\n            \"id\": msg.ids\n        }\n    }\n};\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 2360,
        "y": 320,
        "wires": [
            [
                "f033b92e5ba13fcc",
                "9b5d8966c49993cd"
            ]
        ]
    },
    {
        "id": "d36889816ac0fe8e",
        "type": "http request",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "method": "DELETE",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 2190,
        "y": 320,
        "wires": [
            [
                "8444301221890904"
            ]
        ]
    },
    {
        "id": "6a8ed9cc40220ef6",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "1f1b365afc8becc5",
        "name": "check command",
        "func": "if (msg.payload.content.includes('/start')) {\n    return [msg, null]\n} else {\n    msg.fromApp = msg.payload\n    msg.OPENAI_API_KEY = global.get(\"process_env\").OPENAI_API;\n    msg.input = msg.payload.content;\n    return [null, msg]\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 2580,
        "wires": [
            [
                "6140c878962dd22f"
            ],
            [
                "1c959c0c2ef18143"
            ]
        ]
    },
    {
        "id": "a686b4808141bbf4",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "1f1b365afc8becc5",
        "name": "",
        "url": "/demo1",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 2580,
        "wires": [
            [
                "6a8ed9cc40220ef6"
            ]
        ]
    },
    {
        "id": "6140c878962dd22f",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "1f1b365afc8becc5",
        "name": "/start",
        "func": "msg.payload = [{ content: '/start' }, {\n    \"content\": \"Hello\"\n}]\n\n\n// msg.payload = [{ content: '/start' }, { content: global.get('content').WELCOME_MSG }]\n\nglobal.set(`historyDemo`, [{ role: 'system' }, { role: 'assistant', content: `Hello` }])\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 2540,
        "wires": [
            [
                "512bf5fd33a8679d"
            ]
        ]
    },
    {
        "id": "512bf5fd33a8679d",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "1f1b365afc8becc5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1310,
        "y": 2560,
        "wires": []
    },
    {
        "id": "cf4156d5c447a16c",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2760,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "796fcd0b58916758",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "",
        "url": "/getKnowlegeObjectLink",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 3180,
        "y": 120,
        "wires": [
            [
                "f7f33a86ce8d8fef"
            ]
        ]
    },
    {
        "id": "f7f33a86ce8d8fef",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "to mongoDB",
        "func": "msg.collection = \"knowledgeObjects\"\nmsg.payload ={\n'knowledgeBaseId': msg.payload.id,\n\"type\": \"Link\",\ndeleted: { $ne: true }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 3410,
        "y": 120,
        "wires": [
            [
                "11bec5f579b0b092"
            ]
        ]
    },
    {
        "id": "11bec5f579b0b092",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 3590,
        "y": 120,
        "wires": [
            [
                "4158be83830615bc"
            ]
        ]
    },
    {
        "id": "4158be83830615bc",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 3750,
        "y": 120,
        "wires": []
    },
    {
        "id": "c4f1d18b2c5d0eb7",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "",
        "url": "/getKnowlegeObjectFiles",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 3180,
        "y": 160,
        "wires": [
            [
                "292d3caa5beb7778"
            ]
        ]
    },
    {
        "id": "292d3caa5beb7778",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "to mongoDB",
        "func": "msg.collection = \"knowledgeObjects\"\nmsg.payload = {\n    'knowledgeBaseId': msg.payload.id,\n    \"type\": \"File\",\n    deleted: { $ne: true }\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 3410,
        "y": 160,
        "wires": [
            [
                "76f1fd55909c53ab"
            ]
        ]
    },
    {
        "id": "76f1fd55909c53ab",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 3590,
        "y": 160,
        "wires": [
            [
                "5ec283479477abe6"
            ]
        ]
    },
    {
        "id": "5ec283479477abe6",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 3750,
        "y": 160,
        "wires": []
    },
    {
        "id": "42505fe8cbd4e294",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "",
        "url": "/getKnowlegeObjectFAQ",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 3180,
        "y": 200,
        "wires": [
            [
                "b9c3655fb6f94525"
            ]
        ]
    },
    {
        "id": "b9c3655fb6f94525",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "to mongoDB",
        "func": "msg.collection = \"knowledgeObjects\"\nmsg.payload = {\n    'knowledgeBaseId': msg.payload.id,\n    \"type\": \"FAQ\",\n    deleted: { $ne: true }\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 3410,
        "y": 200,
        "wires": [
            [
                "f6f04b7f237878d0"
            ]
        ]
    },
    {
        "id": "f6f04b7f237878d0",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 3590,
        "y": 200,
        "wires": [
            [
                "862dc7094cc3702c"
            ]
        ]
    },
    {
        "id": "862dc7094cc3702c",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 3750,
        "y": 200,
        "wires": []
    },
    {
        "id": "cbd939371725f5c9",
        "type": "inject",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3200,
        "y": 80,
        "wires": [
            [
                "f7f33a86ce8d8fef"
            ]
        ]
    },
    {
        "id": "db5662eacd7d9eb5",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "",
        "url": "/getKnowlegeObjectPdf",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 3180,
        "y": 280,
        "wires": [
            [
                "1c2539fd446d3718"
            ]
        ]
    },
    {
        "id": "1c2539fd446d3718",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "to mongoDB",
        "func": "msg.collection = \"knowledgeObjects\"\nmsg.payload = {\n    'knowledgeBaseId': msg.payload.id,\n    \"type\": \"FilePDF\",\n    deleted: { $ne: true }\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 3410,
        "y": 280,
        "wires": [
            [
                "2db2b245aa5eabb5"
            ]
        ]
    },
    {
        "id": "2db2b245aa5eabb5",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 3590,
        "y": 280,
        "wires": [
            [
                "29445d42adea56dc"
            ]
        ]
    },
    {
        "id": "29445d42adea56dc",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "9ab1eb9b42ce281a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 3750,
        "y": 280,
        "wires": []
    },
    {
        "id": "9b5d8966c49993cd",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2520,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "447d219e04f5c4e9",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "",
        "url": "/saveToPinecone",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 2320,
        "wires": [
            [
                "7be5a588bfe35ac5",
                "b453ce1aa8eb3e23",
                "690ac56690a13aa4",
                "b2634835a69a4769"
            ]
        ]
    },
    {
        "id": "7be5a588bfe35ac5",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "create array",
        "func": "msg.old=msg.payload\n\nmsg.array = msg.payload.data\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 2320,
        "wires": [
            [
                "6cb8466c8d27b038"
            ]
        ]
    },
    {
        "id": "0dd7f5e7c3f02753",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 730,
        "y": 2220,
        "wires": []
    },
    {
        "id": "b453ce1aa8eb3e23",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "status",
        "func": "msg.payload = {\n    \"success\": true,\n    \"payload\":\"Pinecone in process\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 2220,
        "wires": [
            [
                "6f43f46c6d6627e4"
            ]
        ]
    },
    {
        "id": "6f43f46c6d6627e4",
        "type": "delay",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 605,
        "y": 2220,
        "wires": [
            [
                "0dd7f5e7c3f02753"
            ]
        ],
        "l": false
    },
    {
        "id": "fca11faee5518dfa",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "post",
        "func": "msg.collection = \"knowledgeObjects\"\n\nmsg.query = { \"_id\": objectid(msg.old.idBase)}\nmsg.payload = {\n    $set: {\n     status:\"Saved in Pinecone\"\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 830,
        "y": 2280,
        "wires": [
            [
                "96bc55efbe1eda75",
                "85caaba3697848f2"
            ]
        ]
    },
    {
        "id": "96bc55efbe1eda75",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1000,
        "y": 2280,
        "wires": [
            []
        ]
    },
    {
        "id": "690ac56690a13aa4",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "debug 432",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 170,
        "y": 2280,
        "wires": []
    },
    {
        "id": "63d687c22b99e9d5",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 640,
        "y": 2280,
        "wires": [
            []
        ]
    },
    {
        "id": "b2634835a69a4769",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "post",
        "func": "msg.collection = \"knowledgeObjects\"\n\n\n    msg.query = {\n        _id: objectid(msg.payload.idBase)\n    }\n    msg.payload = {\n        $set: {\n            status: \"Pinecone in process\"\n         \n        }\n    }\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 450,
        "y": 2280,
        "wires": [
            [
                "63d687c22b99e9d5"
            ]
        ]
    },
    {
        "id": "ed63a752615547a1",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "debug 433",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 2380,
        "wires": []
    },
    {
        "id": "5a9cf18af75e3c0b",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "update",
        "func": "msg.collection = \"knowledgeObjects\"\n\nconst question = msg.payload.question;\nconst result = msg.payload.result;\nconst id = msg.payload.id;\nconst url = msg.payload.url;\n\n\nlet updatedData = { url: url, question: question, result };\n\n\nmsg.query = { \"vectors.id\": id };\nmsg.payload = {\n    \"$set\": {\n        \"vectors.$\": {\n            id: id,\n            metadata: updatedData\n        }\n    }\n};\n\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 2060,
        "y": 440,
        "wires": [
            [
                "bfd25775c6570faa",
                "d92184e6adc057c5"
            ]
        ]
    },
    {
        "id": "5582346294319529",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "url": "/updateVectorOnDB",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 1850,
        "y": 440,
        "wires": [
            [
                "5a9cf18af75e3c0b",
                "718ebd07aa298058"
            ]
        ]
    },
    {
        "id": "cd48cc7a92b2a3d1",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2390,
        "y": 480,
        "wires": []
    },
    {
        "id": "bfd25775c6570faa",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "status",
        "func": "msg.payload = {\n    \"success\": true,\n    \"payload\": \"Successfully updated\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2250,
        "y": 480,
        "wires": [
            [
                "cd48cc7a92b2a3d1"
            ]
        ]
    },
    {
        "id": "d92184e6adc057c5",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2280,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "d648ea43ba5a7657",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "the end",
        "func": "\nmsg.collection = \"knowledgeObjects\"\nconst id = msg.req.query.id;\n\nmsg.query = { \"vectors.id\": id };\nmsg.payload = {\n    \"$pull\": {\n        \"vectors\": {\n            \"id\": id\n        }\n    }\n};\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 2080,
        "y": 580,
        "wires": [
            [
                "5bb720dc3ef56b7a",
                "99ad91f7fb16dfbc"
            ]
        ]
    },
    {
        "id": "8c5c228aa9202f2b",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "url": "/deleteVectorDB",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 1850,
        "y": 580,
        "wires": [
            [
                "d648ea43ba5a7657",
                "5a3203eb955fd7d9"
            ]
        ]
    },
    {
        "id": "5bb720dc3ef56b7a",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2210,
        "y": 560,
        "wires": []
    },
    {
        "id": "99ad91f7fb16dfbc",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2240,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "718ebd07aa298058",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "debug 434",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1850,
        "y": 400,
        "wires": []
    },
    {
        "id": "5a3203eb955fd7d9",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "debug 435",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2050,
        "y": 540,
        "wires": []
    },
    {
        "id": "c99c1f560bd3c907",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "debug 436",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2030,
        "y": 200,
        "wires": []
    },
    {
        "id": "06b21e1c324bcb90",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "debug 437",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2050,
        "y": 280,
        "wires": []
    },
    {
        "id": "2c9aaf57c2401f44",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "url": "/createBaseKnowlege",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 80,
        "wires": [
            [
                "07624da9521cf777"
            ]
        ]
    },
    {
        "id": "07624da9521cf777",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "to mongoDB",
        "func": "msg.collection = \"knowlegebase\"\nmsg.payload ={\n    _id: objectid(),\n   name: msg.payload.name\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 430,
        "y": 80,
        "wires": [
            [
                "d4de0d3bb056d3a4"
            ]
        ]
    },
    {
        "id": "d4de0d3bb056d3a4",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 630,
        "y": 80,
        "wires": [
            [
                "ee68ef8d980292c4"
            ]
        ]
    },
    {
        "id": "ee68ef8d980292c4",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "to front",
        "func": "msg.payload = {\n    \"success\": true,\n    \"payload\": \"Successfully created\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 80,
        "wires": [
            [
                "68ac101a9775ddce"
            ]
        ]
    },
    {
        "id": "68ac101a9775ddce",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 970,
        "y": 80,
        "wires": []
    },
    {
        "id": "f54db9132beab646",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "url": "/updateBaseKnowlege",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 160,
        "wires": [
            [
                "b4608e27acb2b4f5"
            ]
        ]
    },
    {
        "id": "b4608e27acb2b4f5",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "to mongoDB",
        "func": "msg.collection = \"knowlegebase\"\nmsg.query = {\n    _id: objectid(msg.req.query._id)\n}\nmsg.payload={\n    $set:{\n       name: msg.payload.name\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 430,
        "y": 160,
        "wires": [
            [
                "46b05adc2604765c"
            ]
        ]
    },
    {
        "id": "46b05adc2604765c",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 640,
        "y": 160,
        "wires": [
            [
                "62f4c7a8af42963f"
            ]
        ]
    },
    {
        "id": "62f4c7a8af42963f",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "to front",
        "func": "msg.payload = {\n    \"success\": true,\n    \"payload\": \"Successfully updated\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 160,
        "wires": [
            [
                "98bec222133fdb0a"
            ]
        ]
    },
    {
        "id": "98bec222133fdb0a",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 970,
        "y": 160,
        "wires": []
    },
    {
        "id": "281096775943d58b",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "to mongoDB",
        "func": "msg.collection = \"knowlegebase\"\nmsg.payload ={\n_id: objectid(msg.payload.id)\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 390,
        "y": 520,
        "wires": [
            [
                "6e3cbfc2abcc457d"
            ]
        ]
    },
    {
        "id": "44f53453723f5c75",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "url": "/getBaseKnowlegeById",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 520,
        "wires": [
            [
                "281096775943d58b"
            ]
        ]
    },
    {
        "id": "6e3cbfc2abcc457d",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 550,
        "y": 520,
        "wires": [
            [
                "00bd3d46bb08b1e6"
            ]
        ]
    },
    {
        "id": "00bd3d46bb08b1e6",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 710,
        "y": 520,
        "wires": []
    },
    {
        "id": "30591fa61f0ab740",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "url": "/getBaseKnowlege",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 440,
        "wires": [
            [
                "3f9c7ffdfcc3f7dc"
            ]
        ]
    },
    {
        "id": "3f9c7ffdfcc3f7dc",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "to mongoDB",
        "func": "msg.collection = \"knowlegebase\"\nmsg.payload ={\n    deleted: { $ne: true }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 370,
        "y": 440,
        "wires": [
            [
                "152eea09afdeea2d"
            ]
        ]
    },
    {
        "id": "152eea09afdeea2d",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 550,
        "y": 440,
        "wires": [
            [
                "dc553cd69f080f56"
            ]
        ]
    },
    {
        "id": "ef06a46f33219658",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1230,
        "y": 440,
        "wires": []
    },
    {
        "id": "dc553cd69f080f56",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "to mongoDB",
        "func": "msg.old = msg.payload\nmsg.collection = \"knowledgeObjects\"\nmsg.payload = {\n    deleted: { $ne: true }\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 730,
        "y": 440,
        "wires": [
            [
                "790871619c7fdbc7"
            ]
        ]
    },
    {
        "id": "790871619c7fdbc7",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 890,
        "y": 440,
        "wires": [
            [
                "c1109b6064ebbca9"
            ]
        ]
    },
    {
        "id": "c1109b6064ebbca9",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "to front",
        "func": "msg.payload =msg.old.map((e) => ({\n    ...e,\n    total: msg.payload.filter((el) => el.knowledgeBaseId === e._id.toString() ).length,\n    links: msg.payload.filter((el) => el.knowledgeBaseId === e._id.toString() && el.type === 'Link').length,\n    files: msg.payload.filter((el) => el.knowledgeBaseId === e._id.toString() && el.type === 'File' ).length,\n    filesFAQ: msg.payload.filter((el) => el.knowledgeBaseId === e._id.toString() && el.type === 'FAQ' ).length,\n    filesPDF: msg.payload.filter((el) => el.knowledgeBaseId === e._id.toString() && el.type === 'FilePDF').length\n})); \n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 440,
        "wires": [
            [
                "ef06a46f33219658",
                "53c071bd3c47255c"
            ]
        ]
    },
    {
        "id": "8ac6c24559de4776",
        "type": "inject",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 400,
        "wires": [
            [
                "3f9c7ffdfcc3f7dc"
            ]
        ]
    },
    {
        "id": "53c071bd3c47255c",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "debug 423",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1190,
        "y": 400,
        "wires": []
    },
    {
        "id": "a265afe5f6517876",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "url": "/updateObjectsBase",
        "method": "post",
        "upload": true,
        "swaggerDoc": "",
        "x": 170,
        "y": 660,
        "wires": [
            [
                "70bf347cf45632b6",
                "2bdc0d294e3e0bf4"
            ]
        ]
    },
    {
        "id": "70bf347cf45632b6",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "check type",
        "func": "\nmsg.collection = \"knowledgeObjects\";\n\nmsg.oldPayloadforlink = msg.payload \n\nmsg.oldPayload =  msg.req.query \n\nmsg.type = msg.req.query.type ? msg.req.query.type : msg.payload.type\n\nmsg._id = objectid();\n\nif (msg.req.files && msg.req.files[0].mimetype === \"application/pdf\"){\n    msg.type = \"FilePDF\"\n\n    return [null, null, msg]\n}\n\n\nif(msg.type ===\"Link\"){\n    return [msg,null,null,null]\n}\nif(msg.type ===\"FAQ\"){\n    return[null,msg,null,null]\n} if (msg.type === \"File\" || msg.type === \"FilePDF\"){\nreturn[null,null,msg,null]\n}\nif (msg.type === \"Manual\") {\n    return [null, null, null,msg]\n}\n",
        "outputs": 4,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 390,
        "y": 660,
        "wires": [
            [
                "cdc8d111bf092667"
            ],
            [
                "9bd946aefeb9022c"
            ],
            [
                "e98ea35b295b7995"
            ],
            [
                "b294829d3045d4d9"
            ]
        ]
    },
    {
        "id": "cdc8d111bf092667",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "link",
        "func": "\nmsg.url = msg.oldPayloadforlink.link;\n \n\n\n\nmsg.payload = {\n    _id: msg._id,\n    knowledgeBaseId: msg.oldPayloadforlink.id,\n    url: msg.url,\n    type: msg.type,\n    name: msg.oldPayloadforlink.name,\n    vectors: [],\n    status: \"Source saved\",\n    deleted: false,\n    createdAt: new Date()\n};\nreturn msg\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "09801ef5a703ec17"
            ]
        ]
    },
    {
        "id": "9bd946aefeb9022c",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "faq",
        "func": "msg.buffer = msg.req.files[0].buffer\n\nmsg.decodedFilename = '/data/storage/' + msg.req.files[0].originalname\n\nmsg.payload = {\n    _id: msg._id,\n    knowledgeBaseId: msg.oldPayload.id,\n    name: msg.req.files[0].originalname,\n    type: \"FAQ\",\n    file: msg.req.files[0].originalname,\n    vectors: [],\n    status: \"Source saved\",\n    deleted: false,\n    createdAt: new Date()\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 550,
        "y": 640,
        "wires": [
            [
                "09801ef5a703ec17",
                "aa524198ec55d939"
            ]
        ]
    },
    {
        "id": "e98ea35b295b7995",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "file",
        "func": "msg.buffer = msg.req.files[0].buffer\n\nmsg.decodedFilename = '/data/storage/' + msg.req.files[0].originalname\n\nmsg.payload = {\n    _id: msg._id,\n    knowledgeBaseId: msg.oldPayload.id,\n    name: msg.req.files[0].originalname,\n    type: msg.type,\n    file: msg.req.files[0].originalname,\n    vectors: [],\n    status: \"Source saved\",\n    deleted: false,\n    createdAt: new Date()\n};\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 550,
        "y": 680,
        "wires": [
            [
                "09801ef5a703ec17",
                "aa524198ec55d939"
            ]
        ]
    },
    {
        "id": "09801ef5a703ec17",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 770,
        "y": 620,
        "wires": [
            [
                "1d799e3d024c7f74"
            ]
        ]
    },
    {
        "id": "1d799e3d024c7f74",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "status",
        "func": "msg.payload = {\n    \"success\": true,\n    \"payload\": \"Successfully updated\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 620,
        "wires": [
            [
                "f4162afcbdfcbd78"
            ]
        ]
    },
    {
        "id": "f4162afcbdfcbd78",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1050,
        "y": 620,
        "wires": []
    },
    {
        "id": "aa524198ec55d939",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "write to file",
        "func": "msg.payload = msg.buffer\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 660,
        "wires": [
            [
                "fd71d53d53cdf6d0"
            ]
        ]
    },
    {
        "id": "fd71d53d53cdf6d0",
        "type": "file",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "filename": "decodedFilename",
        "filenameType": "msg",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 920,
        "y": 660,
        "wires": [
            [
                "7987659ba87c382e"
            ]
        ]
    },
    {
        "id": "4d00f14a894c3d1a",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "update knowlegebase",
        "func": "msg.collection = \"knowlegebase\"\n\nmsg.query={\n    _id: objectid(msg.req.query.id)\n}\n\nmsg.payload={\n    $set:{\n    'deleted': true\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 380,
        "y": 240,
        "wires": [
            [
                "606aa4d8d05a9287"
            ]
        ]
    },
    {
        "id": "481c73b6eb12dac5",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "url": "/deleteBase",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 280,
        "wires": [
            [
                "4d00f14a894c3d1a",
                "6d02cc019a013d48",
                "252629b2941bab49"
            ]
        ]
    },
    {
        "id": "606aa4d8d05a9287",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 620,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "6d02cc019a013d48",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "update knowledgeObjects",
        "func": "msg.collection = \"knowledgeObjects\"\nmsg.query = {\n    'knowledgeBaseId': msg.req.query.id,\n}\n\nmsg.payload = {\n    $set: {\n        'deleted': true\n    }\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 280,
        "wires": [
            [
                "e9975ec25168990f"
            ]
        ]
    },
    {
        "id": "e9975ec25168990f",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 620,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "252629b2941bab49",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "get knowledgeObjects",
        "func": "msg.old=msg.payload\nmsg.collection = \"knowledgeObjects\"\nmsg.payload = {\n    'knowledgeBaseId': msg.req.query.id\n}\n\n// msg.payload = {\n//     $set: {\n//         'deleted': true\n//     }\n// }\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 320,
        "wires": [
            [
                "f3693d6803a80481"
            ]
        ]
    },
    {
        "id": "f3693d6803a80481",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 610,
        "y": 320,
        "wires": [
            [
                "2400c26a38c58e08"
            ]
        ]
    },
    {
        "id": "2400c26a38c58e08",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "delete",
        "func": "let toDelete = msg.payload.filter(e => e.status === 'Saved in Pinecone')\nif (toDelete.length>0){\n    let vectorIds = toDelete.flatMap(e => e.vectors).map(e=> e.id);\nconst process_env = global.get(\"process_env\")\nmsg.headers = {\n    'Api-Key':process_env.PIPECONE_API,\n    'Content-Type': 'application/json'\n};\n    msg.PIPECONE_URL = process_env.PIPECONE_URL\n    msg.url = `${msg.PIPECONE_URL}/vectors/delete`;\nmsg.payload = { ids: vectorIds };\nmsg.ids = vectorIds\n    return [msg,null];\n}\nelse{\n    return[null,msg]\n}\n\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 750,
        "y": 320,
        "wires": [
            [
                "1917c12fa2c8a4cf"
            ],
            [
                "f7b854eb2dc1b411"
            ]
        ]
    },
    {
        "id": "1917c12fa2c8a4cf",
        "type": "http request",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "method": "DELETE",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 910,
        "y": 320,
        "wires": [
            [
                "f5fe1f2be3f0a8b2"
            ]
        ]
    },
    {
        "id": "92f653a488050792",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "url": "/deleteBaseObject",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 900,
        "wires": [
            [
                "a6b9a5d614c73e9e",
                "b5d5f3c0b2235a8b",
                "96b9fa92c8cf9113"
            ]
        ]
    },
    {
        "id": "a6b9a5d614c73e9e",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "update knowledgeObjects",
        "func": "msg.collection = \"knowledgeObjects\"\nmsg.query = {\n    '_id': objectid(msg.req.query.id) ,\n}\n\nmsg.payload = {\n    $set: {\n        'deleted': true\n    }\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 450,
        "y": 860,
        "wires": [
            [
                "9202426fe5eabf3e"
            ]
        ]
    },
    {
        "id": "b5d5f3c0b2235a8b",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "get knowledgeObjects",
        "func": "msg.old = msg.req.query.id\nmsg.collection = \"knowledgeObjects\"\nmsg.payload = {\n    '_id': objectid(msg.req.query.id)\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 440,
        "y": 900,
        "wires": [
            [
                "12fd6ccf93e5a7f0"
            ]
        ]
    },
    {
        "id": "9202426fe5eabf3e",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 660,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "12fd6ccf93e5a7f0",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 650,
        "y": 900,
        "wires": [
            [
                "667bc743d242e13d"
            ]
        ]
    },
    {
        "id": "667bc743d242e13d",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "delete",
        "func": "\nlet toDelete = msg.payload.filter(e => e.status === 'Saved in Pinecone')\n\nif (toDelete.length > 0) {\n    let vectorIds = toDelete.flatMap(e => e.vectors).map(e => e.id);\n    node.warn(vectorIds);\n\n\n    const process_env = global.get(\"process_env\")\n    msg.PIPECONE_URL = process_env.PIPECONE_URL\n    msg.headers = {\n        'Api-Key': process_env.PIPECONE_API,\n        'Content-Type': 'application/json'\n    };\n\n    msg.url = `${msg.PIPECONE_URL}/vectors/delete`;\n    msg.payload = { ids: vectorIds };\n    msg.ids = vectorIds\n    return [msg, null];\n}\nelse {\n    return [null, msg]\n}\n\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 810,
        "y": 900,
        "wires": [
            [
                "dff98dfc8f9ced2a"
            ],
            [
                "109911acfae79b7a"
            ]
        ]
    },
    {
        "id": "dff98dfc8f9ced2a",
        "type": "http request",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "method": "DELETE",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 950,
        "y": 880,
        "wires": [
            [
                "4e937f790d5417e6"
            ]
        ]
    },
    {
        "id": "4e937f790d5417e6",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1110,
        "y": 880,
        "wires": []
    },
    {
        "id": "f5fe1f2be3f0a8b2",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1050,
        "y": 320,
        "wires": []
    },
    {
        "id": "f7b854eb2dc1b411",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 890,
        "y": 280,
        "wires": []
    },
    {
        "id": "109911acfae79b7a",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 930,
        "y": 920,
        "wires": []
    },
    {
        "id": "7987659ba87c382e",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "debug 441",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 660,
        "wires": []
    },
    {
        "id": "2bdc0d294e3e0bf4",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "from app",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 180,
        "y": 700,
        "wires": []
    },
    {
        "id": "6cb8466c8d27b038",
        "type": "array-loop",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "",
        "key": "amount",
        "keyType": "msg",
        "reset": false,
        "resetValue": "value-null",
        "array": "array",
        "arrayType": "msg",
        "x": 680,
        "y": 2320,
        "wires": [
            [
                "fca11faee5518dfa"
            ],
            [
                "0f76e81b4c2a0190"
            ]
        ]
    },
    {
        "id": "b294829d3045d4d9",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "check",
        "func": "msg.oldPayload = msg.oldPayloadforlink\nmsg.payload ={\n    name: msg.oldPayload.name,\n    type:msg.oldPayload.type,\n    deleted:false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 720,
        "wires": [
            [
                "a285ccae6495c571"
            ]
        ]
    },
    {
        "id": "a285ccae6495c571",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 770,
        "y": 720,
        "wires": [
            [
                "a476f9b007fdc7df"
            ]
        ]
    },
    {
        "id": "a476f9b007fdc7df",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": ">",
        "func": "\nif(msg.payload.length >0){\nreturn[msg, null]\n}\nelse{\n    return [null,msg]\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 720,
        "wires": [
            [
                "7676181e57cb8077"
            ],
            [
                "24a52e523c94a6b1",
                "bb6e63ef3b3b0ba9"
            ]
        ]
    },
    {
        "id": "7676181e57cb8077",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "update",
        "func": "let question = msg.oldPayload.question;\nlet result = msg.oldPayload.result;\n\nlet url = msg.oldPayload.name\n\n\nmsg.query = { \"_id\":objectid(msg.payload[0]._id)}\nmsg.payload = {\n\n    \"$push\": {\n        \"vectors\": {\n            id: Date.now().toString(),\n            pinecone: false,\n            metadata: { url: url, question: question, result },\n        },\n    }\n\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1110,
        "y": 700,
        "wires": [
            [
                "8aa3ca8d85ab7976",
                "02f45d35273cae7c"
            ]
        ]
    },
    {
        "id": "24a52e523c94a6b1",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "insert",
        "func": "let question = msg.oldPayload.question;\nlet result = msg.oldPayload.result;\n\nlet url = msg.oldPayload.name\n\nlet vector = {\n            id: Date.now().toString(),\n            pinecone: false,\n            metadata: { url: url, question: question, result },\n        }\n        \nmsg.payload = {\n    _id: msg._id,\n    knowledgeBaseId: msg.oldPayloadforlink.id,\n    url: url,\n    type: msg.type,\n    name: msg.oldPayload.name,\n    vectors: [vector],\n    status: \"Divided\",\n    deleted: false,\n    createdAt: new Date()\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 740,
        "wires": [
            [
                "42388fd17c427ec6",
                "3f2f57386cc5229d"
            ]
        ]
    },
    {
        "id": "42388fd17c427ec6",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "8771d95b528d34d0"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1290,
        "y": 740,
        "wires": [
            [
                "ba455781b510a1a3"
            ]
        ]
    },
    {
        "id": "ba455781b510a1a3",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "status",
        "func": "msg.payload = {\n    \"success\": true,\n    \"payload\": \"Successfully created\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 740,
        "wires": [
            [
                "a31ae24a2d6a88e3"
            ]
        ]
    },
    {
        "id": "a31ae24a2d6a88e3",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1610,
        "y": 740,
        "wires": []
    },
    {
        "id": "8aa3ca8d85ab7976",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1300,
        "y": 700,
        "wires": [
            [
                "250cc8f7709d5bb6"
            ]
        ]
    },
    {
        "id": "250cc8f7709d5bb6",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "status",
        "func": "msg.payload = {\n    \"success\": true,\n    \"payload\": \"Successfully updated\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 700,
        "wires": [
            [
                "ae3df007d4bb6281"
            ]
        ]
    },
    {
        "id": "ae3df007d4bb6281",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1610,
        "y": 700,
        "wires": []
    },
    {
        "id": "bb6e63ef3b3b0ba9",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": ">2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 780,
        "wires": []
    },
    {
        "id": "3f2f57386cc5229d",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "insert",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1270,
        "y": 780,
        "wires": []
    },
    {
        "id": "02f45d35273cae7c",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "update",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1290,
        "y": 660,
        "wires": []
    },
    {
        "id": "db01fe062fb661a6",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "name": "",
        "url": "/getKnowlegeObjectManual",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 3190,
        "y": 240,
        "wires": [
            [
                "d5c3b4a9a0399eb9"
            ]
        ]
    },
    {
        "id": "d5c3b4a9a0399eb9",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "name": "to mongoDB",
        "func": "msg.collection = \"knowledgeObjects\"\nmsg.payload = {\n    'knowledgeBaseId':msg.payload.id,\n    \"type\": \"Manual\",\n    deleted: { $ne: true }\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 3410,
        "y": 240,
        "wires": [
            [
                "7361425497b32917"
            ]
        ]
    },
    {
        "id": "7361425497b32917",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "name": "",
        "links": [
            "2677414dc3b763e4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 3590,
        "y": 240,
        "wires": [
            [
                "63108dcf9d3706d2"
            ]
        ]
    },
    {
        "id": "63108dcf9d3706d2",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 3750,
        "y": 240,
        "wires": []
    },
    {
        "id": "96b9fa92c8cf9113",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "a16a3e4151c2e982",
        "name": "fromApp",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 400,
        "y": 940,
        "wires": []
    },
    {
        "id": "60fcf811aaa47983",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "url": "/addVector",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 1820,
        "y": 760,
        "wires": [
            [
                "ca416f1b98beabd4",
                "a174c982a35eeae3"
            ]
        ]
    },
    {
        "id": "29f355cc5c5a2756",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "update",
        "func": "const question = msg.payload.question;\nconst result = msg.payload.result;\nconst id = Date.now().toString();\nconst url = msg.payload.url;\n\nlet updatedData = { url: url, question: question, result }; \nmsg.collection = \"knowledgeObjects\"\n\nmsg.query = { \"_id\": objectid(msg.payload.id) }\n\nmsg.payload = {\n    \"$push\": {\n        \"vectors\": {\n            id: id,\n            pinecone: false,\n            metadata: updatedData\n        }\n    }\n};\n\nreturn msg;\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 2190,
        "y": 840,
        "wires": [
            [
                "991728e9094bd66f",
                "73421b0edc8be468",
                "6190e70b904db5ed"
            ]
        ]
    },
    {
        "id": "991728e9094bd66f",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "status",
        "func": "msg.payload = {\n    \"success\": true,\n    \"payload\": \"Successfully added\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2360,
        "y": 880,
        "wires": [
            [
                "c2b008a8e03aea46"
            ]
        ]
    },
    {
        "id": "73421b0edc8be468",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2390,
        "y": 840,
        "wires": [
            [
                "d101f0224434fdea"
            ]
        ]
    },
    {
        "id": "c2b008a8e03aea46",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2540,
        "y": 880,
        "wires": []
    },
    {
        "id": "d101f0224434fdea",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "to chat",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2540,
        "y": 840,
        "wires": []
    },
    {
        "id": "ca416f1b98beabd4",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "to chat",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1990,
        "y": 800,
        "wires": []
    },
    {
        "id": "a174c982a35eeae3",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "check status",
        "func": "msg.fromApp = msg.payload\nif (msg.payload.status === \"Saved in Pinecone\"){\n    return [msg,null]\n}else{\n    return [null,msg]\n}\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2010,
        "y": 760,
        "wires": [
            [
                "93f9cbe5556410cd",
                "69693ac612bcb960"
            ],
            [
                "29f355cc5c5a2756"
            ]
        ]
    },
    {
        "id": "9799e4664d3f7445",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "update",
        "func": "\nconst question = msg.fromApp.question;\nconst result = msg.fromApp.result;\n// const id = Date.now().toString();\nconst url = msg.fromApp.url;\n\n\nlet updatedData = { url: url, question: question, result };\nmsg.collection = \"knowledgeObjects\"\n\nmsg.query = { \"_id\": objectid(msg.fromApp[\"id \"]) }\nmsg.payload = {\n    \"$push\": {\n        \"vectors\": {\n            id: msg.newid,\n            pinecone: true,\n            metadata: updatedData\n        }\n    }\n\n};\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 2730,
        "y": 680,
        "wires": [
            [
                "461f1e55f3127c0b",
                "9a642809df0b280d"
            ]
        ]
    },
    {
        "id": "f722a9741c9e9a40",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2890,
        "y": 740,
        "wires": []
    },
    {
        "id": "9da53257cf02584a",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "status",
        "func": "msg.payload = {\n    \"success\": true,\n    \"payload\": \"Successfully updated\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2750,
        "y": 740,
        "wires": [
            [
                "f722a9741c9e9a40"
            ]
        ]
    },
    {
        "id": "461f1e55f3127c0b",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2900,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "38078d4521bd2654",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "url": "/divideFile",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 1080,
        "wires": [
            [
                "3260737fa16542db"
            ]
        ]
    },
    {
        "id": "3260737fa16542db",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "check type",
        "func": "msg.collection = \"knowledgeObjects\";\nmsg.oldPayload = msg.payload;\nmsg.type = msg.payload.type;\nmsg.urlName = msg.oldPayload.link;\nmsg.fileType = msg.payload.file_type;\nmsg._id = objectid(msg.payload.id);\n\n\nif (msg.fileType ===\"Link\"){\n    msg.url = env.get(\"nodered\") + `/getLinkInfo`;\n\n    return msg\n}\nif (msg.fileType === \"File\" && msg.type !== 'Question-Answer'){\n    msg.url = env.get(\"nodered\") + `/getFileInfo`;\n\n    return msg\n}\nif (msg.fileType === \"File\" && msg.type ==='Question-Answer'){\n    msg.url = env.get(\"nodered\") + `/FAQ`;\n\n    return msg\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 370,
        "y": 1080,
        "wires": [
            [
                "4bb9c7b82b1bedac",
                "fe443544d5884010",
                "1e359ae0665bd358"
            ]
        ]
    },
    {
        "id": "4bb9c7b82b1bedac",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "reset Vectors",
        "func": "msg.collection = \"knowledgeObjects\"\n\nmsg.query = {\n    _id: objectid(msg.oldPayload.id)\n}\nmsg.payload ={\n    $set:{\n        vectors:[],\n        status:\"Dividing in process\"\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 570,
        "y": 1100,
        "wires": [
            [
                "dd4341b099b6c43b",
                "0ff19f9d39e738a8"
            ]
        ]
    },
    {
        "id": "a6432e2120d18a72",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 930,
        "y": 1100,
        "wires": []
    },
    {
        "id": "dd4341b099b6c43b",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "status",
        "func": "msg.payload = {\n    \"success\": true,\n    \"payload\":\"Dividing in process\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 1100,
        "wires": [
            [
                "bc1ddb60e7ba20b4"
            ]
        ]
    },
    {
        "id": "bc1ddb60e7ba20b4",
        "type": "delay",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 845,
        "y": 1100,
        "wires": [
            [
                "a6432e2120d18a72"
            ]
        ],
        "l": false
    },
    {
        "id": "0ff19f9d39e738a8",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 780,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "a5501616c36880d2",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "1f1b365afc8becc5",
        "name": "function 370",
        "func": "const vector = msg.payload.data[0].embedding\n\nmsg.payload = {\n    name: global.get(\"process_env\").PIPECONE_INDEX,\n    \"topK\": 2,\n    \"includeMetadata\": true,\n    vector\n};\n\nmsg.PINECONE_API_KEY = global.get(\"process_env\").PIPECONE_API\nmsg.PINECONE_ENVIRONMENT = global.get(\"process_env\").PIPECONE_ENV\nmsg.PINECONE_BASE_URL = global.get(\"process_env\").PIPECONE_URL\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 665,
        "y": 2600,
        "wires": [
            [
                "359cab52989aa29b"
            ]
        ],
        "l": false
    },
    {
        "id": "1c959c0c2ef18143",
        "type": "openai-ubos",
        "z": "8bea414da58d7b2a",
        "g": "1f1b365afc8becc5",
        "name": "",
        "model": "text-embedding-ada-002",
        "temperature": 0.5,
        "max_tokens": 60,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 540,
        "y": 2600,
        "wires": [
            [
                "a5501616c36880d2"
            ]
        ]
    },
    {
        "id": "c942ede7e8406c1f",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "1f1b365afc8becc5",
        "name": "create vector",
        "func": "delete msg.filepath;\ndelete msg.filename;\ndelete msg.text;\nconst process_env = global.get(\"process_env\")\n// msg.OPENAI_API_KEY = process_env.OPENAI_API\nmsg.model = 'gpt-3.5-turbo-16k'\n\nmsg.messages = [\n  { \"role\": \"system\", \"content\": global.get(\"process_env\").PROMPT + msg.payload.matches[0].metadata.result + \", \" + msg.payload.matches[1].metadata.result },\n  { \"role\": \"user\", \"content\": msg.fromApp.content }\n]\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 2600,
        "wires": [
            [
                "a3717377eb0b554d"
            ]
        ]
    },
    {
        "id": "a3717377eb0b554d",
        "type": "openai-ubos",
        "z": "8bea414da58d7b2a",
        "g": "1f1b365afc8becc5",
        "name": "genarate unswer",
        "model": "gpt-3.5-turbo",
        "temperature": 0.02,
        "max_tokens": 2000,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 1035,
        "y": 2600,
        "wires": [
            [
                "6e171ee418466503"
            ]
        ],
        "l": false
    },
    {
        "id": "6e171ee418466503",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "1f1b365afc8becc5",
        "name": "send history",
        "func": "const responseChatGPT = msg.payload.choices[0].message.content;\nconst history = global.get(`historyDemo`) || [];\nhistory.push({ \"role\": \"assistant\", \"content\": responseChatGPT })\nglobal.set(`historyDemo`, history);\n\n\nhistory[0] = {\n    role: 'user',\n    content: '/start'\n}\n\nconst conversation = history.map(e => ({ content: e.content.replace(/\\n/g, '') }));\nmsg.payload = conversation\n\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1150,
        "y": 2600,
        "wires": [
            [
                "512bf5fd33a8679d"
            ]
        ]
    },
    {
        "id": "0f76e81b4c2a0190",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "create vector",
        "func": "\nmsg.fromApp = msg.payload\nmsg.OPENAI_API_KEY = global.get(\"process_env\").OPENAI_API;\nmsg.input = msg.payload.metadata.result\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 2380,
        "wires": [
            [
                "6636970cd09260b8",
                "1f0712b9ddfca967"
            ]
        ]
    },
    {
        "id": "7b65309666385ff9",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "function 371",
        "func": "const vector = msg.payload.data[0].embedding\nconst question = msg.fromApp.metadata.question\nconst result = msg.fromApp.metadata.result\nconst url = msg.fromApp.metadata.url\nmsg.payload = {\n    name: global.get(\"process_env\").PIPECONE_INDEX,\n    vectors: [{\n        id: msg.fromApp.id,\n        values: vector,\n        metadata: { url: url, question: question, result: result }\n    }]\n};\n\nmsg.PINECONE_API_KEY = global.get(\"process_env\").PIPECONE_API\nmsg.PINECONE_ENVIRONMENT = global.get(\"process_env\").PIPECONE_ENV\nmsg.PINECONE_BASE_URL = global.get(\"process_env\").PIPECONE_URL\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 685,
        "y": 2380,
        "wires": [
            [
                "48971cd8ed706f55",
                "ed63a752615547a1"
            ]
        ],
        "l": false
    },
    {
        "id": "6636970cd09260b8",
        "type": "openai-ubos",
        "z": "8bea414da58d7b2a",
        "name": "",
        "model": "text-embedding-ada-002",
        "temperature": 0.5,
        "max_tokens": 60,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 540,
        "y": 2400,
        "wires": [
            [
                "7b65309666385ff9",
                "1f0712b9ddfca967"
            ]
        ]
    },
    {
        "id": "1f0712b9ddfca967",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "debug 497",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 2420,
        "wires": []
    },
    {
        "id": "3136f28333abd3e3",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "debug 498",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 2380,
        "wires": []
    },
    {
        "id": "7a196d148fa3944d",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "create vector",
        "func": "\nmsg.fromApp = msg.payload\nmsg.OPENAI_API_KEY = global.get(\"process_env\").OPENAI_API;\nmsg.input = msg.payload.result\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2030,
        "y": 160,
        "wires": [
            [
                "a2236acc5c0ac9fa"
            ]
        ]
    },
    {
        "id": "0e89fb615ad470a3",
        "type": "pinecone-vector-ubos",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "demoversion",
        "actionType": "update",
        "apiKey": "",
        "environment": "",
        "x": 2450,
        "y": 160,
        "wires": [
            [
                "962290bc68cb0b29",
                "3265f7c71d2632ab"
            ]
        ]
    },
    {
        "id": "314c13476ffcf083",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "function 372",
        "func": "msg.PINECONE_API_KEY = global.get(\"process_env\").PIPECONE_API\nmsg.PINECONE_ENVIRONMENT = global.get(\"process_env\").PIPECONE_ENV\nmsg.PINECONE_BASE_URL = global.get(\"process_env\").PIPECONE_URL\n\nconst vector = msg.payload.data[0].embedding\nconst question = msg.fromApp.question;\nconst result = msg.fromApp.result;\nconst id = msg.fromApp.id;\nconst url = msg.fromApp.url;\nmsg.actionType='update'\nmsg.payload = {\n    id: id,\n    name: global.get(\"process_env\").PIPECONE_INDEX,\n    setMetadata: { url: url, question: question, result: result },\n    values: vector,\n    namespase:''\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 2325,
        "y": 160,
        "wires": [
            [
                "0e89fb615ad470a3",
                "a1eb048e669efd8b"
            ]
        ],
        "l": false
    },
    {
        "id": "a2236acc5c0ac9fa",
        "type": "openai-ubos",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "model": "text-embedding-ada-002",
        "temperature": 0.5,
        "max_tokens": 60,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 2200,
        "y": 160,
        "wires": [
            [
                "314c13476ffcf083"
            ]
        ]
    },
    {
        "id": "525bb633cc44c263",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "url": "/getLinkInfo",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 1220,
        "wires": [
            [
                "9d6a0a67613cb9dd",
                "a3a245f7e0af4a0c"
            ]
        ]
    },
    {
        "id": "3fa09efefbec581a",
        "type": "http request",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "Get Link Info",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 510,
        "y": 1220,
        "wires": [
            [
                "9b7638008790cf33"
            ]
        ]
    },
    {
        "id": "9d6a0a67613cb9dd",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "func": "msg.old=msg.payload\nmsg.url = msg.payload.link;\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 340,
        "y": 1220,
        "wires": [
            [
                "3fa09efefbec581a"
            ]
        ]
    },
    {
        "id": "9b7638008790cf33",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "Scrape",
        "func": "const { JSDOM } = jsdom;\n\nconst html = msg.payload;\n\nconst dom = new JSDOM(`${html}`);\ndom.window.document.querySelectorAll('style').forEach(link => {\n    link.remove();\n});\ndom.window.document.querySelectorAll('script').forEach(link => {\n    link.remove();\n});\nconst document = dom.window.document;\nconst pageText = document.body.textContent;\nmsg.text = pageText;\n\n\nlet table = dom.window.document.querySelector('table');\n\nlet ckeckTable = table?.textContent ? true : false;\n\n\nif (ckeckTable) {\n    const headers = Array.from(table.querySelectorAll('tr:first-child th, tr:first-child td')).map(td => {\n        const text = td.textContent.trim();\n        return text !== \"\" ? text : undefined;\n    }).filter(Boolean);\n\n    const rows = Array.from(table.querySelectorAll('tr:not(:first-child)'));\n    const tableData = rows.map(row => {\n        const rowData = Array.from(row.querySelectorAll('td')).map(td => td.textContent.trim());\n        return Object.fromEntries(headers.map((header, index) => [header, rowData[index]]));\n    });\n\n    let tables = JSON.stringify(tableData);\n    node.warn(tables)\n    msg.pageContent = pageText + '\\n\\n' + tables;\n} else {\n     msg.pageContent = pageText;\n}\n\nif (msg.old.type === \"Points\") {\n    msg.result = msg.pageContent.split(\".\").map(paragraph => paragraph.trim()).filter(paragraph => paragraph !== \"\");\n}\nif (msg.old.type === \"Paragraphs\") {\n    const MAX_LENGTH = 500;\n\n   msg.result = [];\n    let currentParagraph = '';\n\n    const sentences = msg.pageContent.replace(/\\s+/g, ' ').split(/([.?!])+/).filter(sentence => sentence.trim() !== '');\n\n    for (const sentence of sentences) {\n        if (currentParagraph.length + sentence.length <= MAX_LENGTH) {\n            currentParagraph += sentence;\n        } else {\n            msg.result.push(currentParagraph.trim());\n            currentParagraph = sentence;\n        }\n    }\n\n    if (currentParagraph.trim() !== '') {\n        msg.result.push(currentParagraph.trim());\n    }\n}\n\n\nmsg.payload=msg.old\nmsg.payload.text = msg.result\n\nmsg.url = msg.old.anrichment ? env.get(\"nodered\") + `/createVectorEnrichment` : env.get(\"nodered\") + `/createVector`;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jsdom",
                "module": "jsdom"
            }
        ],
        "x": 680,
        "y": 1220,
        "wires": [
            [
                "867d3778dcfe053a",
                "9759e1cf71d9ad17"
            ]
        ]
    },
    {
        "id": "f2d00448b92f52ab",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "url": "/getFileInfo",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 1320,
        "wires": [
            [
                "e7b9e2966ec9a530",
                "47578350c357cafb"
            ]
        ]
    },
    {
        "id": "1577d5b3d256df56",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "decodedFilename ",
        "func": "const decodedFilename = `/${msg.old.link}`;\n\nconst outputString = decodedFilename.replace(//g, '`')\nmsg.urlName = outputString\nmsg.filepath = \"/data/storage\" + outputString;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 1340,
        "wires": [
            [
                "beb52d2cfee001bd"
            ]
        ]
    },
    {
        "id": "576cadf9d8acf893",
        "type": "pdfparse",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "path": "",
        "x": 720,
        "y": 1300,
        "wires": [
            [
                "0cd095660d72aa7b"
            ]
        ]
    },
    {
        "id": "e7b9e2966ec9a530",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "check .pdf or .txt",
        "func": "msg.old=msg.payload\nif (msg.payload.link.includes(\".pdf\")){\n    return[msg, null]\n}else{\n    return[null, msg]\n}\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 1320,
        "wires": [
            [
                "cc8d16bafb9ce20b"
            ],
            [
                "1577d5b3d256df56"
            ]
        ]
    },
    {
        "id": "cc8d16bafb9ce20b",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "read pdf",
        "func": "const decodedFilename = `${msg.old.link}`;\n\nconst outputString = decodedFilename.replace(//g, '`')\n\nmsg.path = \"/data/storage/\" + outputString;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1300,
        "wires": [
            [
                "576cadf9d8acf893"
            ]
        ]
    },
    {
        "id": "0cd095660d72aa7b",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "function 373",
        "func": "msg.pageContent = msg.payload.text\nif (msg.old.type === \"Points\") {\n    msg.result = msg.pageContent.split(\".\").map(paragraph => paragraph.trim()).filter(paragraph => paragraph !== \"\");\n}\nif (msg.old.type === \"Paragraphs\") {\n    const MAX_LENGTH = 500;\n\n    msg.result = [];\n    let currentParagraph = '';\n\n    const sentences = msg.pageContent.replace(/\\s+/g, ' ').split(/([.?!])+/).filter(sentence => sentence.trim() !== '');\n\n    for (const sentence of sentences) {\n        if (currentParagraph.length + sentence.length <= MAX_LENGTH) {\n            currentParagraph += sentence;\n        } else {\n            msg.result.push(currentParagraph.trim());\n            currentParagraph = sentence;\n        }\n    }\n\n    if (currentParagraph.trim() !== '') {\n        msg.result.push(currentParagraph.trim());\n    }\n}\n\nmsg.payload = msg.old\nmsg.payload.text = msg.result\n\nmsg.url = msg.old.anrichment ? env.get(\"nodered\") + `/createVectorEnrichment` : env.get(\"nodered\") + `/createVector`;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 835,
        "y": 1300,
        "wires": [
            [
                "e8dd5a3cef19bc27",
                "661abc1c6fd76083"
            ]
        ],
        "l": false
    },
    {
        "id": "beb52d2cfee001bd",
        "type": "file in",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "filename": "filepath",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 780,
        "y": 1340,
        "wires": [
            [
                "d8e85292b920695a"
            ]
        ]
    },
    {
        "id": "bcf34a0e1dafbf59",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "url": "/createVector",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 1480,
        "wires": [
            [
                "88ec2c91695ac6ae",
                "f86157e201cac1a7"
            ]
        ]
    },
    {
        "id": "b4d6a94b71d62b66",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "create vector",
        "func": "\nmsg.collection = \"knowledgeObjects\"\ndelete msg.filepath;\ndelete msg.filename;\n\n\nmsg.query = { \"_id\": msg._id }\nlet result = msg.payload\n\nmsg.payload = {\n\n   \"$push\": {\n      \"vectors\": {\n         id: Date.now().toString(),\n         pinecone: false,\n         metadata: { url: msg.old.link, result: result, question:\"\"},\n      }\n   }\n\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 425,
        "y": 1560,
        "wires": [
            [
                "488f7c35727984eb",
                "a9268935b3c53447",
                "c0c85d0a428f6025"
            ]
        ],
        "l": false
    },
    {
        "id": "bb3b0def28dfa3ab",
        "type": "array-loop",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "key": "count",
        "keyType": "msg",
        "reset": false,
        "resetValue": "value-null",
        "array": "array",
        "arrayType": "msg",
        "x": 510,
        "y": 1480,
        "wires": [
            [
                "5beab8f0741449f2"
            ],
            [
                "b4d6a94b71d62b66"
            ]
        ]
    },
    {
        "id": "5beab8f0741449f2",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "reset Vectors",
        "func": "msg.collection = \"knowledgeObjects\"\n\nmsg.query = {\n    _id: objectid(msg.old.id)\n}\nmsg.payload ={\n    $set:{\n        status:\"Divided\"\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 700,
        "y": 1480,
        "wires": [
            [
                "5df5b12baaeb4642",
                "cb28fee928d8243e",
                "dd2531395c7cd2e1"
            ]
        ]
    },
    {
        "id": "5df5b12baaeb4642",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 900,
        "y": 1480,
        "wires": [
            []
        ]
    },
    {
        "id": "488f7c35727984eb",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 580,
        "y": 1600,
        "wires": [
            []
        ]
    },
    {
        "id": "a9268935b3c53447",
        "type": "delay",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 585,
        "y": 1560,
        "wires": [
            [
                "bb3b0def28dfa3ab"
            ]
        ],
        "l": false
    },
    {
        "id": "cb28fee928d8243e",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "to base",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 860,
        "y": 1520,
        "wires": []
    },
    {
        "id": "dbd5eb04908ef666",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "url": "/createVectorEnrichment",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 190,
        "y": 1740,
        "wires": [
            [
                "c2ba0116ea85ea24",
                "6250a3895597130c"
            ]
        ]
    },
    {
        "id": "a1670647af3c537e",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "create vector",
        "func": "delete msg.filepath;\ndelete msg.filename;\ndelete msg.text;\nconst process_env = global.get(\"process_env\")\nmsg.OPENAI_API_KEY = process_env.OPENAI_API\n\nmsg.text = msg.payload\n  msg.messages= [\n    { \"role\": \"system\", \"content\": `        : ${msg.payload}`},\n     \n    ]\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 425,
        "y": 1820,
        "wires": [
            [
                "f7a921a1fdc52072"
            ]
        ],
        "l": false
    },
    {
        "id": "f7a921a1fdc52072",
        "type": "openai-ubos",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "genarate unswer",
        "model": "gpt-3.5-turbo",
        "temperature": 0.02,
        "max_tokens": 2000,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 495,
        "y": 1820,
        "wires": [
            [
                "9d3a3bd6261e69f7",
                "52e8e4a529e9ea4c"
            ]
        ],
        "l": false
    },
    {
        "id": "5ef968aee91d6cb8",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "create vector",
        "func": "msg.collection = \"knowledgeObjects\"\n\ndelete msg.filepath;\ndelete msg.filename;\n\nlet question =  msg.payload.choices[0].message.content;\nlet result = msg.text\n\n\n\n\nmsg.query = { \"_id\": msg._id }\nmsg.payload = {\n\n   \"$push\": {\n      \"vectors\": {\n         id: Date.now().toString(),\n         pinecone: false,\n         metadata: { url: msg.old.link,question: question, result },\n      }\n   }\n\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 645,
        "y": 1820,
        "wires": [
            [
                "75e116bf63574213",
                "65e85721599c7e36",
                "b16acac646f8c1a1"
            ]
        ],
        "l": false
    },
    {
        "id": "9d3a3bd6261e69f7",
        "type": "delay",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 575,
        "y": 1820,
        "wires": [
            [
                "5ef968aee91d6cb8"
            ]
        ],
        "l": false
    },
    {
        "id": "75e116bf63574213",
        "type": "array-loop",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "key": "count",
        "keyType": "msg",
        "reset": false,
        "resetValue": "value-null",
        "array": "array",
        "arrayType": "msg",
        "x": 600,
        "y": 1740,
        "wires": [
            [
                "a54f017ce67d1c90"
            ],
            [
                "a1670647af3c537e"
            ]
        ]
    },
    {
        "id": "a54f017ce67d1c90",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "reset Vectors",
        "func": "msg.collection = \"knowledgeObjects\"\n\nmsg.query = {\n    _id: objectid(msg.old.id)\n}\nmsg.payload ={\n    $set:{\n        status:\"Divided\"\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 770,
        "y": 1720,
        "wires": [
            [
                "01e9e039f4f03cc5",
                "72d36a332da3a93e"
            ]
        ]
    },
    {
        "id": "01e9e039f4f03cc5",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 953,
        "y": 1721.2000732421875,
        "wires": [
            []
        ]
    },
    {
        "id": "65e85721599c7e36",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 800,
        "y": 1860,
        "wires": [
            []
        ]
    },
    {
        "id": "b16acac646f8c1a1",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "debug 499",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 790,
        "y": 1820,
        "wires": []
    },
    {
        "id": "52e8e4a529e9ea4c",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "debug 500",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 590,
        "y": 1880,
        "wires": []
    },
    {
        "id": "c0c85d0a428f6025",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "to base",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 1560,
        "wires": []
    },
    {
        "id": "d8e85292b920695a",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "Create Pages",
        "func": "msg.pageContent = msg.payload\nif (msg.old.type === \"Points\") {\n    msg.result = msg.pageContent.split(\".\").map(paragraph => paragraph.trim()).filter(paragraph => paragraph !== \"\");\n}\nif (msg.old.type === \"Paragraphs\") {\n    const MAX_LENGTH = 500;\n\n    msg.result = [];\n    let currentParagraph = '';\n\n    const sentences = msg.pageContent.replace(/\\s+/g, ' ').split(/([.?!])+/).filter(sentence => sentence.trim() !== '');\n\n    for (const sentence of sentences) {\n        if (currentParagraph.length + sentence.length <= MAX_LENGTH) {\n            currentParagraph += sentence;\n        } else {\n            msg.result.push(currentParagraph.trim());\n            currentParagraph = sentence;\n        }\n    }\n\n    if (currentParagraph.trim() !== '') {\n        msg.result.push(currentParagraph.trim());\n    }\n}\n\nmsg.payload = msg.old\nmsg.payload.text = msg.result\n\nmsg.url = msg.old.anrichment ? env.get(\"nodered\") + `/createVectorEnrichment` : env.get(\"nodered\") + `/createVector`;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 960,
        "y": 1340,
        "wires": [
            [
                "49d631b883f016b9",
                "661abc1c6fd76083"
            ]
        ]
    },
    {
        "id": "bd7768c1acd036b8",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "FAQ",
        "func": "msg._id = objectid(msg.payload.id);\n\nmsg.old = msg.payload\nconst decodedFilename = `/${msg.old.link}`;\n\nconst outputString = decodedFilename.replace(//g, '`')\n\nmsg.filepath = \"/data/storage/\" + outputString;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 290,
        "y": 2000,
        "wires": [
            [
                "40fd41773ef13c29"
            ]
        ]
    },
    {
        "id": "40fd41773ef13c29",
        "type": "file in",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "filename": "filepath",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 440,
        "y": 2000,
        "wires": [
            [
                "6d58fa04eae60b9a",
                "787092111a0fe528"
            ]
        ]
    },
    {
        "id": "6d58fa04eae60b9a",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "debug 501",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 550,
        "y": 2040,
        "wires": []
    },
    {
        "id": "787092111a0fe528",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "encoding file",
        "func": "\nlet text = msg.payload\n\nlet parts = text.split(/\\n/g).map(part => part.trim()).filter(part => part.length > 0);\n\nlet result = [];\nlet obj = {};\nfor (let i = 0; i < parts.length; i++) {\n    if (parts[i].endsWith(\"?\")) {\n        if (Object.keys(obj).length > 0) { // if 'obj' has keys\n            result.push(obj);\n            // @ts-ignore\n            obj = {};\n        }\n        obj[\"A\"] = parts[i];\n    } else {\n        if (obj[\"B\"]) {\n            obj[\"B\"] += ' ' + parts[i];\n        } else {\n            obj[\"B\"] = parts[i];\n        }\n    }\n}\n\nif (Object.keys(obj).length > 0) {\n    result.push(obj);\n}\n\nmsg.array= result;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 2000,
        "wires": [
            [
                "6d58fa04eae60b9a",
                "62541437b715dd0c"
            ]
        ]
    },
    {
        "id": "62541437b715dd0c",
        "type": "array-loop",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "key": "count",
        "keyType": "msg",
        "reset": false,
        "resetValue": "value-null",
        "array": "array",
        "arrayType": "msg",
        "x": 840,
        "y": 2000,
        "wires": [
            [
                "8397a151d3c25458"
            ],
            [
                "141e0fb9f85a2535"
            ]
        ]
    },
    {
        "id": "141e0fb9f85a2535",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "create vector",
        "func": "// delete msg.filepath;\n// delete msg.filename;\n\nmsg.collection = \"knowledgeObjects\"\n\nlet question = msg.payload.A;\nlet result = msg.payload.B;\n\nlet url = msg.old.link\n\n\nmsg.query = { \"_id\": msg._id }\nmsg.payload = {\n\n   \"$push\": {\n      \"vectors\": {\n         id: Date.now().toString(),\n         pinecone: false,\n         metadata: { url: url, question: question, result },\n      }\n   }\n\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 835,
        "y": 2060,
        "wires": [
            [
                "62541437b715dd0c",
                "9ba826dcc38ae118",
                "3f0f0ff828bec701",
                "0750d093421cd48f"
            ]
        ],
        "l": false
    },
    {
        "id": "8397a151d3c25458",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "reset Vectors",
        "func": "msg.collection = \"knowledgeObjects\"\n\nmsg.query = {\n    _id: objectid(msg.old.id)\n}\nmsg.payload ={\n    $set:{\n        status:\"Divided\"\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1010,
        "y": 1980,
        "wires": [
            [
                "4453f7534b49020a",
                "f83c02efeeaef247"
            ]
        ]
    },
    {
        "id": "9ba826dcc38ae118",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 980,
        "y": 2060,
        "wires": [
            []
        ]
    },
    {
        "id": "3f0f0ff828bec701",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "to base",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1140,
        "y": 2060,
        "wires": []
    },
    {
        "id": "4453f7534b49020a",
        "type": "link call",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "links": [
            "d1949ed8cdf3c5ed"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1180,
        "y": 1980,
        "wires": [
            []
        ]
    },
    {
        "id": "96f05ecc5dd200b4",
        "type": "http in",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "url": "/FAQ",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 2000,
        "wires": [
            [
                "bd7768c1acd036b8",
                "13c45d0b4d0d93c2",
                "6ca28a2d34f1cbca"
            ]
        ]
    },
    {
        "id": "fe443544d5884010",
        "type": "http request",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 570,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "867d3778dcfe053a",
        "type": "http request",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 830,
        "y": 1220,
        "wires": [
            []
        ]
    },
    {
        "id": "a3a245f7e0af4a0c",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 330,
        "y": 1180,
        "wires": []
    },
    {
        "id": "47578350c357cafb",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 330,
        "y": 1280,
        "wires": []
    },
    {
        "id": "e8dd5a3cef19bc27",
        "type": "http request",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 950,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "49d631b883f016b9",
        "type": "http request",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1130,
        "y": 1340,
        "wires": [
            []
        ]
    },
    {
        "id": "88ec2c91695ac6ae",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "function 374",
        "func": "msg._id = objectid(msg.payload.id);\n\nmsg.old = msg.payload\nmsg.array = msg.payload.text\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 350,
        "y": 1480,
        "wires": [
            [
                "bb3b0def28dfa3ab"
            ]
        ]
    },
    {
        "id": "c2ba0116ea85ea24",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "function 375",
        "func": "msg._id = objectid(msg.payload.id);\n\nmsg.old = msg.payload\nmsg.array = msg.payload.text\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 430,
        "y": 1740,
        "wires": [
            [
                "75e116bf63574213"
            ]
        ]
    },
    {
        "id": "1e359ae0665bd358",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "to base",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 380,
        "y": 1120,
        "wires": []
    },
    {
        "id": "9759e1cf71d9ad17",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "to base",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 980,
        "y": 1200,
        "wires": []
    },
    {
        "id": "13c45d0b4d0d93c2",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "to base",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 262.8571472167969,
        "y": 1952.857177734375,
        "wires": []
    },
    {
        "id": "dd2531395c7cd2e1",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "to base",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 800,
        "y": 1440,
        "wires": []
    },
    {
        "id": "661abc1c6fd76083",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "to base",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1200,
        "y": 1300,
        "wires": []
    },
    {
        "id": "0750d093421cd48f",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "to base",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 940,
        "y": 2100,
        "wires": []
    },
    {
        "id": "72d36a332da3a93e",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "to base",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 800,
        "y": 1780,
        "wires": []
    },
    {
        "id": "f83c02efeeaef247",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "to base",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1080,
        "y": 1940,
        "wires": []
    },
    {
        "id": "f86157e201cac1a7",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 330,
        "y": 1440,
        "wires": []
    },
    {
        "id": "6250a3895597130c",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 410,
        "y": 1700,
        "wires": []
    },
    {
        "id": "6ca28a2d34f1cbca",
        "type": "http response",
        "z": "8bea414da58d7b2a",
        "g": "7ce0f5d37c531784",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 290,
        "y": 2040,
        "wires": []
    },
    {
        "id": "359cab52989aa29b",
        "type": "pinecone-vector-ubos",
        "z": "8bea414da58d7b2a",
        "g": "1f1b365afc8becc5",
        "name": "demoversion",
        "actionType": "query",
        "apiKey": "",
        "environment": "",
        "x": 770,
        "y": 2600,
        "wires": [
            [
                "c942ede7e8406c1f"
            ]
        ]
    },
    {
        "id": "48971cd8ed706f55",
        "type": "pinecone-vector-ubos",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "demoversion",
        "actionType": "upsert",
        "apiKey": "",
        "environment": "",
        "x": 810,
        "y": 2380,
        "wires": [
            [
                "6cb8466c8d27b038",
                "3136f28333abd3e3"
            ]
        ]
    },
    {
        "id": "93f9cbe5556410cd",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "create vector",
        "func": "\nmsg.OPENAI_API_KEY = global.get(\"process_env\").OPENAI_API;\nmsg.input = msg.fromApp.result\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2170,
        "y": 720,
        "wires": [
            [
                "83022b358d68b77a",
                "d44b447e97418396"
            ]
        ]
    },
    {
        "id": "e95ce41ba8d6402c",
        "type": "function",
        "z": "8bea414da58d7b2a",
        "name": "function 376",
        "func": "const vector = msg.payload.data[0].embedding\nconst question = msg.fromApp.question\nconst result = msg.fromApp.result\nconst url = msg.fromApp.url\nmsg.newid = Date.now().toString();\n\nmsg.payload = {\n    name: global.get(\"process_env\").PIPECONE_INDEX,\n    vectors: [{\n        id: msg.newid,\n        values: msg.payload.data[0].embedding,\n        metadata: { url: url, question: question, result: result }\n    }]\n};\n\nmsg.PINECONE_API_KEY = global.get(\"process_env\").PIPECONE_API\nmsg.PINECONE_ENVIRONMENT = global.get(\"process_env\").PIPECONE_ENV\nmsg.PINECONE_BASE_URL = global.get(\"process_env\").PIPECONE_URL\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 2465,
        "y": 720,
        "wires": [
            [
                "6ea4ece0828d7016",
                "d647afa660efae56"
            ]
        ],
        "l": false
    },
    {
        "id": "83022b358d68b77a",
        "type": "openai-ubos",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "",
        "model": "text-embedding-ada-002",
        "temperature": 0.5,
        "max_tokens": 60,
        "prompt": "",
        "frequency_penalty": 0,
        "presence_penalty": 0,
        "top_p": 1,
        "stop": {
            "type": "json",
            "value": "[]"
        },
        "OPENAI_API_KEY": "",
        "x": 2340,
        "y": 720,
        "wires": [
            [
                "e95ce41ba8d6402c",
                "0f924979525228d5"
            ]
        ]
    },
    {
        "id": "6ea4ece0828d7016",
        "type": "pinecone-vector-ubos",
        "z": "8bea414da58d7b2a",
        "name": "demoversion",
        "actionType": "upsert",
        "apiKey": "",
        "environment": "",
        "x": 2590,
        "y": 720,
        "wires": [
            [
                "9da53257cf02584a",
                "9799e4664d3f7445",
                "9a642809df0b280d"
            ]
        ]
    },
    {
        "id": "d647afa660efae56",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "to chat",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2550,
        "y": 660,
        "wires": []
    },
    {
        "id": "d44b447e97418396",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "to chat",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2350,
        "y": 680,
        "wires": []
    },
    {
        "id": "9a642809df0b280d",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "to chat",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2730,
        "y": 640,
        "wires": []
    },
    {
        "id": "6190e70b904db5ed",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "to chat",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2160,
        "y": 880,
        "wires": []
    },
    {
        "id": "69693ac612bcb960",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "to chat",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2150,
        "y": 680,
        "wires": []
    },
    {
        "id": "0f924979525228d5",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "to chat",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2330,
        "y": 760,
        "wires": []
    },
    {
        "id": "3265f7c71d2632ab",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "debug 502",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2590,
        "y": 200,
        "wires": []
    },
    {
        "id": "85caaba3697848f2",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "911c1ee2586e9d4d",
        "name": "debug 503",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 950,
        "y": 2240,
        "wires": []
    },
    {
        "id": "a1eb048e669efd8b",
        "type": "debug",
        "z": "8bea414da58d7b2a",
        "g": "aff5f6094780b487",
        "name": "debug 504",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2350,
        "y": 220,
        "wires": []
    }
]